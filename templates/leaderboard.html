{% extends "layout.html" %}

{% block content %}
<div class="leaderboard-container">
  <div class="leaderboard-header">
    <h1>Skor Tablosu</h1>
    <p>Tüm beyin geliştirme oyunlarında skorlarınızın diğer oyunculara göre nasıl olduğunu kontrol edin.</p>
  </div>

  <div class="game-filter">
    <button class="game-filter-btn active" data-game="wordPuzzle">
      <i class="fas fa-font"></i>
      Kelime Bulmaca
    </button>
    <button class="game-filter-btn" data-game="memoryMatch">
      <i class="fas fa-brain"></i>
      Hafıza Kartları
    </button>
    <button class="game-filter-btn" data-game="labyrinth">
      <i class="fas fa-route"></i>
      Labirent
    </button>
    <button class="game-filter-btn" data-game="puzzle">
      <i class="fas fa-puzzle-piece"></i>
      Yapboz
    </button>
    <button class="game-filter-btn" data-game="visualAttention">
      <i class="fas fa-eye"></i>
      Görsel Dikkat
    </button>
    <button class="game-filter-btn" data-game="numberSequence">
      <i class="fas fa-sort-numeric-up"></i>
      Sayı Dizisi
    </button>
  </div>

  <div class="leaderboard-table">
    <div class="table-header">
      <div class="rank-cell">Sıra</div>
      <div class="username-cell">Oyuncu</div>
      <div class="score-cell">Skor</div>
      <div class="date-cell">Tarih</div>
    </div>
    <div class="table-body" id="scores-container">
      <!-- Scores will be loaded here -->
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const scoresContainer = document.getElementById('scores-container');
  const gameButtons = document.querySelectorAll('.game-filter-btn');
  let currentGame = 'puzzle'; // Varsayılan olarak puzzle seçili

  function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleString('tr-TR');
  }

  async function loadScores(gameType) {
    try {
      const scoresContainer = document.getElementById('scores-container');
      scoresContainer.innerHTML = '<div class="loading">Yükleniyor...</div>';

      const response = await fetch(`/api/get-scores/${gameType}`);
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }

      const data = await response.json();
      console.log('Yüklenen skorlar:', data);

      let scores = Array.isArray(data) ? data : data[gameType] || [];

      if (!scores || scores.length === 0) {
        scoresContainer.innerHTML = '<div class="no-scores">Henüz skor kaydı bulunmuyor.</div>';
        return;
      }

      let html = '';
      scores.forEach((score, index) => {
        const rowClass = index < 3 ? 'table-row top-rank' : 'table-row';
        html += `
          <div class="${rowClass}">
            <div class="rank-cell">${index + 1}</div>
            <div class="username-cell">${score.username || 'Anonim'}</div>
            <div class="score-cell">${score.score}</div>
            <div class="date-cell">${formatDate(score.timestamp)}</div>
          </div>
        `;
      });

      scoresContainer.innerHTML = html;

    } catch (error) {
      console.error('Error loading scores:', error);
      scoresContainer.innerHTML = `
        <div class="error">
          Skorlar yüklenirken bir hata oluştu.<br>
          <button onclick="loadScores('${gameType}')" class="game-filter-btn" style="margin-top: 10px;">
            Tekrar Dene
          </button>
        </div>`;
    }
  }

  gameButtons.forEach(button => {
    button.addEventListener('click', () => {
      gameButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
      currentGame = button.dataset.game;
      loadScores(currentGame);
    });
  });

  // Load initial scores
  loadScores(currentGame);
});
</script>
{% endblock %}