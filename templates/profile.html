
{% extends "layout.html" %}

{% block content %}
<div class="profile-container">
  <!-- Modern Profile Header with Animated Background -->
  <div class="profile-header-section">
    <div class="pattern-bg-animation">
      <div class="pattern-shape shape1"></div>
      <div class="pattern-shape shape2"></div>
      <div class="pattern-shape shape3"></div>
      <div class="pattern-shape shape4"></div>
    </div>
    
    <div class="profile-banner glass-card">
      <div class="profile-avatar-container">
        {% if user.avatar_url %}
          <img src="{{ user.avatar_url }}" alt="Profil" class="profile-avatar animate-pulse">
        {% else %}
          <div class="default-avatar animate-pulse">
            {{ user.username[0].upper() }}
          </div>
        {% endif %}
        <div class="profile-level-badge">{{ user.rank }}</div>
      </div>
      
      <div class="profile-basic-info">
        <h1 class="profile-username">{{ user.username }}</h1>
        <p class="join-date"><i class="fas fa-calendar-alt"></i> Katılım: {{ user.created_at.strftime('%d %B %Y') }}</p>
        <div class="last-active-status">
          <span class="status-indicator online"></span> Son Aktivite: {{ user.last_active.strftime('%d %B %Y, %H:%M') }}
        </div>
      </div>
      
      <div class="profile-actions">
        <button class="btn btn-edit-profile" data-bs-toggle="modal" data-bs-target="#editProfileModal">
          <i class="fas fa-edit"></i> Profili Düzenle
        </button>
      </div>
    </div>
  </div>

  <div class="profile-content">
    <!-- Left Panel: Personal Info -->
    <div class="profile-sidebar">
      <!-- Personal Information Card -->
      <div class="profile-card glass-card">
        <div class="card-header">
          <h3><i class="fas fa-user-circle"></i> Kişisel Bilgiler</h3>
        </div>
        <div class="profile-info-content">
          <div class="profile-info-item">
            <div class="info-icon"><i class="fas fa-user"></i></div>
            <div class="info-details">
              <div class="info-label">Kullanıcı Adı</div>
              <div class="info-value">{{ user.username }}</div>
            </div>
          </div>
          
          <div class="profile-info-item">
            <div class="info-icon"><i class="fas fa-user"></i></div>
            <div class="info-details">
              <div class="info-label">Ad Soyad</div>
              <div class="info-value">{{ user.full_name or 'Belirtilmedi' }}</div>
            </div>
          </div>
          
          <div class="profile-info-item">
            <div class="info-icon"><i class="fas fa-envelope"></i></div>
            <div class="info-details">
              <div class="info-label">E-mail</div>
              <div class="info-value">{{ user.email }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Panel: Recent Activities -->
    <div class="profile-main">
      <!-- Recent Activities Card -->
      <div class="recent-activity-card glass-card">
        <div class="card-header">
          <h3><i class="fas fa-history"></i> Son Aktiviteler</h3>
        </div>
        
        <div class="activity-content">
          {% if recent_scores %}
            <div class="activity-list">
              {% for score in recent_scores %}
              <div class="activity-item">
                <div class="activity-icon">
                  {% if score.game_type == 'wordPuzzle' %}
                    <i class="fas fa-font"></i>
                  {% elif score.game_type == 'memoryMatch' %}
                    <i class="fas fa-clone"></i>
                  {% elif score.game_type == 'labyrinth' %}
                    <i class="fas fa-route"></i>
                  {% elif score.game_type == 'puzzle' %}
                    <i class="fas fa-puzzle-piece"></i>
                  {% elif score.game_type == '3dRotation' %}
                    <i class="fas fa-cube"></i>
                  {% else %}
                    <i class="fas fa-gamepad"></i>
                  {% endif %}
                </div>
                <div class="activity-details">
                  <div class="activity-game">
                    {% if score.game_type == 'wordPuzzle' %}
                      Kelime Bulmaca
                    {% elif score.game_type == 'memoryMatch' %}
                      Hafıza Kartları
                    {% elif score.game_type == 'labyrinth' %}
                      Labirent
                    {% elif score.game_type == 'puzzle' %}
                      Yapboz
                    {% elif score.game_type == '3dRotation' %}
                      3D Döndürme
                    {% else %}
                      {{ score.game_type }}
                    {% endif %}
                  </div>
                  <div class="activity-score">{{ score.score }} puan</div>
                </div>
                <div class="activity-date">{{ score.timestamp.strftime('%d/%m/%Y %H:%M') }}</div>
              </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="no-activity">
              <i class="fas fa-info-circle"></i>
              <p>Henüz hiç oyun oynamadınız. Oynamaya başlayın ve skorlarınızı görün!</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Profil Düzenleme Modal - Geliştirilmiş Tasarım -->
<div class="modal fade" id="editProfileModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content dark-theme profile-edit-modal">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-user-edit"></i> Profili Düzenle</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
      </div>
      <div class="modal-body">
        <form id="profileEditForm" action="{{ url_for('update_profile') }}" method="POST" enctype="multipart/form-data">
          <div class="row">
            <!-- Sol Taraf - Profil Resmi -->
            <div class="col-md-5">
              <div class="profile-edit-avatar-container">
                <div class="profile-picture-upload">
                  {% if user.avatar_url %}
                    <img id="profileImagePreview" src="{{ user.avatar_url }}" alt="Profil Resmi" class="profile-upload-preview">
                  {% else %}
                    <img id="profileImagePreview" src="/static/images/default-avatar.png" alt="Profil Resmi" class="profile-upload-preview">
                  {% endif %}

                  <div class="profile-image-upload-controls mt-3">
                    <label for="profileImageInput" class="btn btn-primary btn-lg">
                      <i class="fas fa-camera"></i> Fotoğraf Yükle
                    </label>
                    <input type="file" id="profileImageInput" name="profile_image" accept="image/*" class="d-none">
                  </div>
                  <div class="avatar-help-text mt-2 text-muted">
                    Profil fotoğrafınızı değiştirmek için tıklayın
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Sağ Taraf - Profil Bilgileri -->
            <div class="col-md-7">
              <div class="profile-edit-form">
                <div class="form-group mb-4">
                  <label class="form-label"><i class="fas fa-user"></i> Kullanıcı Adı</label>
                  <input type="text" class="form-control form-control-lg" value="{{ user.username }}" disabled placeholder="Kullanıcı adınız" readonly>
                  <div class="form-text">Kullanıcı adınız değiştirilemez</div>
                </div>
                
                <div class="form-group mb-4">
                  <label class="form-label"><i class="fas fa-user"></i> Tam Ad</label>
                  <input type="text" class="form-control form-control-lg" name="full_name" value="{{ user.full_name or '' }}" placeholder="Adınız ve soyadınız">
                </div>
                
                <div class="form-group mb-4">
                  <label class="form-label"><i class="fas fa-envelope"></i> E-mail</label>
                  <input type="email" class="form-control form-control-lg" name="email" value="{{ user.email or '' }}" placeholder="E-mail adresiniz">
                </div>
              </div>
            </div>
          </div>
          
          <div class="profile-edit-actions mt-4">
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary btn-lg btn-save-profile">
                <i class="fas fa-save"></i> Değişiklikleri Kaydet
              </button>
              <button type="button" class="btn btn-outline-secondary btn-lg" data-bs-dismiss="modal">
                <i class="fas fa-times"></i> İptal Et
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
  /* Modal arkaplana ekstra opak katman ekleyelim */
  .modal-backdrop {
    background-color: rgba(0, 0, 0, 0.8) !important;
    backdrop-filter: blur(10px);
  }
  
  /* Profil düzenleme modalı */
  .profile-edit-modal {
    background-color: #1a1a2e;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  }
  
  .modal-header {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background-color: rgba(106, 90, 224, 0.1);
    border-radius: 15px 15px 0 0;
  }
  
  .modal-title {
    color: #fff;
    font-weight: 600;
  }
  
  .btn-close {
    filter: invert(1) grayscale(100%) brightness(200%);
  }
  
  /* Profil resmi yükleme */
  .profile-edit-avatar-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 20px;
    background-color: rgba(33, 33, 61, 0.5);
    padding: 25px;
    border-radius: 15px;
    text-align: center;
  }
  
  .profile-upload-preview {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid rgba(106, 90, 224, 0.5);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  }
  
  .profile-edit-form {
    background-color: rgba(33, 33, 61, 0.5);
    padding: 25px;
    border-radius: 15px;
  }
  
  .form-control {
    background-color: rgba(26, 26, 46, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #fff;
  }
  
  .form-control:focus {
    background-color: rgba(26, 26, 46, 0.9);
    border-color: rgba(106, 90, 224, 0.5);
    box-shadow: 0 0 0 0.25rem rgba(106, 90, 224, 0.25);
  }
  
  .form-control:disabled {
    background-color: rgba(26, 26, 46, 0.5);
    color: #8a8aa3;
  }
  
  .form-text {
    color: #8a8aa3;
  }
</style>

<!-- JavaScript for counter animation and image preview -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Profil resmi önizleme
    const profileImageInput = document.getElementById('profileImageInput');
    const profileImagePreview = document.getElementById('profileImagePreview');
    
    if (profileImageInput && profileImagePreview) {
      profileImageInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            profileImagePreview.src = e.target.result;
          }
          
          reader.readAsDataURL(this.files[0]);
        }
      });
    }
    
    // Counter animation for statistics
    const counterElements = document.querySelectorAll('.counter-animation');
    
    counterElements.forEach(el => {
      const target = parseInt(el.textContent, 10);
      const duration = 1500; // Animation duration in milliseconds
      const frameDuration = 1000/60; // 60fps
      const totalFrames = Math.round(duration / frameDuration);
      let frame = 0;
      
      // Starting value
      el.textContent = '0';
      
      // Animation function
      const counter = setInterval(() => {
        frame++;
        const progress = frame / totalFrames;
        const currentCount = Math.round(progress * target);
        
        // Update count
        if (currentCount <= target) {
          el.textContent = currentCount;
        }
        
        // End animation
        if (frame === totalFrames) {
          clearInterval(counter);
          el.textContent = target;
        }
      }, frameDuration);
    });
  });
</script>
{% endblock %}
