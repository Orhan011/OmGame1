
{% extends "layout.html" %}

{% block content %}
<div class="profile-container">
  <!-- Modern Profile Header with Animated Background -->
  <div class="profile-header-section">
    <div class="pattern-bg-animation">
      <div class="pattern-shape shape1"></div>
      <div class="pattern-shape shape2"></div>
      <div class="pattern-shape shape3"></div>
      <div class="pattern-shape shape4"></div>
    </div>
    
    <div class="profile-banner glass-card">
      <div class="profile-avatar-container">
        {% if user.avatar_url %}
          <img src="{{ user.avatar_url }}" alt="Profil" class="profile-avatar animate-pulse">
        {% else %}
          <div class="default-avatar animate-pulse">
            {{ user.username[0].upper() }}
          </div>
        {% endif %}
        <div class="profile-level-badge">{{ user.rank }}</div>
      </div>
      
      <div class="profile-basic-info">
        <h1 class="profile-username">{{ user.username }}</h1>
        <p class="join-date"><i class="fas fa-calendar-alt"></i> Katılım: {{ user.created_at.strftime('%d %B %Y') }}</p>
        <div class="last-active-status">
          <span class="status-indicator online"></span> Son Aktivite: {{ user.last_active.strftime('%d %B %Y, %H:%M') }}
        </div>
      </div>
      
      <div class="profile-actions">
        <button class="btn btn-edit-profile" data-bs-toggle="modal" data-bs-target="#editProfileModal">
          <i class="fas fa-edit"></i> Profili Düzenle
        </button>
      </div>
    </div>
  </div>

  <div class="profile-content">
    <!-- Left Panel: Personal Info -->
    <div class="profile-sidebar">
      <!-- Personal Information Card -->
      <div class="profile-card glass-card">
        <div class="card-header">
          <h3><i class="fas fa-user-circle"></i> Kişisel Bilgiler</h3>
        </div>
        <div class="profile-info-content">
          <div class="profile-info-item">
            <div class="info-icon"><i class="fas fa-user"></i></div>
            <div class="info-details">
              <div class="info-label">Kullanıcı Adı</div>
              <div class="info-value">{{ user.username }}</div>
            </div>
          </div>
          
          <div class="profile-info-item">
            <div class="info-icon"><i class="fas fa-user"></i></div>
            <div class="info-details">
              <div class="info-label">Ad Soyad</div>
              <div class="info-value">{{ user.full_name or 'Belirtilmedi' }}</div>
            </div>
          </div>
          
          <div class="profile-info-item">
            <div class="info-icon"><i class="fas fa-envelope"></i></div>
            <div class="info-details">
              <div class="info-label">E-mail</div>
              <div class="info-value">{{ user.email }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Panel: Recent Activities -->
    <div class="profile-main">
      <!-- Recent Activities Card -->
      <div class="recent-activity-card glass-card">
        <div class="card-header">
          <h3><i class="fas fa-history"></i> Son Aktiviteler</h3>
        </div>
        
        <div class="activity-content">
          {% if recent_scores %}
            <div class="activity-list">
              {% for score in recent_scores %}
              <div class="activity-item">
                <div class="activity-icon">
                  {% if score.game_type == 'wordPuzzle' %}
                    <i class="fas fa-font"></i>
                  {% elif score.game_type == 'memoryMatch' %}
                    <i class="fas fa-clone"></i>
                  {% elif score.game_type == 'numberSequence' %}
                    <i class="fas fa-sort-numeric-up"></i>
                  {% elif score.game_type == 'puzzle' %}
                    <i class="fas fa-puzzle-piece"></i>
                  {% elif score.game_type == '3dRotation' %}
                    <i class="fas fa-cube"></i>
                  {% else %}
                    <i class="fas fa-gamepad"></i>
                  {% endif %}
                </div>
                <div class="activity-details">
                  <div class="activity-game">
                    {% if score.game_type == 'wordPuzzle' %}
                      Kelime Bulmaca
                    {% elif score.game_type == 'memoryMatch' %}
                      Hafıza Kartları
                    {% elif score.game_type == 'numberSequence' %}
                      Sayı Dizisi
                    {% elif score.game_type == 'puzzle' %}
                      Yapboz
                    {% elif score.game_type == '3dRotation' %}
                      3D Döndürme
                    {% else %}
                      {{ score.game_type }}
                    {% endif %}
                  </div>
                  <div class="activity-score">{{ score.score }} puan</div>
                </div>
                <div class="activity-date">{{ score.timestamp.strftime('%d/%m/%Y %H:%M') }}</div>
              </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="no-activity">
              <i class="fas fa-info-circle"></i>
              <p>Henüz hiç oyun oynamadınız. Oynamaya başlayın ve skorlarınızı görün!</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Profil Düzenleme Modal - Dosya Yükleme Özelliği Eklenmiş -->
<div class="modal fade" id="editProfileModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content dark-theme">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-user-edit"></i> Profili Düzenle</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
      </div>
      <div class="modal-body">
        <form id="profileEditForm" action="{{ url_for('update_profile') }}" method="POST" enctype="multipart/form-data">
          <!-- Profil Resmi Seçimi ve Önizleme -->
          <div class="mb-4 text-center">
            <div class="profile-picture-upload">
              {% if user.avatar_url %}
                <img id="profileImagePreview" src="{{ user.avatar_url }}" alt="Profil Resmi" class="profile-upload-preview">
              {% else %}
                <img id="profileImagePreview" src="/static/images/default-avatar.png" alt="Profil Resmi" class="profile-upload-preview">
              {% endif %}

              <div class="profile-image-upload-controls">
                <label for="profileImageInput" class="btn btn-upload">
                  <i class="fas fa-camera"></i> Resim Seç
                </label>
                <input type="file" id="profileImageInput" name="profile_image" accept="image/*" class="d-none">
              </div>
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label"><i class="fas fa-user"></i> Tam Ad</label>
            <input type="text" class="form-control form-control-lg" name="full_name" value="{{ user.full_name or '' }}" placeholder="Adınız ve soyadınız">
          </div>
          
          <div class="mb-3">
            <label class="form-label"><i class="fas fa-envelope"></i> E-mail</label>
            <input type="email" class="form-control form-control-lg" name="email" value="{{ user.email or '' }}" placeholder="E-mail adresiniz">
          </div>
          
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary btn-lg">
              <i class="fas fa-save"></i> Değişiklikleri Kaydet
            </button>
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
              <i class="fas fa-times"></i> İptal Et
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript for counter animation and image preview -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Profil resmi önizleme
    const profileImageInput = document.getElementById('profileImageInput');
    const profileImagePreview = document.getElementById('profileImagePreview');
    
    if (profileImageInput && profileImagePreview) {
      profileImageInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            profileImagePreview.src = e.target.result;
          }
          
          reader.readAsDataURL(this.files[0]);
        }
      });
    }
    
    // Counter animation for statistics
    const counterElements = document.querySelectorAll('.counter-animation');
    
    counterElements.forEach(el => {
      const target = parseInt(el.textContent, 10);
      const duration = 1500; // Animation duration in milliseconds
      const frameDuration = 1000/60; // 60fps
      const totalFrames = Math.round(duration / frameDuration);
      let frame = 0;
      
      // Starting value
      el.textContent = '0';
      
      // Animation function
      const counter = setInterval(() => {
        frame++;
        const progress = frame / totalFrames;
        const currentCount = Math.round(progress * target);
        
        // Update count
        if (currentCount <= target) {
          el.textContent = currentCount;
        }
        
        // End animation
        if (frame === totalFrames) {
          clearInterval(counter);
          el.textContent = target;
        }
      }, frameDuration);
    });
  });
</script>
{% endblock %}
