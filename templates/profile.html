{% extends 'layout.html' %}

{% block content %}
{% set current_year = 2025 %}
<div class="profile-container">
  <div class="row">
    <!-- Sol Taraf: Kullanıcı Bilgileri -->
    <div class="col-lg-4 mb-4">
      <div class="card glass-card">
        <div class="card-body text-center">
          <div class="profile-avatar-container mb-4" id="profileAvatarContainer">
            {% if user.avatar_url %}
              <img src="{{ user.avatar_url }}?v={{ user.last_active|int }}" alt="{{ user.username }}" class="profile-avatar">
            {% else %}
              <div class="profile-avatar-placeholder">
                <i class="fas fa-user fa-4x"></i>
              </div>
            {% endif %}
            <div class="profile-avatar-overlay">
              <i class="fas fa-camera"></i>
              <span>Fotoğraf Değiştir</span>
            </div>
          </div>

          <h3 class="profile-username mb-2">{{ user.username }}</h3>
          <p class="profile-email mb-3">{{ user.email }}</p>

          <div class="profile-stats mb-4">
            <div class="row g-0">
              <div class="col">
                <div class="profile-stat">
                  <div class="stat-value">{{ stats.total_games }}</div>
                  <div class="stat-label">Oyun</div>
                </div>
              </div>
              <div class="col">
                <div class="profile-stat">
                  <div class="stat-value">{{ stats.high_score }}</div>
                  <div class="stat-label">En Yüksek Puan</div>
                </div>
              </div>
              <div class="col">
                <div class="profile-stat">
                  <div class="stat-value">{{ stats.experience_points }}</div>
                  <div class="stat-label">XP</div>
                </div>
              </div>
            </div>
          </div>

          <div class="profile-rank mb-4">
            <span class="rank-badge">{{ stats.rank }}</span>
          </div>

          <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#editProfileModal">
            <i class="fas fa-edit me-2"></i>Profili Düzenle
          </button>
        </div>
      </div>
    </div>

    <!-- Sağ Taraf: Skorlar ve İstatistikler -->
    <div class="col-lg-8">
      <div class="card glass-card mb-4">
        <div class="card-header">
          <h4 class="mb-0"><i class="fas fa-trophy me-2"></i>Oyun Skorları</h4>
        </div>
        <div class="card-body">
          <ul class="nav nav-tabs" id="gameTabs" role="tablist">
            {% for game_type in game_types %}
            <li class="nav-item" role="presentation">
              <button class="nav-link {% if loop.first %}active{% endif %}" 
                      id="{{ game_type }}-tab" 
                      data-bs-toggle="tab" 
                      data-bs-target="#{{ game_type }}-content" 
                      type="button" 
                      role="tab" 
                      aria-controls="{{ game_type }}-content" 
                      aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
                {% if game_type == 'wordPuzzle' %}
                  <i class="fas fa-spell-check me-1"></i>Kelime Bulmaca
                {% elif game_type == 'memoryMatch' %}
                  <i class="fas fa-clone me-1"></i>Hafıza Kartları
                {% elif game_type == 'labyrinth' %}
                  <i class="fas fa-route me-1"></i>Labirent
                {% elif game_type == 'puzzle' %}
                  <i class="fas fa-puzzle-piece me-1"></i>Yapboz
                {% elif game_type == '3dRotation' %}
                  <i class="fas fa-cube me-1"></i>3D Döndürme
                {% else %}
                  {{ game_type }}
                {% endif %}
              </button>
            </li>
            {% endfor %}
          </ul>

          <div class="tab-content p-3" id="gameTabsContent">
            {% for game_type in game_types %}
            <div class="tab-pane fade {% if loop.first %}show active{% endif %}" 
                 id="{{ game_type }}-content" 
                 role="tabpanel" 
                 aria-labelledby="{{ game_type }}-tab">

              <div class="game-score-summary mb-4">
                <div class="row align-items-center">
                  <div class="col-md-4 text-center mb-3 mb-md-0">
                    <div class="highest-score-display">
                      <div class="score-value">{{ scores[game_type].highest }}</div>
                      <div class="score-label">En Yüksek Puan</div>
                    </div>
                  </div>
                  <div class="col-md-8">
                    <div class="progress-container">
                      {% if game_type == 'wordPuzzle' %}
                        {% set next_milestone = 500 %}
                      {% elif game_type == 'memoryMatch' %}
                        {% set next_milestone = 1000 %}
                      {% elif game_type == 'labyrinth' %}
                        {% set next_milestone = 800 %}
                      {% elif game_type == 'puzzle' %}
                        {% set next_milestone = 1500 %}
                      {% else %}
                        {% set next_milestone = 2000 %}
                      {% endif %}

                      {% set progress = (scores[game_type].highest / next_milestone * 100)|int if scores[game_type].highest > 0 else 0 %}

                      <div class="progress-label d-flex justify-content-between mb-1">
                        <span>İlerleme</span>
                        <span>{{ progress }}%</span>
                      </div>
                      <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" 
                             style="width: {{ progress }}%" 
                             aria-valuenow="{{ progress }}" 
                             aria-valuemin="0" 
                             aria-valuemax="100"></div>
                      </div>
                      <div class="progress-description mt-1">
                        <small>Bir sonraki seviye: {{ next_milestone }} puan</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <h5 class="mb-3"><i class="fas fa-history me-2"></i>Son Skorlar</h5>

              {% if scores[game_type].recent %}
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Puan</th>
                        <th>Tarih</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for score in scores[game_type].recent %}
                      <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ score.score }}</td>
                        <td>{{ score.timestamp.strftime('%d.%m.%Y %H:%M') }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              {% else %}
                <div class="text-center py-4">
                  <div class="empty-state">
                    <i class="fas fa-gamepad fa-3x mb-3"></i>
                    <p>Henüz bu oyunda skor kaydınız bulunmuyor.</p>
                    {% if game_type == 'wordPuzzle' %}
                      <a href="{{ url_for('word_puzzle') }}" class="btn btn-primary btn-sm">Oynamak İçin Tıklayın</a>
                    {% elif game_type == 'memoryMatch' %}
                      <a href="{{ url_for('memory_match') }}" class="btn btn-primary btn-sm">Oynamak İçin Tıklayın</a>
                    {% elif game_type == 'labyrinth' %}
                      <a href="{{ url_for('labyrinth') }}" class="btn btn-primary btn-sm">Oynamak İçin Tıklayın</a>
                    {% elif game_type == 'puzzle' %}
                      <a href="{{ url_for('puzzle') }}" class="btn btn-primary btn-sm">Oynamak İçin Tıklayın</a>
                    {% elif game_type == '3dRotation' %}
                      <a href="{{ url_for('three_d_rotation') }}" class="btn btn-primary btn-sm">Oynamak İçin Tıklayın</a>
                    {% endif %}
                  </div>
                </div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="card glass-card">
        <div class="card-header">
          <h4 class="mb-0"><i class="fas fa-chart-line me-2"></i>İstatistikler</h4>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-4">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="stat-info">
                  <div class="stat-label">Kayıt Tarihi</div>
                  <div class="stat-value">{{ user.created_at.strftime('%d.%m.%Y') }}</div>
                </div>
              </div>
            </div>

            <div class="col-md-6 mb-4">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-clock"></i>
                </div>
                <div class="stat-info">
                  <div class="stat-label">Son Aktivite</div>
                  <div class="stat-value">{{ user.last_active.strftime('%d.%m.%Y %H:%M') }}</div>
                </div>
              </div>
            </div>

            <div class="col-md-6 mb-4">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-birthday-cake"></i>
                </div>
                <div class="stat-info">
                  <div class="stat-label">Doğum Yılı</div>
                  <div class="stat-value">{{ user.birth_year or 'Belirtilmemiş' }}</div>
                </div>
              </div>
            </div>

            <div class="col-md-6 mb-4">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-gamepad"></i>
                </div>
                <div class="stat-info">
                  <div class="stat-label">Toplam Oyun</div>
                  <div class="stat-value">{{ stats.total_games }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Gelişmiş Profil Düzenleme Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProfileModalLabel"><i class="fas fa-user-edit"></i> Profil Bilgilerini Düzenle</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body pb-4">
        <form action="{{ url_for('update_profile') }}" method="POST" enctype="multipart/form-data" id="profileForm">
          
          <!-- Profil Resmi Yükleme Alanı -->
          <div class="text-center mb-4">
            <div class="profile-avatar-container mx-auto position-relative" style="width: 150px; height: 150px;">
              {% if user.avatar_url %}
                <img src="{{ user.avatar_url }}" alt="{{ user.username }}" id="avatarPreview" class="profile-avatar-img rounded-circle border shadow" style="width: 100%; height: 100%; object-fit: cover;">
              {% else %}
                <div class="profile-avatar-placeholder rounded-circle d-flex align-items-center justify-content-center shadow" id="avatarPlaceholder" style="width: 100%; height: 100%; background-color: #6a5ae0;">
                  <i class="fas fa-user fa-3x text-white"></i>
                </div>
                <img src="" alt="" id="avatarPreview" class="profile-avatar-img rounded-circle border shadow d-none" style="width: 100%; height: 100%; object-fit: cover;">
              {% endif %}
              
              <!-- Fotoğraf değiştirme overlay -->
              <div class="profile-avatar-overlay">
                <i class="fas fa-camera"></i>
                <span class="d-block mt-1 small">Değiştir</span>
              </div>
            </div>
            
            <div class="mt-3 d-flex justify-content-center">
              <div class="btn-group">
                <label for="profile_image" class="btn btn-primary btn-sm">
                  <i class="fas fa-upload me-1"></i> Fotoğraf Yükle
                </label>
                <button type="button" class="btn btn-danger btn-sm" id="removePhotoBtn">
                  <i class="fas fa-trash-alt me-1"></i> Kaldır
                </button>
              </div>
            </div>
            <input type="file" id="profile_image" name="profile_image" accept="image/jpeg, image/png" class="d-none">
            <small class="text-muted d-block mt-2"><i class="fas fa-info-circle me-1"></i> JPG veya PNG, maksimum 500 KB</small>
            
            <!-- Hidden field for photo removal -->
            <input type="hidden" id="remove_photo" name="remove_photo" value="0">
          </div>
          
          <hr class="my-4">
          
          <!-- Kişisel Bilgiler -->
          <div class="container px-4">
            <h6 class="mb-3"><i class="fas fa-id-card me-2"></i>Kişisel Bilgiler</h6>
            
            <!-- Kullanıcı Adı -->
            <div class="mb-3">
              <label for="profile_username" class="form-label fw-bold">
                <i class="fas fa-user me-2"></i>Kullanıcı Adı
              </label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-at"></i></span>
                <input type="text" class="form-control" id="profile_username" name="username" value="{{ user.username }}" required>
              </div>
              <small class="form-text text-muted">Kullanıcı adınız en az 3, en fazla 20 karakter olmalıdır.</small>
            </div>
            
            <!-- Email - Readonly -->
            <div class="mb-3">
              <label for="profile_email" class="form-label fw-bold">
                <i class="fas fa-envelope me-2"></i>Email
              </label>
              <input type="email" class="form-control bg-light" id="profile_email" value="{{ user.email }}" readonly>
              <small class="form-text text-muted">Email adresiniz değiştirilemez.</small>
            </div>
            
            <!-- Doğum Yılı -->
            <div class="mb-3">
              <label for="profile_birth_year" class="form-label fw-bold">
                <i class="fas fa-birthday-cake me-2"></i>Doğum Yılı
              </label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                <input type="number" class="form-control" id="profile_birth_year" name="birth_year" value="{{ user.birth_year or '' }}" min="1900" max="2025" placeholder="örn. 1990">
              </div>
              <small class="form-text text-muted">İstatistikler için kullanılacaktır, zorunlu değildir.</small>
            </div>
          </div>
          
          <!-- Butonlar -->
          <div class="text-end mt-4 px-4">
            <button type="button" class="btn btn-outline-secondary me-2" data-bs-dismiss="modal">
              <i class="fas fa-times me-2"></i>İptal
            </button>
            <button type="submit" class="btn btn-success" id="profileSaveBtn">
              <i class="fas fa-save me-2"></i>Kaydet
              <span class="spinner-border spinner-border-sm d-none ms-1" role="status" aria-hidden="true" id="saveSpinner"></span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Gelişmiş profil sayfası JavaScript
    const profileForm = document.getElementById('profileForm');
    const profileImage = document.getElementById('profile_image');
    const avatarPreview = document.getElementById('avatarPreview');
    const avatarPlaceholder = document.getElementById('avatarPlaceholder');
    const removePhotoBtn = document.getElementById('removePhotoBtn');
    const removePhotoInput = document.getElementById('remove_photo');
    const profileUsername = document.getElementById('profile_username');
    const profileBirthYear = document.getElementById('profile_birth_year');
    const profileSaveBtn = document.getElementById('profileSaveBtn');
    const saveSpinner = document.getElementById('saveSpinner');
    const avatarOverlay = document.querySelector('.profile-avatar-overlay');
    
    // Fotoğraf yükleme işlemleri - fotoğrafı overlay alanına tıklayarak da yükleyebilme
    if (avatarOverlay) {
      avatarOverlay.addEventListener('click', function() {
        if (profileImage) {
          profileImage.click();
        }
      });
    }
    
    // Profil fotoğrafı işlemleri
    if (profileImage) {
      const handleImageUpload = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        // Check file size (500KB = 512000 bytes)
        if (file.size > 512000) {
          Swal.fire({
            title: 'Dosya çok büyük',
            text: 'Lütfen 500KB\'dan küçük bir dosya seçin',
            icon: 'error'
          });
          return;
        }
        
        // Check file type
        if (!['image/jpeg', 'image/png'].includes(file.type)) {
          Swal.fire({
            title: 'Geçersiz dosya tipi',
            text: 'Lütfen JPG veya PNG formatında bir dosya seçin',
            icon: 'error'
          });
          return;
        }
        
        // Show loading state
        Swal.fire({
          title: 'Yükleniyor...',
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
          }
        });
        
        // Create FormData and submit
        const formData = new FormData();
        formData.append('profile_image', file);
        
        fetch('/update-profile', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            location.reload();
          } else {
            Swal.fire({
              title: 'Hata',
              text: data.message || 'Bir hata oluştu',
              icon: 'error'
            });
          }
        })
        .catch(error => {
          Swal.fire({
            title: 'Hata',
            text: 'Yükleme sırasında bir hata oluştu',
            icon: 'error'
          });
        });
      };
      
      profileImage.addEventListener('change', handleImageUpload);
        if (e.target.files.length > 0) {
          const file = e.target.files[0];
          
          // Dosya boyutu kontrolü (500KB = 512000 bytes)
          if (file.size > 512000) {
            Swal.fire({
              title: 'Dosya Boyutu Fazla',
              text: 'Dosya boyutu 500KB\'dan küçük olmalıdır. Lütfen daha küçük bir dosya seçin.',
              icon: 'error',
              confirmButtonText: 'Tamam',
              confirmButtonColor: '#6a5ae0'
            });
            return;
          }
          
          // Dosya tipi kontrolü
          if (!['image/jpeg', 'image/png'].includes(file.type)) {
            Swal.fire({
              title: 'Desteklenmeyen Dosya Formatı',
              text: 'Lütfen JPG veya PNG formatında bir dosya seçin.',
              icon: 'error',
              confirmButtonText: 'Tamam',
              confirmButtonColor: '#6a5ae0'
            });
            return;
          }
          
          const reader = new FileReader();
          reader.onload = function(e) {
            if (avatarPreview) {
              avatarPreview.src = e.target.result;
              avatarPreview.classList.remove('d-none');
            }
            
            if (avatarPlaceholder) {
              avatarPlaceholder.classList.add('d-none');
            }
            
            // Fotoğrafı kaldırma bayrağını sıfırla
            if (removePhotoInput) {
              removePhotoInput.value = '0';
            }
          };
          
          reader.readAsDataURL(file);
        }
      });
    }
    
    // Fotoğraf kaldır butonu
    if (removePhotoBtn) {
      removePhotoBtn.addEventListener('click', function(e) {
        e.preventDefault(); // Butonun form submit etmesini engelle
        
        Swal.fire({
          title: 'Profil Fotoğrafını Kaldır',
          text: 'Profil fotoğrafınızı kaldırmak istediğinize emin misiniz?',
          icon: 'question',
          showCancelButton: true,
          confirmButtonText: 'Evet, Kaldır',
          cancelButtonText: 'İptal',
          confirmButtonColor: '#d33',
          cancelButtonColor: '#3085d6'
        }).then((result) => {
          if (result.isConfirmed) {
            if (avatarPreview) {
              avatarPreview.classList.add('d-none');
              avatarPreview.src = '';
            }
            
            if (avatarPlaceholder) {
              avatarPlaceholder.classList.remove('d-none');
            }
            
            if (profileImage) {
              profileImage.value = '';
            }
            
            if (removePhotoInput) {
              removePhotoInput.value = '1';
            }
            
            // Bildirim göster
            Swal.fire({
              position: 'top-end',
              icon: 'success',
              title: 'Fotoğraf kaldırıldı',
              text: 'Kaydetmek için değişiklikleri kaydedin',
              showConfirmButton: false,
              timer: 1500
            });
          }
        });
      });
    }
    
    // Form event listeners
    if (profileForm) {
      profileForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!this.checkValidity()) {
          e.stopPropagation();
          this.classList.add('was-validated');
          return;
        }
        
        if (saveSpinner) {
          saveSpinner.classList.remove('d-none');
        }
        
        if (profileSaveBtn) {
          profileSaveBtn.disabled = true;
        }
        
        this.submit();
      });
    }
    
    // Profile photo upload handler
    const handleProfilePhotoUpload = (file) => {
      if (!file) return;
      
      if (file.size > 512000) {
        Swal.fire({
          title: 'Dosya çok büyük',
          text: 'Lütfen 500KB\'dan küçük bir dosya seçin',
          icon: 'error'
        });
        return;
      }
      
      if (!['image/jpeg', 'image/png'].includes(file.type)) {
        Swal.fire({
          title: 'Geçersiz dosya tipi',
          text: 'Lütfen JPG veya PNG formatında bir dosya seçin',
          icon: 'error'
        });
        return;
      }

      const formData = new FormData();
      formData.append('profile_image', file);
      
      fetch('/update-profile', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          location.reload();
        }
      });
    };

    // Username validation
    if (profileUsername) {
      profileUsername.addEventListener('input', function() {
        const username = this.value.trim();
        const usernameHelp = this.nextElementSibling;
        
        if (username.length < 3) {
          this.setCustomValidity('Kullanıcı adı en az 3 karakter olmalıdır.');
          if (usernameHelp) {
            usernameHelp.innerHTML = 'Kullanıcı adı en az 3 karakter olmalıdır.';
            usernameHelp.classList.add('text-danger');
          }
        } else if (username.length > 20) {
          this.setCustomValidity('Kullanıcı adı en fazla 20 karakter olmalıdır.');
          if (usernameHelp) {
            usernameHelp.innerHTML = 'Kullanıcı adı en fazla 20 karakter olmalıdır.';
            usernameHelp.classList.add('text-danger');
          }
        } else if (!/^[a-zA-Z0-9_]+$/.test(username)) {
          this.setCustomValidity('Kullanıcı adı sadece harf, rakam ve alt çizgi (_) içerebilir.');
          if (usernameHelp) {
            usernameHelp.innerHTML = 'Kullanıcı adı sadece harf, rakam ve alt çizgi (_) içerebilir.';
            usernameHelp.classList.add('text-danger');
          }
        } else {
          this.setCustomValidity('');
          if (usernameHelp) {
            usernameHelp.innerHTML = 'Kullanıcı adınız geçerli.';
            usernameHelp.classList.remove('text-danger');
            usernameHelp.classList.add('text-success');
          }
        }
      });
    }
        e.preventDefault();
        
        // Form doğrulaması
        if (!this.checkValidity()) {
          e.stopPropagation();
          this.classList.add('was-validated');
          return;
        }
        
        // Yükleniyor göstergesi
        if (saveSpinner) {
          saveSpinner.classList.remove('d-none');
        }
        
        if (profileSaveBtn) {
          profileSaveBtn.disabled = true;
        }
        
        // Formu gönder
        this.submit();
      });
    }
    
    // Kullanıcı adı kontrolü
    if (profileUsername) {
      profileUsername.addEventListener('input', function() {
        const username = this.value.trim();
        const usernameHelp = this.nextElementSibling;
        
        if (username.length < 3) {
          this.setCustomValidity('Kullanıcı adı en az 3 karakter olmalıdır.');
          if (usernameHelp) {
            usernameHelp.innerHTML = 'Kullanıcı adı en az 3 karakter olmalıdır.';
            usernameHelp.classList.add('text-danger');
          }
        } else if (username.length > 20) {
          this.setCustomValidity('Kullanıcı adı en fazla 20 karakter olmalıdır.');
          if (usernameHelp) {
            usernameHelp.innerHTML = 'Kullanıcı adı en fazla 20 karakter olmalıdır.';
            usernameHelp.classList.add('text-danger');
          }
        } else if (!/^[a-zA-Z0-9_]+$/.test(username)) {
          this.setCustomValidity('Kullanıcı adı sadece harf, rakam ve alt çizgi (_) içerebilir.');
          if (usernameHelp) {
            usernameHelp.innerHTML = 'Kullanıcı adı sadece harf, rakam ve alt çizgi (_) içerebilir.';
            usernameHelp.classList.add('text-danger');
          }
        } else {
          this.setCustomValidity('');
          if (usernameHelp) {
            usernameHelp.innerHTML = 'Kullanıcı adınız geçerli.';
            usernameHelp.classList.remove('text-danger');
            usernameHelp.classList.add('text-success');
          }
        }
      });
      
      // İlk yüklemede kontrol et
      profileUsername.dispatchEvent(new Event('input'));
    }
    
    // Doğum yılı kontrolü
    if (profileBirthYear) {
      profileBirthYear.addEventListener('input', function() {
        const year = parseInt(this.value);
        const currentYear = new Date().getFullYear();
        
        if (isNaN(year)) {
          this.setCustomValidity('');
        } else if (year < 1900) {
          this.setCustomValidity('Doğum yılı 1900\'den küçük olamaz.');
        } else if (year > currentYear) {
          this.setCustomValidity('Doğum yılı günümüzden ileri olamaz.');
        } else {
          this.setCustomValidity('');
        }
      });
    }

    // Tab değişiminde aktif sekmeyi URL'ye ekle
    const gameTabs = document.querySelectorAll('#gameTabs .nav-link');
    if (gameTabs.length > 0) {
      gameTabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const gameType = this.id.replace('-tab', '');
          history.replaceState(null, null, '#' + gameType);
        });
      });

      // Sayfa yüklendiğinde URL'de sekme varsa ona git
      if (location.hash) {
        const tabId = location.hash.substring(1) + '-tab';
        const tab = document.getElementById(tabId);
        if (tab) {
          const tabTrigger = new bootstrap.Tab(tab);
          tabTrigger.show();
        }
      }
    }
  });
</script>
{% endblock %}