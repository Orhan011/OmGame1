
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Şifre Sıfırlama</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    .password-strength-meter {
      height: 5px;
      width: 100%;
      background-color: #ddd;
      border-radius: 3px;
      margin-top: 8px;
      position: relative;
      overflow: hidden;
    }
    
    .password-strength-meter::before {
      content: '';
      position: absolute;
      left: 0;
      height: 100%;
      width: 0;
      background-color: #f00;
      transition: width 0.3s ease, background-color 0.3s ease;
      border-radius: 3px;
    }
    
    .password-strength-meter.weak::before {
      width: 25%;
      background-color: #f00;
    }
    
    .password-strength-meter.medium::before {
      width: 50%;
      background-color: #ff9800;
    }
    
    .password-strength-meter.strong::before {
      width: 75%;
      background-color: #2196F3;
    }
    
    .password-strength-meter.very-strong::before {
      width: 100%;
      background-color: #4CAF50;
    }
    
    .password-strength-text {
      font-size: 0.75rem;
      margin-top: 5px;
      display: none;
    }
    
    .password-requirements {
      margin-top: 15px;
      padding: 10px;
      font-size: 0.8rem;
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: 5px;
    }
    
    .requirement {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
      color: rgba(255, 255, 255, 0.7);
    }
    
    .requirement i {
      margin-right: 8px;
      font-size: 0.75rem;
    }
    
    .requirement.met {
      color: #4CAF50;
    }
    
    .requirement.met i {
      color: #4CAF50;
    }
  </style>
</head>
<body class="auth-only-body">
  <div class="fullscreen-auth">
    <div class="auth-container">
      <div class="auth-card glass-card">
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" class="auth-logo-small">
        
        <div class="auth-header">
          <h2>Yeni Şifre Oluştur</h2>
          <p class="auth-subtitle">Lütfen yeni şifrenizi belirleyin</p>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category if category != '_' else 'info' }} alert-dismissible fade show">
                <i class="fas {% if category == 'danger' %}fa-exclamation-circle{% elif category == 'success' %}fa-check-circle{% else %}fa-info-circle{% endif %} me-2"></i>
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Kapat"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}
        
        <form action="{{ url_for('reset_password') }}" method="POST" class="auth-form" id="reset-form">
          <input type="hidden" name="email" value="{{ email }}">
          <input type="hidden" name="token" value="{{ token }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
          
          <div class="form-group floating-label">
            <div class="input-icon-wrapper">
              <i class="fas fa-lock input-icon"></i>
              <input type="password" id="password" name="password" class="form-control" placeholder=" " required minlength="8">
              <label for="password">Yeni Şifre</label>
              <button type="button" class="password-toggle" onclick="togglePasswordVisibility('password')">
                <i class="fas fa-eye" id="password-toggle-icon"></i>
              </button>
            </div>
            <div class="password-strength-meter" id="password-meter"></div>
            <small class="password-strength-text" id="password-strength-text"></small>
            
            <div class="password-requirements" id="password-requirements">
              <div class="requirement" id="length-requirement">
                <i class="fas fa-circle"></i> En az 8 karakter
              </div>
              <div class="requirement" id="uppercase-requirement">
                <i class="fas fa-circle"></i> En az 1 büyük harf
              </div>
              <div class="requirement" id="lowercase-requirement">
                <i class="fas fa-circle"></i> En az 1 küçük harf
              </div>
              <div class="requirement" id="number-requirement">
                <i class="fas fa-circle"></i> En az 1 rakam
              </div>
              <div class="requirement" id="special-requirement">
                <i class="fas fa-circle"></i> En az 1 özel karakter (!@#$%^&*)
              </div>
            </div>
          </div>
          
          <div class="form-group floating-label">
            <div class="input-icon-wrapper">
              <i class="fas fa-lock input-icon"></i>
              <input type="password" id="confirm_password" name="confirm_password" class="form-control" placeholder=" " required minlength="8">
              <label for="confirm_password">Şifre Tekrar</label>
              <button type="button" class="password-toggle" onclick="togglePasswordVisibility('confirm_password')">
                <i class="fas fa-eye" id="confirm-password-toggle-icon"></i>
              </button>
            </div>
            <div id="password-match-feedback" class="password-match-indicator"></div>
          </div>
          
          <button type="submit" class="btn btn-primary btn-block btn-animated" id="submit-button" disabled>
            <span class="btn-text">Şifreyi Değiştir</span>
            <i class="fas fa-check-circle btn-icon"></i>
          </button>
        </form>
        
        <div class="auth-links">
          <a href="{{ url_for('login') }}" class="back-link">
            <i class="fas fa-arrow-left"></i> Giriş Sayfasına Dön
          </a>
        </div>
      </div>
    </div>
  </div>

  <script>
    function togglePasswordVisibility(inputId) {
      const passwordInput = document.getElementById(inputId);
      const toggleIcon = document.getElementById(inputId === 'password' ? 'password-toggle-icon' : 'confirm-password-toggle-icon');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.classList.replace('fa-eye', 'fa-eye-slash');
      } else {
        passwordInput.type = 'password';
        toggleIcon.classList.replace('fa-eye-slash', 'fa-eye');
      }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('reset-form');
      const passwordInput = document.getElementById('password');
      const confirmPasswordInput = document.getElementById('confirm_password');
      const submitButton = document.getElementById('submit-button');
      const passwordMeter = document.getElementById('password-meter');
      const passwordStrengthText = document.getElementById('password-strength-text');
      const passwordMatchFeedback = document.getElementById('password-match-feedback');
      
      // Şifre gücü göstergeleri
      const lengthRequirement = document.getElementById('length-requirement');
      const uppercaseRequirement = document.getElementById('uppercase-requirement');
      const lowercaseRequirement = document.getElementById('lowercase-requirement');
      const numberRequirement = document.getElementById('number-requirement');
      const specialRequirement = document.getElementById('special-requirement');
      
      // Şifre gereksinimleri kontrolü
      const requirements = {
        length: false,
        uppercase: false,
        lowercase: false,
        number: false,
        special: false,
        match: false
      };
      
      // Şifre değiştiğinde gereksinim kontrollerini güncelle
      passwordInput.addEventListener('input', function() {
        const password = this.value;
        
        // Gereksinimleri kontrol et
        requirements.length = password.length >= 8;
        requirements.uppercase = /[A-Z]/.test(password);
        requirements.lowercase = /[a-z]/.test(password);
        requirements.number = /[0-9]/.test(password);
        requirements.special = /[!@#$%^&*]/.test(password);
        
        // Gereksinimleri görsel olarak güncelle
        updateRequirement(lengthRequirement, requirements.length);
        updateRequirement(uppercaseRequirement, requirements.uppercase);
        updateRequirement(lowercaseRequirement, requirements.lowercase);
        updateRequirement(numberRequirement, requirements.number);
        updateRequirement(specialRequirement, requirements.special);
        
        // Şifre gücünü hesapla ve göstergeyi güncelle
        updatePasswordStrength(password);
        
        // Şifrelerin eşleşip eşleşmediğini kontrol et
        checkPasswordMatch();
        
        // Gönder butonunun durumunu güncelle
        updateSubmitButton();
      });
      
      // Onay şifresi değiştiğinde eşleşip eşleşmediğini kontrol et
      confirmPasswordInput.addEventListener('input', function() {
        checkPasswordMatch();
        updateSubmitButton();
      });
      
      // Şifrelerin eşleşip eşleşmediğini kontrol et
      function checkPasswordMatch() {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        
        if (confirmPassword.length === 0) {
          passwordMatchFeedback.textContent = '';
          passwordMatchFeedback.className = 'password-match-indicator';
          requirements.match = false;
        } else if (password === confirmPassword) {
          passwordMatchFeedback.textContent = 'Şifreler eşleşiyor';
          passwordMatchFeedback.className = 'password-match-indicator text-success';
          requirements.match = true;
        } else {
          passwordMatchFeedback.textContent = 'Şifreler eşleşmiyor';
          passwordMatchFeedback.className = 'password-match-indicator text-danger';
          requirements.match = false;
        }
      }
      
      // Şifre gücünü hesapla ve görsel olarak güncelle
      function updatePasswordStrength(password) {
        // Şifre gücünü hesapla (basit versiyonu)
        let strength = 0;
        
        if (password.length >= 8) strength += 1;
        if (password.length >= 12) strength += 1;
        if (/[A-Z]/.test(password)) strength += 1;
        if (/[a-z]/.test(password)) strength += 1;
        if (/[0-9]/.test(password)) strength += 1;
        if (/[!@#$%^&*]/.test(password)) strength += 1;
        
        // Şifre gücü sınıfını belirle
        passwordMeter.className = 'password-strength-meter';
        passwordStrengthText.style.display = 'block';
        
        if (password.length === 0) {
          passwordMeter.className = 'password-strength-meter';
          passwordStrengthText.style.display = 'none';
        } else if (strength < 3) {
          passwordMeter.className = 'password-strength-meter weak';
          passwordStrengthText.textContent = 'Zayıf';
          passwordStrengthText.style.color = '#f00';
        } else if (strength < 4) {
          passwordMeter.className = 'password-strength-meter medium';
          passwordStrengthText.textContent = 'Orta';
          passwordStrengthText.style.color = '#ff9800';
        } else if (strength < 5) {
          passwordMeter.className = 'password-strength-meter strong';
          passwordStrengthText.textContent = 'Güçlü';
          passwordStrengthText.style.color = '#2196F3';
        } else {
          passwordMeter.className = 'password-strength-meter very-strong';
          passwordStrengthText.textContent = 'Çok Güçlü';
          passwordStrengthText.style.color = '#4CAF50';
        }
      }
      
      // Bir gereksinim görsel olarak güncelle
      function updateRequirement(element, isMet) {
        if (isMet) {
          element.classList.add('met');
          element.querySelector('i').className = 'fas fa-check-circle';
        } else {
          element.classList.remove('met');
          element.querySelector('i').className = 'fas fa-circle';
        }
      }
      
      // Gönder butonunun durumunu güncelle
      function updateSubmitButton() {
        const allRequirementsMet = Object.values(requirements).every(Boolean);
        
        if (allRequirementsMet) {
          submitButton.disabled = false;
        } else {
          submitButton.disabled = true;
        }
      }
      
      // Form gönderilmeden önce son kontroller
      form.addEventListener('submit', function(e) {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        
        // Tüm gereksinimler karşılanıyor mu kontrol et
        const allRequirementsMet = 
          requirements.length && 
          requirements.uppercase && 
          requirements.lowercase && 
          requirements.number && 
          requirements.special;
        
        if (!allRequirementsMet) {
          e.preventDefault();
          alert('Lütfen tüm şifre gereksinimlerini karşıladığınızdan emin olun.');
          return false;
        }
        
        if (password !== confirmPassword) {
          e.preventDefault();
          alert('Şifreler eşleşmiyor. Lütfen kontrol edin.');
          return false;
        }
      });
    });
  </script>
</body>
</html>
