{% extends "layout.html" %}

{% block extra_css %}
<style>
  /* Özelleştirme kontrolleri */
  .customize-controls {
    display: flex;
    align-items: center;
  }
  
  /* Oyun kartları için kaldırma düğmesi */
  .remove-game-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: rgba(255, 255, 255, 0.8);
    width: 25px;
    height: 25px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    padding: 0;
    opacity: 0;
    transition: all 0.2s ease;
    z-index: 5;
  }
  
  .game-card:hover .remove-game-btn {
    opacity: 1;
  }
  
  .remove-game-btn:hover {
    background: rgba(255, 0, 0, 0.7);
    color: white;
  }
  
  /* Oyun Ekleme Kartı */
  .add-game-card {
    background: rgba(40, 40, 55, 0.3);
    border: 2px dashed rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .add-game-card:hover {
    background: rgba(106, 90, 205, 0.2);
    border-color: rgba(106, 90, 205, 0.5);
    transform: translateY(-5px);
  }
  
  .add-game-content {
    text-align: center;
    color: rgba(255, 255, 255, 0.7);
  }
  
  .add-game-content i {
    font-size: 2rem;
    margin-bottom: 10px;
    color: rgba(106, 90, 205, 0.7);
  }
  
  /* Modal içi tasarım */
  .current-game-item, .available-game-item {
    display: flex;
    align-items: center;
    padding: 10px 15px;
    background: rgba(40, 40, 55, 0.1);
    border-radius: 8px;
    margin-bottom: 10px;
    position: relative;
    transition: all 0.2s ease;
  }
  
  .current-game-item {
    cursor: grab;
    border-left: 3px solid #6a5ae0;
  }
  
  .current-game-item:hover {
    background: rgba(40, 40, 55, 0.2);
  }
  
  .game-item-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(106, 90, 205, 0.15);
    border-radius: 8px;
    margin-right: 15px;
    font-size: 1.2rem;
    color: #6a5ae0;
  }
  
  .game-item-info {
    flex: 1;
  }
  
  .game-item-info h6 {
    margin: 0 0 3px;
    font-weight: 600;
  }
  
  .game-item-info p {
    margin: 0;
    font-size: 0.8rem;
    opacity: 0.7;
  }
  
  .available-games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
  }
  
  /* Sürükleme özellikleri */
  .sortable-ghost {
    opacity: 0.4;
  }
  
  .sortable-chosen {
    background: rgba(106, 90, 205, 0.2) !important;
  }
  
  .sortable-drag {
    cursor: grabbing;
  }
</style>
{% endblock %}

{% block content %}
{% if session.get('user_id') %}
<div class="profile-shortcut-container">
  <div class="profile-shortcut-avatar-wrapper" onclick="toggleShortcutPanel(event)">
    {% if get_avatar_url() %}
      <img src="{{ url_for('static', filename=get_avatar_url()) }}" alt="Profil" class="profile-shortcut-avatar">
    {% else %}
      <div class="profile-shortcut-placeholder">{{ get_user_data().username[0]|upper }}</div>
    {% endif %}
  </div>
  <div class="profile-shortcut-panel" id="shortcutPanel">
    <div class="shortcut-panel-item">
      <a href="{{ url_for('profile_v2') }}">
        <i class="fas fa-user-circle"></i>
        <span>Profilim</span>
      </a>
    </div>
    <div class="shortcut-panel-divider"></div>
    <div class="shortcut-panel-item">
      <a href="{{ url_for('logout') }}">
        <i class="fas fa-sign-out-alt"></i>
        <span>Çıkış Yap</span>
      </a>
    </div>
  </div>
</div>
{% endif %}

<section class="hero-section">
<div class="row align-items-center">
<div class="col-lg-12 text-center position-relative">
<div class="card">
  <h1 class="hero-title"><span>Zekânı Geliştir</span><span>IQ'nu Yükselt</span></h1>
  <p class="hero-subtitle">Bilişsel yeteneklerini geliştiren beyin egzersizi oyunlarımızla kendini zorla.</p>
  <div class="d-flex justify-content-center flex-wrap">
    <a href="{{ url_for('word_puzzle') }}" class="btn btn-primary me-2 mb-2">Hemen Başla</a>
    <a href="{{ url_for('articles') }}" class="btn btn-outline-primary mb-2">Detaylar</a>
  </div>
</div>
</div>
</div>
</section>

<section class="mt-4">
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Beyin Egzersizi Oyunları</h2>
  {% if session.get('user_id') %}
  <div class="customize-controls">
    <button id="customizeHomepageBtn" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#customizeHomepageModal">
      <i class="fas fa-cog me-1"></i> Oyunları Özelleştir
    </button>
  </div>
  {% endif %}
</div>

<div class="game-grid" id="homepageGameGrid">
  {% if session.get('user_id') %}
    <!-- Giriş yapılmış kullanıcılar için kişiselleştirilmiş oyunlar -->
    {% for game in homepage_games %}
      <div class="game-card" data-game-type="{{ game.type }}">
        <div class="game-icon"><i class="{{ game.icon }}"></i></div>
        <div class="game-info">
          <h3>{{ game.name }}</h3>
          <p>{{ game.description }}</p>
        </div>
        {% if game.status == 'active' %}
          <a href="{{ game.url }}" class="game-btn">Oyna</a>
        {% else %}
          <span class="game-btn" style="background-color: #6c757d; cursor: not-allowed;">Onarımda</span>
        {% endif %}
        {% if session.get('user_id') %}
          <button class="remove-game-btn" data-game-type="{{ game.type }}">
            <i class="fas fa-times"></i>
          </button>
        {% endif %}
      </div>
    {% endfor %}
    
    <!-- Oyun Ekleme Kartı -->
    <div class="game-card add-game-card" id="addGameCard" data-bs-toggle="modal" data-bs-target="#customizeHomepageModal">
      <div class="add-game-content">
        <i class="fas fa-plus-circle"></i>
        <p>Oyun Ekle</p>
      </div>
    </div>
  {% else %}
    <!-- Giriş yapılmamış kullanıcılar için varsayılan oyunlar -->
    {% for game in homepage_games %}
      <div class="game-card">
        <div class="game-icon"><i class="{{ game.icon }}"></i></div>
        <div class="game-info">
          <h3>{{ game.name }}</h3>
          <p>{{ game.description }}</p>
        </div>
        {% if game.status == 'active' %}
          <a href="{{ game.url }}" class="game-btn">Oyna</a>
        {% else %}
          <span class="game-btn" style="background-color: #6c757d; cursor: not-allowed;">Onarımda</span>
        {% endif %}
      </div>
    {% endfor %}
  {% endif %}
</div>
</section>

<!-- Özelleştirme Modalı -->
{% if session.get('user_id') %}
<div class="modal fade" id="customizeHomepageModal" tabindex="-1" aria-labelledby="customizeHomepageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="customizeHomepageModalLabel">Ana Sayfa Oyunlarını Özelleştir</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-12 mb-4">
            <h6>Mevcut Oyunlar</h6>
            <div class="alert alert-info">
              <small>Oyunların sıralamasını değiştirmek için sürükleyip bırakın. Kaldırmak için X düğmesine tıklayın.</small>
            </div>
            <div class="current-games-list" id="currentGamesList">
              <!-- JS ile doldurulacak -->
            </div>
          </div>
          <div class="col-12">
            <h6>Eklenebilecek Oyunlar</h6>
            <div class="available-games-grid" id="availableGamesList">
              <!-- JS ile doldurulacak -->
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
        <button type="button" class="btn btn-primary" id="saveHomepageChanges">Değişiklikleri Kaydet</button>
      </div>
    </div>
  </div>
</div>
{% endif %}

<section class="text-center mt-4 mb-4">
  <a href="{{ url_for('all_games') }}" class="btn btn-primary btn-lg">
    <i class="fas fa-gamepad me-2"></i>Daha Çok Oyunlar
  </a>
</section>

<section class="mt-4">
<h2 class="text-center mb-3">Beyin Egzersizinin Faydaları</h2>
<div class="row">
<div class="col-md-4 mb-3">
<div class="card h-100">
<div class="card-body">
<h3 class="card-title"><i class="fas fa-tachometer-alt me-2"></i>Hızlı Düşünme</h3>
<p class="card-text">Düzenli beyin egzersizleri, beyninizin bilgiyi işleme hızını artırarak daha hızlı karar verme ve tepki süresi sağlar.</p>
</div>
</div>
</div>

<div class="col-md-4 mb-3">
<div class="card h-100">
<div class="card-body">
<h3 class="card-title"><i class="fas fa-memory me-2"></i>Gelişmiş Hafıza</h3>
<p class="card-text">Hafıza oyunları, sinir yollarını güçlendirerek kısa ve uzun vadeli hafıza fonksiyonlarını geliştirir.</p>
</div>
</div>
</div>

<div class="col-md-4 mb-3">
<div class="card h-100">
<div class="card-body">
<h3 class="card-title"><i class="fas fa-lightbulb me-2"></i>Problem Çözme</h3>
<p class="card-text">Bulmaca ve örüntü tanıma egzersizleri, durumları analiz etme ve etkili çözümler geliştirme yeteneğinizi artırır.</p>
</div>
</div>
</div>
</div>
</section>

<section class="mt-4 text-center">
<div class="card">
<div class="card-body py-4">
<h2 class="card-title">Beynini Zorlamaya Hazır mısın?</h2>
<p class="card-text mb-3">Hemen beyin egzersizi oyunlarımızı oynamaya başla ve gelişimini takip et.</p>
<a href="{{ url_for('word_puzzle') }}" class="btn btn-primary me-2 mb-2">Oyna</a>
<a href="{{ url_for('leaderboard') }}" class="btn btn-outline-primary mb-2">Skor Tablosu <i class="fas fa-trophy"></i></a>
</div>
</div>
</section>
{% endblock %}

{% block scripts %}
<script>
  // Tüm oyun verilerini JavaScript'e aktar
  window.allGames = [
    {% for game in all_games %}
    {
      type: "{{ game.type }}",
      name: "{{ game.name }}",
      description: "{{ game.description }}",
      icon: "{{ game.icon }}",
      status: "{{ game.status }}"
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ];
</script>
{% endblock %}