{% extends "layout.html" %}

{% block content %}
{% if session.get('user_id') %}
<div class="profile-shortcut-container">
  <div class="profile-shortcut-avatar-wrapper" onclick="toggleShortcutPanel(event)">
    {% if get_avatar_url() %}
      <img src="{{ url_for('static', filename=get_avatar_url()) }}" alt="Profil" class="profile-shortcut-avatar">
    {% else %}
      <div class="profile-shortcut-placeholder">{{ get_user_data().username[0]|upper }}</div>
    {% endif %}
  </div>
  <div class="profile-shortcut-panel" id="shortcutPanel">
    <div class="shortcut-panel-item">
      <a href="{{ url_for('profile_v2') }}">
        <i class="fas fa-user-circle"></i>
        <span>Profilim</span>
      </a>
    </div>
    <div class="shortcut-panel-divider"></div>
    <div class="shortcut-panel-item">
      <a href="{{ url_for('logout') }}">
        <i class="fas fa-sign-out-alt"></i>
        <span>Çıkış Yap</span>
      </a>
    </div>
  </div>
</div>
{% endif %}

<section class="hero-section">
<div class="row align-items-center">
<div class="col-lg-12 text-center position-relative">
<div class="card">
  <h1 class="hero-title"><span>Zekânı Geliştir</span><span>IQ'nu Yükselt</span></h1>
  <p class="hero-subtitle">Bilişsel yeteneklerini geliştiren beyin egzersizi oyunlarımızla kendini zorla.</p>
  <div class="d-flex justify-content-center flex-wrap">
    <a href="{{ url_for('word_puzzle') }}" class="btn btn-primary me-2 mb-2">Hemen Başla</a>
    <a href="{{ url_for('articles') }}" class="btn btn-outline-primary mb-2">Detaylar</a>
  </div>
</div>
</div>
</div>
</section>

<section class="mt-4">
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Favori Oyunlarınız</h2>
  <div class="d-flex align-items-center">
    <span class="me-2 text-muted"><small>Ana ekranda en fazla 4 oyun gösterilir</small></span>
    <button id="editFavoritesBtn" class="btn btn-sm btn-outline-primary">
      <i class="fas fa-edit"></i> Düzenle
    </button>
  </div>
</div>

<!-- Favori oyunlar grid -->
<div class="game-grid" id="favoriteGamesGrid">
  <!-- Dinamik olarak doldurulacak -->
</div>

<!-- Oyunları düzenleme modu (başlangıçta gizli) -->
<div id="editFavoritesMode" class="mt-3 mb-3 p-3 border rounded" style="display: none;">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>Favori Oyunlarınızı Seçin</h4>
    <span class="badge bg-primary" id="selectedCount">0/4</span>
  </div>
  <div class="game-selection-grid" id="gameSelectionGrid">
    <!-- Dinamik olarak doldurulacak -->
  </div>
  <div class="mt-3 text-end">
    <button id="cancelEditBtn" class="btn btn-outline-secondary me-2">İptal</button>
    <button id="saveFavoritesBtn" class="btn btn-primary">Kaydet</button>
  </div>
</div>
</section>

<section class="mt-4">
<h2 class="text-center mb-3">Tüm Oyunlar</h2>
<div class="game-grid" id="allGamesGrid">
  <!-- Dinamik olarak doldurulacak -->
</div>
</section>

<section class="text-center mt-4 mb-4">
  <a href="{{ url_for('all_games') }}" class="btn btn-primary btn-lg">
    <i class="fas fa-gamepad me-2"></i>Daha Fazla Oyun
  </a>
</section>

<section class="mt-4">
<h2 class="text-center mb-3">Beyin Egzersizinin Faydaları</h2>
<div class="row">
<div class="col-md-4 mb-3">
<div class="card h-100">
<div class="card-body">
<h3 class="card-title"><i class="fas fa-tachometer-alt me-2"></i>Hızlı Düşünme</h3>
<p class="card-text">Düzenli beyin egzersizleri, beyninizin bilgiyi işleme hızını artırarak daha hızlı karar verme ve tepki süresi sağlar.</p>
</div>
</div>
</div>

<div class="col-md-4 mb-3">
<div class="card h-100">
<div class="card-body">
<h3 class="card-title"><i class="fas fa-memory me-2"></i>Gelişmiş Hafıza</h3>
<p class="card-text">Hafıza oyunları, sinir yollarını güçlendirerek kısa ve uzun vadeli hafıza fonksiyonlarını geliştirir.</p>
</div>
</div>
</div>

<div class="col-md-4 mb-3">
<div class="card h-100">
<div class="card-body">
<h3 class="card-title"><i class="fas fa-lightbulb me-2"></i>Problem Çözme</h3>
<p class="card-text">Bulmaca ve örüntü tanıma egzersizleri, durumları analiz etme ve etkili çözümler geliştirme yeteneğinizi artırır.</p>
</div>
</div>
</div>
</div>
</section>

<section class="mt-4 text-center">
<div class="card">
<div class="card-body py-4">
<h2 class="card-title">Beynini Zorlamaya Hazır mısın?</h2>
<p class="card-text mb-3">Hemen beyin egzersizi oyunlarımızı oynamaya başla ve gelişimini takip et.</p>
<a href="{{ url_for('word_puzzle') }}" class="btn btn-primary me-2 mb-2">Oyna</a>
<a href="{{ url_for('leaderboard') }}" class="btn btn-outline-primary mb-2">Skor Tablosu <i class="fas fa-trophy"></i></a>
</div>
</div>
</section>
{% endblock %}

{% block scripts %}
<script>
// Tüm oyunların verileri - normalde backend'den yüklenecek
const allGames = [
  {
    id: "word_puzzle",
    name: "Kelime Bulmaca",
    description: "Kelimeleri bul, sözcük hazineni genişlet.",
    icon: "fa-font",
    url: "{{ url_for('word_puzzle') }}"
  },
  {
    id: "memory_cards",
    name: "Hafıza Kartları",
    description: "Eşleşen kartları bul ve hafızanı test et.",
    icon: "fa-clone",
    url: "{{ url_for('memory_cards') }}"
  },
  {
    id: "labyrinth",
    name: "Labirent",
    description: "Çıkış yolunu bul ve stratejik düşün.",
    icon: "fa-route",
    url: "{{ url_for('labyrinth') }}"
  },
  {
    id: "puzzle",
    name: "Yapboz",
    description: "Parçaları birleştir ve görsel zekânı geliştir.",
    icon: "fa-puzzle-piece",
    url: "{{ url_for('puzzle') }}"
  },
  {
    id: "number_sequence",
    name: "Sayı Dizisi",
    description: "Sayı örüntülerini keşfet ve analitik düşün.",
    icon: "fa-sort-numeric-up",
    url: "{{ url_for('number_sequence') }}"
  },
  {
    id: "number_chain",
    name: "Sayı Zinciri",
    description: "Gördüğün sayıları doğru sırayla hatırla.",
    icon: "fa-link",
    url: "{{ url_for('number_chain') }}"
  },
  {
    id: "audio_memory",
    name: "Sesli Hafıza",
    description: "Duyduğun ses sıralamasını doğru tekrarla.",
    icon: "fa-volume-up",
    url: "{{ url_for('audio_memory') }}"
  },
  {
    id: "n_back",
    name: "N-Back Test",
    description: "Çalışma belleğini ve odaklanma gücünü test et.",
    icon: "fa-brain",
    url: "{{ url_for('n_back') }}"
  },
  {
    id: "chess",
    name: "Satranç",
    description: "Stratejik düşünme ve planlama becerilerini geliştir.",
    icon: "fa-chess",
    url: "{{ url_for('chess') }}"
  },
  {
    id: "sudoku",
    name: "Sudoku",
    description: "Mantık gücünü geliştir.",
    icon: "fa-th",
    url: "{{ url_for('sudoku') }}"
  },
  {
    id: "three_d_rotation",
    name: "3D Döndürme",
    description: "Uzamsal algı yeteneklerini geliştir.",
    icon: "fa-cube",
    url: "{{ url_for('three_d_rotation') }}"
  },
  {
    id: "wordle",
    name: "Kelime Tahmin",
    description: "5 harfli kelimeleri tahmin et.",
    icon: "fa-spell-check",
    url: "{{ url_for('wordle') }}"
  }
];

// Sayfa yüklendiğinde
document.addEventListener('DOMContentLoaded', function() {
  // Favori oyunları localStorage'dan yükle (yoksa varsayılan olarak ilk 4 oyunu kullan)
  let favoriteGames = JSON.parse(localStorage.getItem('favoriteGames')) || allGames.slice(0, 4).map(game => game.id);
  
  // Favori oyunları ve tüm oyunları göster
  displayFavoriteGames();
  displayAllGames();
  
  // Düzenle butonuna tıklanınca
  document.getElementById('editFavoritesBtn').addEventListener('click', function() {
    document.getElementById('editFavoritesMode').style.display = 'block';
    displayGameSelection();
  });
  
  // İptal butonuna tıklanınca
  document.getElementById('cancelEditBtn').addEventListener('click', function() {
    document.getElementById('editFavoritesMode').style.display = 'none';
  });
  
  // Kaydet butonuna tıklanınca
  document.getElementById('saveFavoritesBtn').addEventListener('click', function() {
    saveFavoriteGames();
    document.getElementById('editFavoritesMode').style.display = 'none';
  });
});

// Favori oyunları göster
function displayFavoriteGames() {
  const favoriteGamesGrid = document.getElementById('favoriteGamesGrid');
  favoriteGamesGrid.innerHTML = '';
  
  // Favori oyunları localStorage'dan yükle
  let favoriteGameIds = JSON.parse(localStorage.getItem('favoriteGames')) || allGames.slice(0, 4).map(game => game.id);
  
  // Favori oyun yoksa varsayılan mesaj göster
  if (favoriteGameIds.length === 0) {
    const emptyMessage = document.createElement('div');
    emptyMessage.className = 'alert alert-info w-100 text-center';
    emptyMessage.innerHTML = 'Henüz favori oyun eklemediniz. "Düzenle" butonunu kullanarak favori oyunlarınızı ekleyebilirsiniz.';
    favoriteGamesGrid.appendChild(emptyMessage);
    return;
  }
  
  // Favori oyunları göster
  favoriteGameIds.forEach(gameId => {
    const game = allGames.find(g => g.id === gameId);
    if (game) {
      favoriteGamesGrid.appendChild(createGameCard(game));
    }
  });
}

// Tüm oyunları göster
function displayAllGames() {
  const allGamesGrid = document.getElementById('allGamesGrid');
  allGamesGrid.innerHTML = '';
  
  allGames.forEach(game => {
    allGamesGrid.appendChild(createGameCard(game));
  });
}

// Oyun seçim ekranını göster
function displayGameSelection() {
  const gameSelectionGrid = document.getElementById('gameSelectionGrid');
  gameSelectionGrid.innerHTML = '';
  
  // Favori oyunları localStorage'dan yükle
  let favoriteGameIds = JSON.parse(localStorage.getItem('favoriteGames')) || allGames.slice(0, 4).map(game => game.id);
  
  // Seçim sayısını güncelle
  updateSelectedCount(favoriteGameIds.length);
  
  // Tüm oyunlar için seçim kartları oluştur
  allGames.forEach(game => {
    const gameCard = document.createElement('div');
    gameCard.className = 'game-selection-card';
    gameCard.dataset.gameId = game.id;
    
    // Oyun favori ise seçili olarak işaretle
    if (favoriteGameIds.includes(game.id)) {
      gameCard.classList.add('selected');
    }
    
    gameCard.innerHTML = `
      <div class="game-selection-icon"><i class="fas ${game.icon}"></i></div>
      <div class="game-selection-info">
        <h5>${game.name}</h5>
      </div>
      <div class="game-selection-checkbox">
        <i class="fas fa-check-circle"></i>
      </div>
    `;
    
    // Kart tıklaması
    gameCard.addEventListener('click', function() {
      toggleGameSelection(this);
    });
    
    gameSelectionGrid.appendChild(gameCard);
  });
}

// Oyun seçimini değiştir
function toggleGameSelection(cardElement) {
  // Favori oyunları localStorage'dan yükle
  let favoriteGameIds = JSON.parse(localStorage.getItem('favoriteGames')) || allGames.slice(0, 4).map(game => game.id);
  const gameId = cardElement.dataset.gameId;
  
  if (cardElement.classList.contains('selected')) {
    // Seçimi kaldır
    cardElement.classList.remove('selected');
    favoriteGameIds = favoriteGameIds.filter(id => id !== gameId);
  } else {
    // En fazla 4 oyun seçilebilir
    if (favoriteGameIds.length >= 4) {
      // Uyarı göster
      alert('En fazla 4 oyun ekleyebilirsiniz. Lütfen önce bir oyunu çıkarın.');
      return;
    }
    
    // Seçimi ekle
    cardElement.classList.add('selected');
    favoriteGameIds.push(gameId);
  }
  
  // Seçim sayısını güncelle
  updateSelectedCount(favoriteGameIds.length);
  
  // Geçici olarak localStorage'a kaydet
  localStorage.setItem('favoriteGames', JSON.stringify(favoriteGameIds));
}

// Seçilen oyun sayısını güncelle
function updateSelectedCount(count) {
  document.getElementById('selectedCount').textContent = count + '/4';
}

// Favori oyunları kaydet
function saveFavoriteGames() {
  // Favori oyunları localStorage'dan yükle
  let favoriteGameIds = JSON.parse(localStorage.getItem('favoriteGames')) || [];
  
  // Favori oyunları göster
  displayFavoriteGames();
  
  // Başarılı mesajı göster
  const message = document.createElement('div');
  message.className = 'alert alert-success mt-3';
  message.innerHTML = 'Favori oyunlarınız başarıyla kaydedildi!';
  message.style.transition = 'opacity 0.5s ease-out';
  
  // Mesajı ekle
  document.getElementById('favoriteGamesGrid').insertAdjacentElement('beforebegin', message);
  
  // 3 saniye sonra mesajı gizle
  setTimeout(() => {
    message.style.opacity = '0';
    setTimeout(() => message.remove(), 500);
  }, 3000);
}

// Oyun kartı oluştur
function createGameCard(game) {
  const gameCard = document.createElement('div');
  gameCard.className = 'game-card';
  gameCard.innerHTML = `
    <div class="game-icon"><i class="fas ${game.icon}"></i></div>
    <div class="game-info">
      <h3>${game.name}</h3>
      <p>${game.description}</p>
    </div>
    <a href="${game.url}" class="game-btn">Oyna</a>
  `;
  return gameCard;
}
</script>

<style>
/* Oyun seçim ekranı stilleri */
.game-selection-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 15px;
}

.game-selection-card {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 15px;
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}

.game-selection-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.game-selection-icon {
  font-size: 24px;
  margin-bottom: 10px;
  color: #007bff;
}

.game-selection-info h5 {
  font-size: 14px;
  text-align: center;
  margin: 0;
}

.game-selection-checkbox {
  position: absolute;
  top: 5px;
  right: 5px;
  color: #ccc;
  font-size: 18px;
}

.game-selection-card.selected {
  border-color: #007bff;
  background-color: rgba(0, 123, 255, 0.05);
}

.game-selection-card.selected .game-selection-checkbox {
  color: #007bff;
}
</style>
{% endblock %}
