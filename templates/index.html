{% extends "layout.html" %}

{% block content %}
{% if session.get('user_id') %}
<div class="profile-shortcut-container">
  <div class="profile-shortcut-avatar-wrapper" onclick="toggleShortcutPanel(event)">
    {% if get_avatar_url() %}
      <img src="{{ url_for('static', filename=get_avatar_url()) }}" alt="Profil" class="profile-shortcut-avatar">
    {% else %}
      <div class="profile-shortcut-placeholder">{{ get_user_data().username[0]|upper }}</div>
    {% endif %}
  </div>
  <div class="profile-shortcut-panel" id="shortcutPanel">
    <div class="shortcut-panel-item">
      <a href="{{ url_for('profile_v2') }}">
        <i class="fas fa-user-circle"></i>
        <span>Profilim</span>
      </a>
    </div>
    <div class="shortcut-panel-divider"></div>
    <div class="shortcut-panel-item">
      <a href="{{ url_for('logout') }}">
        <i class="fas fa-sign-out-alt"></i>
        <span>Çıkış Yap</span>
      </a>
    </div>
  </div>
</div>
{% endif %}

<section class="hero-section">
<div class="row align-items-center">
<div class="col-lg-12 text-center position-relative">
<div class="card">
  <h1 class="hero-title"><span>Zekânı Geliştir</span><span>IQ'nu Yükselt</span></h1>
  <p class="hero-subtitle">Bilişsel yeteneklerini geliştiren beyin egzersizi oyunlarımızla kendini zorla.</p>
  <div class="d-flex justify-content-center flex-wrap">
    <a href="{{ url_for('word_puzzle') }}" class="btn btn-primary me-2 mb-2">Hemen Başla</a>
    <a href="{{ url_for('articles') }}" class="btn btn-outline-primary mb-2">Detaylar</a>
  </div>
</div>
</div>
</div>
</section>

<section class="mt-4">
<h2 class="text-center mb-3">Favori Oyunlarınız</h2>

<!-- Kullanıcının favori oyunları -->
{% if session.get('user_id') and favorite_games %}
  <div class="game-grid">
    {% for game in favorite_games %}
      <div class="game-card" data-favorite-id="{{ game.favorite_id }}">
        <div class="game-icon"><i class="{{ game.icon }}"></i></div>
        <div class="game-info">
          <h3>{{ game.name }}</h3>
          <p>{{ game.description if game.description else "Bu oyunu favorilerinize eklediniz." }}</p>
        </div>
        <a href="{{ game.url }}" class="game-btn">Oyna</a>
        <button class="btn-remove-favorite" data-id="{{ game.favorite_id }}" title="Favorilerden çıkar">
          <i class="fas fa-star"></i>
        </button>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-info text-center">
    {% if session.get('user_id') %}
      <p>Henüz favori oyun eklemediniz. Aşağıdan en sevdiğiniz oyunları favorilerinize ekleyebilirsiniz.</p>
    {% else %}
      <p>Favori oyunları eklemek için <a href="{{ url_for('login') }}">giriş yapın</a> veya <a href="{{ url_for('register') }}">kayıt olun</a></p>
    {% endif %}
  </div>
{% endif %}

<h2 class="text-center mb-3 mt-5">Tüm Beyin Egzersizi Oyunları</h2>
<div class="game-grid">
  {% for game in other_games %}
    <div class="game-card">
      <div class="game-icon"><i class="{{ game.icon }}"></i></div>
      <div class="game-info">
        <h3>{{ game.name }}</h3>
        <p>{{ game.description if game.description }}</p>
      </div>
      <a href="{{ game.url }}" class="game-btn">Oyna</a>
      {% if session.get('user_id') %}
        <button class="btn-add-favorite" data-type="{{ game.type }}" title="Favorilere ekle">
          <i class="far fa-star"></i>
        </button>
      {% endif %}
    </div>
  {% endfor %}
</div>
</section>

<section class="text-center mt-4 mb-4">
  <a href="{{ url_for('all_games') }}" class="btn btn-primary btn-lg">
    <i class="fas fa-gamepad me-2"></i>Daha Çok Oyunlar
  </a>
</section>

<section class="mt-4">
<h2 class="text-center mb-3">Beyin Egzersizinin Faydaları</h2>
<div class="row">
<div class="col-md-4 mb-3">
<div class="card h-100">
<div class="card-body">
<h3 class="card-title"><i class="fas fa-tachometer-alt me-2"></i>Hızlı Düşünme</h3>
<p class="card-text">Düzenli beyin egzersizleri, beyninizin bilgiyi işleme hızını artırarak daha hızlı karar verme ve tepki süresi sağlar.</p>
</div>
</div>
</div>

<div class="col-md-4 mb-3">
<div class="card h-100">
<div class="card-body">
<h3 class="card-title"><i class="fas fa-memory me-2"></i>Gelişmiş Hafıza</h3>
<p class="card-text">Hafıza oyunları, sinir yollarını güçlendirerek kısa ve uzun vadeli hafıza fonksiyonlarını geliştirir.</p>
</div>
</div>
</div>

<div class="col-md-4 mb-3">
<div class="card h-100">
<div class="card-body">
<h3 class="card-title"><i class="fas fa-lightbulb me-2"></i>Problem Çözme</h3>
<p class="card-text">Bulmaca ve örüntü tanıma egzersizleri, durumları analiz etme ve etkili çözümler geliştirme yeteneğinizi artırır.</p>
</div>
</div>
</div>
</div>
</section>

<section class="mt-4 text-center">
<div class="card">
<div class="card-body py-4">
<h2 class="card-title">Beynini Zorlamaya Hazır mısın?</h2>
<p class="card-text mb-3">Hemen beyin egzersizi oyunlarımızı oynamaya başla ve gelişimini takip et.</p>
<a href="{{ url_for('word_puzzle') }}" class="btn btn-primary me-2 mb-2">Oyna</a>
<a href="{{ url_for('leaderboard') }}" class="btn btn-outline-primary mb-2">Skor Tablosu <i class="fas fa-trophy"></i></a>
</div>
</div>
</section>

<!-- JavaScript kodu - Favori oyun ekleme/çıkarma -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Favori ekle düğmeleri
  const addFavoriteButtons = document.querySelectorAll('.btn-add-favorite');
  addFavoriteButtons.forEach(button => {
    button.addEventListener('click', function() {
      const gameType = this.getAttribute('data-type');
      addToFavorites(gameType);
    });
  });
  
  // Favorilerden çıkar düğmeleri
  const removeFavoriteButtons = document.querySelectorAll('.btn-remove-favorite');
  removeFavoriteButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      const favoriteId = this.getAttribute('data-id');
      removeFromFavorites(favoriteId);
    });
  });
  
  // Favorilere ekle
  function addToFavorites(gameType) {
    fetch('/api/favorites/add', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ game_type: gameType })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        showNotification('Oyun favorilerinize eklendi', 'success');
        // Sayfayı yeniden yükle
        setTimeout(() => { location.reload(); }, 1000);
      } else {
        showNotification(data.error || 'Bir hata oluştu', 'error');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      showNotification('Bir hata oluştu', 'error');
    });
  }
  
  // Favorilerden çıkar
  function removeFromFavorites(favoriteId) {
    fetch('/api/favorites/remove', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ favorite_id: favoriteId })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        showNotification('Oyun favorilerinizden çıkarıldı', 'success');
        // Sayfayı yeniden yükle
        setTimeout(() => { location.reload(); }, 1000);
      } else {
        showNotification(data.error || 'Bir hata oluştu', 'error');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      showNotification('Bir hata oluştu', 'error');
    });
  }
  
  // Bildirim göster
  function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = message;
    document.body.appendChild(notification);
    
    // 3 saniye sonra bildirim kaybolsun
    setTimeout(() => {
      notification.classList.add('fade-out');
      setTimeout(() => {
        notification.remove();
      }, 500);
    }, 2500);
  }
});
</script>

<!-- Bildirim Stili -->
<style>
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 15px 20px;
  border-radius: 4px;
  color: white;
  font-weight: bold;
  z-index: 9999;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  transition: opacity 0.5s;
}
.notification.success {
  background-color: #4CAF50;
}
.notification.error {
  background-color: #f44336;
}
.notification.fade-out {
  opacity: 0;
}

/* Favori buton stilleri */
.btn-add-favorite, .btn-remove-favorite {
  position: absolute;
  top: 10px;
  right: 10px;
  background: none;
  border: none;
  color: #FFD700;
  font-size: 1.2rem;
  cursor: pointer;
  transition: all 0.3s;
}
.btn-add-favorite:hover {
  transform: scale(1.2);
}
.btn-remove-favorite:hover {
  transform: scale(1.2);
}
.game-card {
  position: relative;
}
</style>
{% endblock %}
