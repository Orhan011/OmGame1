{% extends "layout.html" %}

{% block title %}{{ get_current_user().username }} - Profil | OmGame{% endblock %}

{% block content %}
<div class="container profile-container">
  <!-- Profile Header - Includes avatar and user info -->
  <div class="profile-header">
    <div class="profile-header-content">
      <!-- Avatar Section -->
      <div class="profile-avatar-container">
        {% if get_avatar_url() %}
        <img src="{{ url_for('static', filename=get_avatar_url()) }}" alt="{{ get_current_user().username }}" class="profile-avatar">
        {% else %}
        <div class="profile-avatar profile-avatar-placeholder">
          <i class="fas fa-user fa-3x"></i>
        </div>
        {% endif %}
        <a href="#" class="profile-avatar-edit" data-bs-toggle="modal" data-bs-target="#avatarModal">
          <i class="fas fa-camera"></i>
        </a>
        
        <!-- Level Badge -->
        <div class="level-badge" title="Seviye {{ current_level }}">
          <span>{{ current_level }}</span>
        </div>
      </div>
      
      <!-- User Info Section -->
      <div class="profile-user-info">
        <div class="profile-username-container">
          <h1 class="profile-username">{{ get_current_user().username }}</h1>
          <div class="user-status-badge">{{ get_current_user().account_status|capitalize }}</div>
        </div>
        
        <div class="profile-email">
          <i class="fas fa-envelope"></i>
          <span>{{ get_current_user().email }}</span>
        </div>
        
        <!-- Level Progress Bar - Yeni eklenen kısım -->
        <div class="level-progress-container">
          <div class="level-progress-info">
            <span class="level-text">Seviye {{ current_level }}</span>
            <span class="xp-text">{{ get_current_user().experience_points }} XP</span>
          </div>
          
          {% set xp_progress = ((get_current_user().experience_points - xp_for_current) / (xp_for_next - xp_for_current)) * 100 if (xp_for_next - xp_for_current) > 0 else 0 %}
          
          <div class="level-progress-bar-container">
            <div class="level-progress-bar" style="width: {{ xp_progress|int }}%"></div>
            <div class="level-progress-spark" style="left: {{ xp_progress|int }}%"></div>
          </div>
          
          <div class="level-progress-info">
            <span class="current-level">{{ current_level }}</span>
            <span class="next-level">{{ current_level + 1 }}</span>
          </div>
        </div>
        
        <div class="profile-bio">
          <span class="profile-bio-icon">Hakkımda</span>
          {% if get_current_user().bio %}
          {{ get_current_user().bio }}
          {% else %}
          <span class="profile-bio-empty">Henüz bir bio eklenmedi.</span>
          {% endif %}
        </div>
        
        <div class="profile-actions">
          <a href="#" class="profile-action-btn" data-bs-toggle="modal" data-bs-target="#editProfileModal">
            <i class="fas fa-edit"></i>
            <span>Profili Düzenle</span>
          </a>
          <a href="#" class="profile-action-btn" data-bs-toggle="modal" data-bs-target="#passwordModal">
            <i class="fas fa-key"></i>
            <span>Şifre Değiştir</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Theme Toggle - Kullanıcı arayüz teması değiştirme -->
  <div class="theme-toggle-container">
    <label class="theme-label">Tema</label>
    <label class="theme-toggle">
      <input type="checkbox" id="themeToggle" {% if get_current_user().theme_preference == 'light' %}checked{% endif %}>
      <span class="theme-slider"></span>
    </label>
  </div>

  <!-- Profile Stats - Kullanıcı istatistikleri -->
  <div class="profile-stats-container">
    <div class="profile-stat-card">
      <i class="fas fa-trophy profile-stat-icon"></i>
      <div class="profile-stat-value">{{ get_current_user().highest_score }}</div>
      <div class="profile-stat-label">En Yüksek Skor</div>
    </div>
    
    <div class="profile-stat-card">
      <i class="fas fa-gamepad profile-stat-icon"></i>
      <div class="profile-stat-value">{{ get_current_user().total_games_played }}</div>
      <div class="profile-stat-label">Toplam Oyun</div>
    </div>
    
    <div class="profile-stat-card">
      <i class="fas fa-star profile-stat-icon"></i>
      <div class="profile-stat-value">{{ get_current_user().experience_points }}</div>
      <div class="profile-stat-label">Deneyim Puanı</div>
    </div>
    
    <div class="profile-stat-card">
      <i class="fas fa-crown profile-stat-icon"></i>
      <div class="profile-stat-value">{{ get_current_user().rank }}</div>
      <div class="profile-stat-label">Rütbe</div>
    </div>
  </div>

  <!-- Tabs System -->
  <div class="profile-tabs">
    <div class="tabs-container">
      <div class="profile-tab active" data-tab="games">
        <i class="fas fa-gamepad"></i>
        <span>Oyun İstatistikleri</span>
      </div>
      <div class="profile-tab" data-tab="achievements">
        <i class="fas fa-trophy"></i>
        <span>Başarılar</span>
      </div>
      <div class="profile-tab" data-tab="history">
        <i class="fas fa-history"></i>
        <span>Oyun Geçmişi</span>
      </div>
      <div class="profile-tab" data-tab="settings">
        <i class="fas fa-cog"></i>
        <span>Ayarlar</span>
      </div>
      <div class="tab-indicator"></div>
    </div>
    
    <!-- Game Stats Tab -->
    <div class="tab-content active" id="games-tab">
      <h2 class="section-title">
        <i class="fas fa-chart-bar"></i>
        <span>Oyun İstatistikleri</span>
      </h2>
      <div class="game-stat-cards">
        {% set user_scores = get_user_scores() %}
        
        {% if 'wordPuzzle' in user_scores %}
        <div class="game-stat-card">
          <div class="game-stat-header">
            <div class="game-stat-icon">
              <i class="fas fa-spell-check"></i>
            </div>
            <div class="game-stat-title">Kelime Bulmaca</div>
          </div>
          <div class="game-stat-body">
            <div class="stat-item">
              <div class="stat-name">En Yüksek Skor</div>
              <div class="stat-value best-score">{{ user_scores['wordPuzzle'] }}</div>
            </div>
            <div class="stat-item">
              <div class="stat-name">Son Oynanma</div>
              <div class="stat-value">{{ user_scores['wordPuzzle_date']|default('--') }}</div>
            </div>
          </div>
        </div>
        {% endif %}
        
        {% if 'memoryMatch' in user_scores %}
        <div class="game-stat-card">
          <div class="game-stat-header">
            <div class="game-stat-icon">
              <i class="fas fa-clone"></i>
            </div>
            <div class="game-stat-title">Hafıza Kartları</div>
          </div>
          <div class="game-stat-body">
            <div class="stat-item">
              <div class="stat-name">En Yüksek Skor</div>
              <div class="stat-value best-score">{{ user_scores['memoryMatch'] }}</div>
            </div>
            <div class="stat-item">
              <div class="stat-name">Son Oynanma</div>
              <div class="stat-value">{{ user_scores['memoryMatch_date']|default('--') }}</div>
            </div>
          </div>
        </div>
        {% endif %}
        
        {% if 'labyrinth' in user_scores %}
        <div class="game-stat-card">
          <div class="game-stat-header">
            <div class="game-stat-icon">
              <i class="fas fa-route"></i>
            </div>
            <div class="game-stat-title">Labirent</div>
          </div>
          <div class="game-stat-body">
            <div class="stat-item">
              <div class="stat-name">En Yüksek Skor</div>
              <div class="stat-value best-score">{{ user_scores['labyrinth'] }}</div>
            </div>
            <div class="stat-item">
              <div class="stat-name">Son Oynanma</div>
              <div class="stat-value">{{ user_scores['labyrinth_date']|default('--') }}</div>
            </div>
          </div>
        </div>
        {% endif %}
        
        {% if 'puzzle' in user_scores %}
        <div class="game-stat-card">
          <div class="game-stat-header">
            <div class="game-stat-icon">
              <i class="fas fa-puzzle-piece"></i>
            </div>
            <div class="game-stat-title">Yapboz</div>
          </div>
          <div class="game-stat-body">
            <div class="stat-item">
              <div class="stat-name">En Yüksek Skor</div>
              <div class="stat-value best-score">{{ user_scores['puzzle'] }}</div>
            </div>
            <div class="stat-item">
              <div class="stat-name">Son Oynanma</div>
              <div class="stat-value">{{ user_scores['puzzle_date']|default('--') }}</div>
            </div>
          </div>
        </div>
        {% endif %}
        
        {% if 'numberSequence' in user_scores %}
        <div class="game-stat-card">
          <div class="game-stat-header">
            <div class="game-stat-icon">
              <i class="fas fa-sort-numeric-up"></i>
            </div>
            <div class="game-stat-title">Sayı Dizisi</div>
          </div>
          <div class="game-stat-body">
            <div class="stat-item">
              <div class="stat-name">En Yüksek Skor</div>
              <div class="stat-value best-score">{{ user_scores['numberSequence'] }}</div>
            </div>
            <div class="stat-item">
              <div class="stat-name">Son Oynanma</div>
              <div class="stat-value">{{ user_scores['numberSequence_date']|default('--') }}</div>
            </div>
          </div>
        </div>
        {% endif %}
        
        {% if '3dLabyrinth' in user_scores %}
        <div class="game-stat-card">
          <div class="game-stat-header">
            <div class="game-stat-icon">
              <i class="fas fa-cube"></i>
            </div>
            <div class="game-stat-title">3D Labirent</div>
          </div>
          <div class="game-stat-body">
            <div class="stat-item">
              <div class="stat-name">En Yüksek Skor</div>
              <div class="stat-value best-score">{{ user_scores['3dLabyrinth'] }}</div>
            </div>
            <div class="stat-item">
              <div class="stat-name">Son Oynanma</div>
              <div class="stat-value">{{ user_scores['3dLabyrinth_date']|default('--') }}</div>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
    
    <!-- Achievements Tab -->
    <div class="tab-content" id="achievements-tab">
      <h2 class="section-title">
        <i class="fas fa-medal"></i>
        <span>Başarılar</span>
      </h2>
      <div class="achievements-grid">
        <div class="achievement-card">
          <div class="achievement-icon">
            <i class="fas fa-graduation-cap"></i>
          </div>
          <div class="achievement-name">Başlangıç</div>
          <div class="achievement-desc">İlk oyununu tamamla</div>
        </div>
        
        <div class="achievement-card achievement-locked">
          <div class="achievement-icon">
            <i class="fas fa-brain"></i>
          </div>
          <div class="achievement-name">Hafıza Uzmanı</div>
          <div class="achievement-desc">Hafıza oyununda 1000 puan geç</div>
        </div>
        
        <div class="achievement-card achievement-locked">
          <div class="achievement-icon">
            <i class="fas fa-puzzle-piece"></i>
          </div>
          <div class="achievement-name">Yapboz Ustası</div>
          <div class="achievement-desc">10 yapboz tamamla</div>
        </div>
        
        <div class="achievement-card achievement-locked">
          <div class="achievement-icon">
            <i class="fas fa-route"></i>
          </div>
          <div class="achievement-name">Labirent Kaşifi</div>
          <div class="achievement-desc">5 farklı labirenti tamamla</div>
        </div>
        
        <div class="achievement-card achievement-locked">
          <div class="achievement-icon">
            <i class="fas fa-star"></i>
          </div>
          <div class="achievement-name">Yıldız Öğrenci</div>
          <div class="achievement-desc">Tüm oyunlarda en az 500 puan kazan</div>
        </div>
        
        <div class="achievement-card achievement-locked">
          <div class="achievement-icon">
            <i class="fas fa-trophy"></i>
          </div>
          <div class="achievement-name">Şampiyon</div>
          <div class="achievement-desc">Liderlik tablosunda ilk 10'a gir</div>
        </div>
      </div>
    </div>
    
    <!-- History Tab -->
    <div class="tab-content" id="history-tab">
      <h2 class="section-title">
        <i class="fas fa-history"></i>
        <span>Oyun Geçmişi</span>
      </h2>
      <div class="table-responsive">
        <table class="games-table">
          <thead>
            <tr>
              <th>Oyun</th>
              <th>Skor</th>
              <th>Tarih</th>
            </tr>
          </thead>
          <tbody>
            {% for score in get_current_user().scores[-10:]|reverse %}
            <tr>
              <td>
                <div class="game-type">
                  <div class="game-icon">
                    {% if score.game_type == 'wordPuzzle' %}
                    <i class="fas fa-spell-check"></i>
                    {% elif score.game_type == 'memoryMatch' %}
                    <i class="fas fa-clone"></i>
                    {% elif score.game_type == 'labyrinth' %}
                    <i class="fas fa-route"></i>
                    {% elif score.game_type == 'puzzle' %}
                    <i class="fas fa-puzzle-piece"></i>
                    {% elif score.game_type == 'numberSequence' %}
                    <i class="fas fa-sort-numeric-up"></i>
                    {% elif score.game_type == '3dLabyrinth' %}
                    <i class="fas fa-cube"></i>
                    {% else %}
                    <i class="fas fa-gamepad"></i>
                    {% endif %}
                  </div>
                  {% if score.game_type == 'wordPuzzle' %}
                  Kelime Bulmaca
                  {% elif score.game_type == 'memoryMatch' %}
                  Hafıza Kartları
                  {% elif score.game_type == 'labyrinth' %}
                  Labirent
                  {% elif score.game_type == 'puzzle' %}
                  Yapboz
                  {% elif score.game_type == 'numberSequence' %}
                  Sayı Dizisi
                  {% elif score.game_type == '3dLabyrinth' %}
                  3D Labirent
                  {% else %}
                  {{ score.game_type }}
                  {% endif %}
                </div>
              </td>
              <td class="score-cell">{{ score.score }}</td>
              <td class="date-cell">{{ score.timestamp.strftime('%d/%m/%Y %H:%M') }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Settings Tab - Yeni güvenlik ayarları ile güncellendi -->
    <div class="tab-content" id="settings-tab">
      <h2 class="section-title">
        <i class="fas fa-cog"></i>
        <span>Hesap Ayarları</span>
      </h2>
      
      <div class="settings-form">
        <!-- Profile Information -->
        <div class="form-section">
          <h3 class="form-section-title">Profil Bilgileri</h3>
          <form action="{{ url_for('update_profile') }}" method="post">
            <div class="form-group">
              <label for="username" class="form-label">Kullanıcı Adı</label>
              <input type="text" class="form-control" id="username" name="username" value="{{ get_current_user().username }}">
            </div>
            
            <div class="form-group">
              <label for="email" class="form-label">E-posta</label>
              <input type="email" class="form-control" id="email" name="email" value="{{ get_current_user().email }}">
            </div>
            
            <div class="form-group">
              <label for="full_name" class="form-label">Tam İsim</label>
              <input type="text" class="form-control" id="full_name" name="full_name" value="{{ get_current_user().full_name or '' }}">
            </div>
            
            <div class="form-group">
              <label for="bio" class="form-label">Hakkımda</label>
              <textarea class="form-control" id="bio" name="bio" rows="3">{{ get_current_user().bio or '' }}</textarea>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Kaydet</button>
            </div>
          </form>
        </div>

        <!-- Security Settings - Yeni eklenen bölüm -->
        <div class="form-section">
          <h3 class="form-section-title security-title">
            <i class="fas fa-shield-alt"></i>
            Güvenlik Ayarları
          </h3>
          
          <form action="{{ url_for('update_security_settings') }}" method="post">
            <div class="form-group">
              <label for="current_password" class="form-label">Mevcut Şifre</label>
              <div class="password-input-container">
                <input type="password" class="form-control" id="current_password" name="current_password">
                <button type="button" class="toggle-password">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            
            <div class="form-group">
              <label for="new_password" class="form-label">Yeni Şifre</label>
              <div class="password-input-container">
                <input type="password" class="form-control" id="new_password" name="new_password">
                <button type="button" class="toggle-password">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            
            <div class="form-group">
              <label for="confirm_password" class="form-label">Şifreyi Tekrarla</label>
              <div class="password-input-container">
                <input type="password" class="form-control" id="confirm_password" name="confirm_password">
                <button type="button" class="toggle-password">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            
            <div class="password-strength">
              <div class="strength-meter"></div>
              <div class="strength-text">Şifre Gücü: <span>Zayıf</span></div>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Şifreyi Güncelle</button>
            </div>
          </form>
        </div>

        <!-- Notification Settings - Yeni eklenen bölüm -->
        <div class="form-section">
          <h3 class="form-section-title notification-title">
            <i class="fas fa-bell"></i>
            Bildirim Ayarları
          </h3>
          
          <form action="{{ url_for('update_notification_settings') }}" method="post">
            <div class="toggle-control">
              <label for="email_notifications" class="toggle-label">
                E-posta Bildirimleri
                <span class="toggle-description">Oyun duyuruları, başarılar ve güncellemeler</span>
              </label>
              <label class="switch">
                <input type="checkbox" id="email_notifications" name="email_notifications" {% if get_current_user().email_notifications %}checked{% endif %}>
                <span class="slider"></span>
              </label>
            </div>
            
            <div class="toggle-control">
              <label for="achievement_notifications" class="toggle-label">
                Başarı Bildirimleri
                <span class="toggle-description">Yeni başarılar kazandığınızda bildirim al</span>
              </label>
              <label class="switch">
                <input type="checkbox" id="achievement_notifications" name="achievement_notifications" {% if get_current_user().achievement_notifications %}checked{% endif %}>
                <span class="slider"></span>
              </label>
            </div>
            
            <div class="toggle-control">
              <label for="leaderboard_notifications" class="toggle-label">
                Liderlik Tablosu Bildirimleri
                <span class="toggle-description">Liderlik tablosundaki değişiklikler hakkında bildirim al</span>
              </label>
              <label class="switch">
                <input type="checkbox" id="leaderboard_notifications" name="leaderboard_notifications" {% if get_current_user().leaderboard_notifications %}checked{% endif %}>
                <span class="slider"></span>
              </label>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Bildirimleri Güncelle</button>
            </div>
          </form>
        </div>

        <!-- Account Management - Yeni eklenen bölüm -->
        <div class="form-section danger-section">
          <h3 class="form-section-title danger-title">
            <i class="fas fa-exclamation-triangle"></i>
            Hesap Yönetimi
          </h3>
          
          <div class="danger-action-container">
            <div class="danger-action">
              <div class="danger-info">
                <h4>Hesabı Geçici Olarak Dondur</h4>
                <p>Hesabınızı 30 gün boyunca dondurun. Bu süre içinde hesabınıza erişemezsiniz.</p>
              </div>
              <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#suspendAccountModal">
                <i class="fas fa-pause-circle"></i>
                Hesabı Dondur
              </button>
            </div>
            
            <div class="danger-action">
              <div class="danger-info">
                <h4>Hesabı Kalıcı Olarak Sil</h4>
                <p>Hesabınızı ve tüm verilerinizi kalıcı olarak silin. Bu işlem geri alınamaz.</p>
              </div>
              <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                <i class="fas fa-trash-alt"></i>
                Hesabı Sil
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modals -->
<!-- Avatar Upload Modal -->
<div class="modal fade" id="avatarModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Profil Fotoğrafını Değiştir</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="{{ url_for('update_avatar') }}" method="post" enctype="multipart/form-data">
          <div class="mb-3 text-center">
            <div class="avatar-preview-container">
              {% if get_avatar_url() %}
              <img src="{{ url_for('static', filename=get_avatar_url()) }}" id="avatar-preview" class="profile-upload-preview">
              {% else %}
              <div id="avatar-preview" class="profile-upload-preview profile-avatar-placeholder">
                <i class="fas fa-user fa-3x"></i>
              </div>
              {% endif %}
            </div>
            
            <div class="avatar-upload-controls">
              <label for="avatar" class="avatar-upload-btn">
                <i class="fas fa-upload"></i>
                Fotoğraf Seç
              </label>
              <input type="file" id="avatar" name="avatar" accept="image/*" style="display: none;">
              
              <button type="button" id="remove-avatar" class="avatar-remove-btn">
                <i class="fas fa-trash-alt"></i>
                Fotoğrafı Kaldır
              </button>
            </div>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
            <button type="submit" class="btn btn-primary">Kaydet</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Profili Düzenle</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="{{ url_for('update_profile') }}" method="post">
          <div class="mb-3">
            <label for="modal-username" class="form-label">Kullanıcı Adı</label>
            <input type="text" class="form-control" id="modal-username" name="username" value="{{ get_current_user().username }}">
          </div>
          
          <div class="mb-3">
            <label for="modal-email" class="form-label">E-posta</label>
            <input type="email" class="form-control" id="modal-email" name="email" value="{{ get_current_user().email }}">
          </div>
          
          <div class="mb-3">
            <label for="modal-fullname" class="form-label">Tam İsim</label>
            <input type="text" class="form-control" id="modal-fullname" name="full_name" value="{{ get_current_user().full_name or '' }}">
          </div>
          
          <div class="mb-3">
            <label for="modal-bio" class="form-label">Hakkımda</label>
            <textarea class="form-control" id="modal-bio" name="bio" rows="3">{{ get_current_user().bio or '' }}</textarea>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
            <button type="submit" class="btn btn-primary">Kaydet</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Password Change Modal -->
<div class="modal fade" id="passwordModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Şifre Değiştir</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="{{ url_for('change_password') }}" method="post">
          <div class="mb-3">
            <label for="current-password" class="form-label">Mevcut Şifre</label>
            <input type="password" class="form-control" id="current-password" name="current_password" required>
          </div>
          
          <div class="mb-3">
            <label for="new-password" class="form-label">Yeni Şifre</label>
            <input type="password" class="form-control" id="new-password" name="new_password" required>
          </div>
          
          <div class="mb-3">
            <label for="confirm-password" class="form-label">Yeni Şifre (Tekrar)</label>
            <input type="password" class="form-control" id="confirm-password" name="confirm_password" required>
          </div>
          
          <div id="password-strength" class="password-strength mb-3">
            <div class="progress">
              <div class="progress-bar" role="progressbar" style="width: 0%"></div>
            </div>
            <small>Şifre Gücü: <span id="strength-text">Çok Zayıf</span></small>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
            <button type="submit" class="btn btn-primary">Şifreyi Değiştir</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-danger">Hesabı Sil</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <strong>Uyarı:</strong> Hesabınızı silmek tüm verilerinizi ve ilerlemenizi kalıcı olarak silecektir. Bu işlem geri alınamaz!
        </div>
        
        <form action="{{ url_for('delete_account') }}" method="post">
          <div class="mb-3">
            <label for="delete-password" class="form-label">Şifrenizi girin</label>
            <input type="password" class="form-control" id="delete-password" name="password" required>
          </div>
          
          <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="confirm-delete" name="confirm_delete" required>
            <label class="form-check-label" for="confirm-delete">Hesabımı kalıcı olarak silmek istediğimi onaylıyorum</label>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
            <button type="submit" class="btn btn-danger">Hesabımı Sil</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Suspend Account Modal -->
<div class="modal fade" id="suspendAccountModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-warning">Hesabı Dondur</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning">
          <i class="fas fa-pause-circle me-2"></i>
          <strong>Bilgi:</strong> Hesabınızı dondurduğunuzda, 30 gün boyunca hesabınıza erişemezsiniz. 30 gün sonunda tekrar giriş yapabilirsiniz.
        </div>
        
        <form action="{{ url_for('suspend_account') }}" method="post">
          <div class="mb-3">
            <label for="suspend-password" class="form-label">Şifrenizi girin</label>
            <input type="password" class="form-control" id="suspend-password" name="password" required>
          </div>
          
          <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="confirm-suspend" name="confirm_suspend" required>
            <label class="form-check-label" for="confirm-suspend">Hesabımı 30 gün boyunca dondurmak istediğimi onaylıyorum</label>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
            <button type="submit" class="btn btn-warning">Hesabımı Dondur</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Level Up Animation Container -->
<div class="level-up-container" id="levelUpAnimation" style="display: none;">
  <div class="level-up-content">
    <div class="level-up-icon">
      <i class="fas fa-arrow-up"></i>
    </div>
    <div class="level-up-text">Seviye Atladın!</div>
    <div class="level-up-level">Seviye <span id="newLevel">10</span></div>
    <div class="level-up-rewards">
      <div class="reward">
        <i class="fas fa-unlock"></i>
        <span>Yeni oyunlar açıldı</span>
      </div>
      <div class="reward">
        <i class="fas fa-medal"></i>
        <span>Yeni başarılar açıldı</span>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Tab system functionality
  const tabs = document.querySelectorAll('.profile-tab');
  const tabContents = document.querySelectorAll('.tab-content');
  const tabIndicator = document.querySelector('.tab-indicator');
  
  // Position tab indicator on load
  positionTabIndicator(document.querySelector('.profile-tab.active'));
  
  tabs.forEach(tab => {
    tab.addEventListener('click', function() {
      // Remove active class from all tabs and contents
      tabs.forEach(t => t.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));
      
      // Add active class to clicked tab and corresponding content
      this.classList.add('active');
      document.getElementById(`${this.dataset.tab}-tab`).classList.add('active');
      
      // Position the indicator
      positionTabIndicator(this);
    });
  });
  
  function positionTabIndicator(activeTab) {
    if (tabIndicator && activeTab) {
      tabIndicator.style.width = `${activeTab.offsetWidth}px`;
      tabIndicator.style.left = `${activeTab.offsetLeft}px`;
    }
  }
  
  // Theme toggle functionality
  const themeToggle = document.getElementById('themeToggle');
  
  if (themeToggle) {
    themeToggle.addEventListener('change', function() {
      const html = document.documentElement;
      
      if (this.checked) {
        html.classList.remove('dark');
        html.classList.add('light');
      } else {
        html.classList.remove('light');
        html.classList.add('dark');
      }
      
      // Save theme preference via AJAX
      fetch('/update-theme', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          theme: this.checked ? 'light' : 'dark'
        })
      });
    });
  }
  
  // Password strength meter
  const passwordInputs = document.querySelectorAll('input[type="password"][id$="new-password"], input[type="password"][id$="new_password"]');
  
  passwordInputs.forEach(input => {
    input.addEventListener('input', function() {
      const parentForm = this.closest('form');
      const strengthMeter = parentForm.querySelector('.password-strength .progress-bar') || 
                            parentForm.querySelector('.strength-meter');
      const strengthText = parentForm.querySelector('#strength-text') ||
                          parentForm.querySelector('.strength-text span');
      
      if (strengthMeter && strengthText) {
        const strength = checkPasswordStrength(this.value);
        updatePasswordStrengthIndicator(strength, strengthMeter, strengthText);
      }
    });
  });
  
  function checkPasswordStrength(password) {
    let strength = 0;
    
    // If password length is less than 6, return 0
    if (password.length < 6) {
      return strength;
    }
    
    // Length check
    if (password.length >= 8) {
      strength += 1;
    }
    
    if (password.length >= 12) {
      strength += 1;
    }
    
    // Character variety checks
    if (/[A-Z]/.test(password)) { // Has uppercase
      strength += 1;
    }
    
    if (/[a-z]/.test(password)) { // Has lowercase
      strength += 1;
    }
    
    if (/[0-9]/.test(password)) { // Has number
      strength += 1;
    }
    
    if (/[^A-Za-z0-9]/.test(password)) { // Has special character
      strength += 1;
    }
    
    return Math.min(5, strength);
  }
  
  function updatePasswordStrengthIndicator(strength, meter, text) {
    const strengthClasses = ['bg-danger', 'bg-warning', 'bg-info', 'bg-primary', 'bg-success'];
    const strengthLabels = ['Çok Zayıf', 'Zayıf', 'Orta', 'İyi', 'Mükemmel'];
    
    // Clear existing classes
    meter.className = meter.classList.contains('progress-bar') ? 'progress-bar' : 'strength-meter';
    
    if (meter.classList.contains('progress-bar')) {
      // For Bootstrap progress bar
      meter.style.width = `${(strength / 5) * 100}%`;
      meter.classList.add(strengthClasses[Math.max(0, strength - 1)]);
    } else {
      // For custom meter
      meter.style.width = `${(strength / 5) * 100}%`;
      meter.style.backgroundColor = getComputedStyle(document.documentElement)
        .getPropertyValue(strength <= 1 ? '--bs-danger' : 
                          strength <= 2 ? '--bs-warning' : 
                          strength <= 3 ? '--bs-info' : 
                          strength <= 4 ? '--bs-primary' : '--bs-success');
    }
    
    text.textContent = strengthLabels[Math.max(0, strength - 1)];
  }
  
  // Toggle password visibility
  const togglePasswordButtons = document.querySelectorAll('.toggle-password');
  
  togglePasswordButtons.forEach(button => {
    button.addEventListener('click', function() {
      const passwordInput = this.previousElementSibling;
      const icon = this.querySelector('i');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        passwordInput.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    });
  });
  
  // Avatar preview functionality
  const avatarInput = document.getElementById('avatar');
  const avatarPreview = document.getElementById('avatar-preview');
  const removeAvatarBtn = document.getElementById('remove-avatar');
  
  if (avatarInput && avatarPreview) {
    avatarInput.addEventListener('change', function() {
      if (this.files && this.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          if (avatarPreview.tagName.toLowerCase() === 'img') {
            avatarPreview.src = e.target.result;
          } else {
            // If it's a div (placeholder), replace it with an img
            const img = document.createElement('img');
            img.id = 'avatar-preview';
            img.className = 'profile-upload-preview';
            img.src = e.target.result;
            
            avatarPreview.parentNode.replaceChild(img, avatarPreview);
          }
        };
        
        reader.readAsDataURL(this.files[0]);
      }
    });
  }
  
  if (removeAvatarBtn && avatarPreview) {
    removeAvatarBtn.addEventListener('click', function() {
      if (avatarPreview.tagName.toLowerCase() === 'img') {
        // Replace img with placeholder
        const placeholder = document.createElement('div');
        placeholder.id = 'avatar-preview';
        placeholder.className = 'profile-upload-preview profile-avatar-placeholder';
        placeholder.innerHTML = '<i class="fas fa-user fa-3x"></i>';
        
        avatarPreview.parentNode.replaceChild(placeholder, avatarPreview);
      }
      
      // Clear the file input
      if (avatarInput) {
        avatarInput.value = '';
      }
    });
  }
  
  // Show level up animation (demo purposes)
  const levelUpBtn = document.querySelector('.level-badge');
  const levelUpAnimation = document.getElementById('levelUpAnimation');
  
  if (levelUpBtn && levelUpAnimation) {
    levelUpBtn.addEventListener('click', function() {
      // Display level up animation
      levelUpAnimation.style.display = 'flex';
      
      // Hide after animation completes
      setTimeout(() => {
        levelUpAnimation.style.display = 'none';
      }, 3000);
    });
  }
});
</script>
{% endblock %}