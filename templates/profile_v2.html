{% extends 'layout.html' %}

{% block title %}{{ user.username }} | Profil - OmGame{% endblock %}

{% block content %}
<div class="container profile-container">
  <div class="row">
    <!-- Sol Kolon - Profil Bilgileri -->
    <div class="col-lg-3">
      <div class="glass-card profile-card">
        <!-- Profil Resmi ve Statüsü -->
        <div class="profile-image-container">
          <div class="profile-avatar">
            {% if user.avatar_url %}
              <img src="{{ url_for('static', filename=user.avatar_url) }}" alt="{{ user.username }}" class="profile-img">
            {% else %}
              <div class="profile-avatar-placeholder">{{ user.username[0]|upper }}</div>
            {% endif %}
            <div class="profile-status online"></div>
          </div>
        </div>
        
        <!-- Kullanıcı Bilgileri -->
        <div class="profile-info">
          <h2 class="profile-name">{{ user.username }}</h2>
          <p class="profile-title">{{ user.rank }}</p>
          
          <!-- Seviye Bilgisi -->
          <div class="level-progress-container">
            <div class="level-badge">{{ current_level }}</div>
            <div class="level-progress-bar">
              <div class="level-progress" style="width: {{ ((user.experience_points - xp_for_current) / (xp_for_next - xp_for_current) * 100)|round }}%"></div>
            </div>
            <p class="level-text">{{ user.experience_points|int }} / {{ xp_for_next|int }} XP</p>
          </div>
        </div>
        
        <!-- İstatistikler Kaldırıldı -->
        
        <!-- Kişisel Bilgiler -->
        <div class="personal-info-container">
          {% if user.full_name %}
          <div class="info-item">
            <i class="fas fa-user"></i>
            <span>{{ user.full_name }}</span>
          </div>
          {% endif %}
          
          {% if user.location %}
          <div class="info-item">
            <i class="fas fa-map-marker-alt"></i>
            <span>{{ user.location }}</span>
          </div>
          {% endif %}
          
          <div class="info-item">
            <i class="fas fa-envelope"></i>
            <span>{{ user.email }}</span>
          </div>
          
          <div class="info-item">
            <i class="fas fa-calendar-alt"></i>
            <span>Kayıt: {{ user.created_at.strftime('%d.%m.%Y') }}</span>
          </div>
        </div>
        
        {% if user.bio %}
        <div class="bio-container">
          <h3 class="section-title">Hakkımda</h3>
          <p class="bio-text">{{ user.bio }}</p>
        </div>
        {% endif %}
      </div>
    </div>
    
    <!-- Sağ Kolon - Sekmeler -->
    <div class="col-lg-9">
      <div class="glass-card">
        <!-- Sekme Başlıkları -->
        <div class="profile-tab-container">
          <div class="tab-navigation">
            <button class="tab-button" data-tab="avatars">
              <i class="fas fa-user-circle"></i> Avatarlar
            </button>
            <button class="tab-button" data-tab="achievements">
              <i class="fas fa-trophy"></i> Başarılar
            </button>
            <button class="tab-button" data-tab="security">
              <i class="fas fa-shield-alt"></i> Güvenlik
            </button>
            <button class="tab-button" data-tab="settings">
              <i class="fas fa-cog"></i> Ayarlar
            </button>
            <div class="tab-indicator"></div>
          </div>
          
          <!-- Sekme İçerikleri -->
          <div class="tab-content-container">
            <!-- Başarılar ve İstatistikler Sekmeleri Kaldırıldı -->
            
            <!-- Güvenlik Sekmesi -->
            <div class="tab-content" id="security-tab">
              <h3 class="tab-title">Hesap Güvenliği</h3>
              
              <div class="security-settings">
                <!-- Şifre Değiştirme -->
                <div class="setting-card">
                  <div class="setting-header">
                    <div class="setting-icon">
                      <i class="fas fa-lock"></i>
                    </div>
                    <div class="setting-info">
                      <h4>Şifre Değiştir</h4>
                      <p>Hesabınızın güvenliği için şifrenizi düzenli olarak değiştirin</p>
                    </div>
                  </div>
                  <div class="setting-actions">
                    <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                      Şifre Değiştir
                    </button>
                  </div>
                </div>
                
                <!-- Email Güncelleme -->
                <div class="setting-card">
                  <div class="setting-header">
                    <div class="setting-icon">
                      <i class="fas fa-envelope"></i>
                    </div>
                    <div class="setting-info">
                      <h4>Email Adresi</h4>
                      <p>Mevcut email adresiniz: {{ user.email }}</p>
                    </div>
                  </div>
                  <div class="setting-actions">
                    <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#changeEmailModal">
                      Email Değiştir
                    </button>
                  </div>
                </div>
                
                <!-- Hesap Silme -->
                <div class="setting-card danger-setting">
                  <div class="setting-header">
                    <div class="setting-icon danger">
                      <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="setting-info">
                      <h4>Hesabı Sil</h4>
                      <p>Hesabınız ve tüm verileriniz kalıcı olarak silinecektir</p>
                    </div>
                  </div>
                  <div class="setting-actions">
                    <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                      Hesabı Sil
                    </button>
                  </div>
                </div>
                
                <!-- Hesabı Dondurma -->
                <div class="setting-card warning-setting">
                  <div class="setting-header">
                    <div class="setting-icon warning">
                      <i class="fas fa-snowflake"></i>
                    </div>
                    <div class="setting-info">
                      <h4>Hesabı Dondur</h4>
                      <p>Hesabınız geçici olarak devre dışı bırakılacak ve istediğiniz zaman tekrar aktifleştirebilirsiniz</p>
                    </div>
                  </div>
                  <div class="setting-actions">
                    <button type="button" class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#suspendAccountModal">
                      Hesabı Dondur
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Ayarlar Sekmesi -->
            <div class="tab-content" id="settings-tab">
              <h3 class="tab-title">Hesap Ayarları</h3>
              
              <div class="settings-container">
                <!-- Profil Bilgileri -->
                <div class="setting-section">
                  <h4 class="section-title">Profil Bilgileri</h4>
                  
                  <form id="profile-form" action="{{ url_for('update_profile') }}" method="post">
                    <div class="row mb-3">
                      <div class="col-md-6">
                        <label for="fullName" class="form-label">Ad Soyad</label>
                        <input type="text" class="form-control" id="fullName" name="full_name" value="{{ user.full_name or '' }}">
                      </div>
                      <div class="col-md-6">
                        <label for="username" class="form-label">Kullanıcı Adı</label>
                        <input type="text" class="form-control" id="username" name="username" value="{{ user.username }}" disabled>
                        <small class="text-muted">Kullanıcı adı değiştirilemez</small>
                      </div>
                    </div>
                    
                    <div class="row mb-3">
                      <div class="col-md-6">
                        <label for="location" class="form-label">Konum</label>
                        <input type="text" class="form-control" id="location" name="location" value="{{ user.location or '' }}">
                      </div>
                      <div class="col-md-6">
                        <label for="age" class="form-label">Yaş</label>
                        <input type="number" class="form-control" id="age" name="age" value="{{ user.age or '' }}">
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <label for="bio" class="form-label">Hakkımda</label>
                      <textarea class="form-control" id="bio" name="bio" rows="3">{{ user.bio or '' }}</textarea>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                      <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Değişiklikleri Kaydet
                      </button>
                    </div>
                  </form>
                </div>
                
                <!-- Profil Fotoğrafı -->
                <div class="setting-section">
                  <h4 class="section-title">Profil Fotoğrafı</h4>
                  
                  <form id="avatar-form" action="{{ url_for('update_avatar') }}" method="post" enctype="multipart/form-data">
                    <div class="row align-items-center">
                      <div class="col-md-4">
                        <div class="profile-upload-preview">
                          {% if user.avatar_url %}
                            <img src="{{ url_for('static', filename=user.avatar_url) }}" alt="{{ user.username }}" id="avatar-preview">
                          {% else %}
                            <div class="avatar-placeholder" id="avatar-preview-placeholder">{{ user.username[0]|upper }}</div>
                          {% endif %}
                          <div class="avatar-overlay">
                            <i class="fas fa-camera"></i>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-8">
                        <div class="mb-3">
                          <label for="avatarUpload" class="form-label">Fotoğraf Yükle</label>
                          <input class="form-control" type="file" id="avatarUpload" name="avatar" accept="image/*">
                          <small class="text-muted">Maksimum dosya boyutu: 5MB. İzin verilen formatlar: JPEG, PNG, GIF</small>
                        </div>
                        <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                          <button type="submit" class="btn btn-primary">
                            <i class="fas fa-upload me-2"></i>Fotoğrafı Güncelle
                          </button>
                          {% if user.avatar_url %}
                          <button type="button" class="btn btn-outline-danger" id="removeAvatar">
                            <i class="fas fa-trash-alt me-2"></i>Fotoğrafı Kaldır
                          </button>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  </form>
                </div>
                
                <!-- Bildirim Ayarları -->
                <div class="setting-section">
                  <h4 class="section-title">Bildirim Ayarları</h4>
                  
                  <form id="notification-form" action="{{ url_for('update_notification_settings') }}" method="post">
                    <div class="notification-options">
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="emailNotifications" name="email_notifications" {% if user.email_notifications %}checked{% endif %}>
                        <label class="form-check-label" for="emailNotifications">
                          Email Bildirimleri
                          <small class="text-muted d-block">Önemli güncellemeler ve özel teklifler hakkında bildirimler alın</small>
                        </label>
                      </div>
                      
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="achievementNotifications" name="achievement_notifications" {% if user.achievement_notifications %}checked{% endif %}>
                        <label class="form-check-label" for="achievementNotifications">
                          Başarı Bildirimleri
                          <small class="text-muted d-block">Yeni başarılar kazandığınızda bildirim alın</small>
                        </label>
                      </div>
                      
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="leaderboardNotifications" name="leaderboard_notifications" {% if user.leaderboard_notifications %}checked{% endif %}>
                        <label class="form-check-label" for="leaderboardNotifications">
                          Skor Tablosu Bildirimleri
                          <small class="text-muted d-block">Skor tablolarındaki değişiklikler hakkında bildirim alın</small>
                        </label>
                      </div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
                      <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Bildirimleri Güncelle
                      </button>
                    </div>
                  </form>
                </div>
                
                <!-- Tema Ayarları -->
                <div class="setting-section">
                  <h4 class="section-title">Görünüm Ayarları</h4>
                  
                  <form id="theme-form" action="{{ url_for('update_theme') }}" method="post">
                    <div class="theme-options">
                      <div class="theme-option-card {% if user.theme_preference == 'dark' %}active{% endif %}" data-theme="dark">
                        <div class="theme-preview dark-theme">
                          <div class="theme-preview-header"></div>
                          <div class="theme-preview-body">
                            <div class="preview-line"></div>
                            <div class="preview-line"></div>
                            <div class="preview-line"></div>
                          </div>
                        </div>
                        <div class="theme-name">
                          <i class="fas fa-moon me-2"></i>Koyu Tema
                        </div>
                        <input type="radio" name="theme_preference" value="dark" class="d-none" {% if user.theme_preference == 'dark' %}checked{% endif %}>
                      </div>
                      
                      <div class="theme-option-card {% if user.theme_preference == 'light' %}active{% endif %}" data-theme="light">
                        <div class="theme-preview light-theme">
                          <div class="theme-preview-header"></div>
                          <div class="theme-preview-body">
                            <div class="preview-line"></div>
                            <div class="preview-line"></div>
                            <div class="preview-line"></div>
                          </div>
                        </div>
                        <div class="theme-name">
                          <i class="fas fa-sun me-2"></i>Açık Tema
                        </div>
                        <input type="radio" name="theme_preference" value="light" class="d-none" {% if user.theme_preference == 'light' %}checked{% endif %}>
                      </div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
                      <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Temayı Güncelle
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Şifre Değiştirme Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content glass-card">
      <div class="modal-header">
        <h5 class="modal-title" id="changePasswordModalLabel">Şifre Değiştir</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="change-password-form" action="{{ url_for('change_password') }}" method="post">
          <div class="mb-3">
            <label for="currentPassword" class="form-label">Mevcut Şifre</label>
            <input type="password" class="form-control" id="currentPassword" name="current_password" required>
          </div>
          <div class="mb-3">
            <label for="newPassword" class="form-label">Yeni Şifre</label>
            <input type="password" class="form-control" id="newPassword" name="new_password" required>
            <small class="text-muted">Şifreniz en az 8 karakter olmalı ve en az bir rakam içermelidir</small>
          </div>
          <div class="mb-3">
            <label for="confirmPassword" class="form-label">Yeni Şifre (Tekrar)</label>
            <input type="password" class="form-control" id="confirmPassword" name="confirm_password" required>
          </div>
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save me-2"></i>Şifreyi Güncelle
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Email Değiştirme Modal -->
<div class="modal fade" id="changeEmailModal" tabindex="-1" aria-labelledby="changeEmailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content glass-card">
      <div class="modal-header">
        <h5 class="modal-title" id="changeEmailModalLabel">Email Değiştir</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="change-email-form" action="{{ url_for('update_security_settings') }}" method="post">
          <div class="mb-3">
            <label for="currentEmail" class="form-label">Mevcut Email</label>
            <input type="email" class="form-control" id="currentEmail" value="{{ user.email }}" disabled>
          </div>
          <div class="mb-3">
            <label for="newEmail" class="form-label">Yeni Email</label>
            <input type="email" class="form-control" id="newEmail" name="new_email" required>
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Şifreniz</label>
            <input type="password" class="form-control" id="password" name="password" required>
            <small class="text-muted">Güvenlik için lütfen şifrenizi girin</small>
          </div>
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save me-2"></i>Email'i Güncelle
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Hesap Silme Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content glass-card">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteAccountModalLabel">Hesabı Sil</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <strong>Dikkat:</strong> Hesabınızı silmek tüm verilerinizi kalıcı olarak silecektir. Bu işlem geri alınamaz.
        </div>
        <form id="delete-account-form" action="{{ url_for('delete_account') }}" method="post">
          <div class="mb-3">
            <label for="confirmDelete" class="form-label">Onaylamak için "SİL" yazın</label>
            <input type="text" class="form-control" id="confirmDelete" name="confirm_delete" required>
          </div>
          <div class="mb-3">
            <label for="deletePassword" class="form-label">Şifreniz</label>
            <input type="password" class="form-control" id="deletePassword" name="password" required>
          </div>
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-danger">
              <i class="fas fa-trash-alt me-2"></i>Hesabı Kalıcı Olarak Sil
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Hesabı Dondurma Modal -->
<div class="modal fade" id="suspendAccountModal" tabindex="-1" aria-labelledby="suspendAccountModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content glass-card">
      <div class="modal-header">
        <h5 class="modal-title" id="suspendAccountModalLabel">Hesabı Dondur</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning">
          <i class="fas fa-snowflake me-2"></i>
          <strong>Bilgi:</strong> Hesabınızı dondurduğunuzda tekrar giriş yapana kadar hesabınız devre dışı kalacaktır.
        </div>
        <form id="suspend-account-form" action="{{ url_for('suspend_account') }}" method="post">
          <div class="mb-3">
            <label for="suspendDuration" class="form-label">Dondurma Süresi</label>
            <select class="form-select" id="suspendDuration" name="suspend_duration">
              <option value="1">1 Hafta</option>
              <option value="2">2 Hafta</option>
              <option value="4">1 Ay</option>
              <option value="12">3 Ay</option>
              <option value="0">Tekrar giriş yapana kadar</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="suspendPassword" class="form-label">Şifreniz</label>
            <input type="password" class="form-control" id="suspendPassword" name="password" required>
          </div>
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-warning">
              <i class="fas fa-snowflake me-2"></i>Hesabı Dondur
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Tab navigasyonu
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    const tabIndicator = document.querySelector('.tab-indicator');
    
    function positionTabIndicator(activeTab) {
      if (!tabIndicator || !activeTab) return;
      
      const tabLeft = activeTab.offsetLeft;
      const tabWidth = activeTab.offsetWidth;
      
      tabIndicator.style.width = `${tabWidth}px`;
      tabIndicator.style.left = `${tabLeft}px`;
    }
    
    // İlk yüklemede aktif sekmenin altını çiz
    const activeTab = document.querySelector('.tab-button.active');
    if (activeTab) {
      positionTabIndicator(activeTab);
    }
    
    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        // Aktif sekme sınıfını kaldır
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // Tıklanan sekmeyi ve içeriğini aktifleştir
        button.classList.add('active');
        const tabId = `${button.dataset.tab}-tab`;
        document.getElementById(tabId).classList.add('active');
        
        // Tab göstergesini konumlandır
        positionTabIndicator(button);
      });
    });
    
    // Profil resmi önizleme
    const avatarUpload = document.getElementById('avatarUpload');
    const avatarPreview = document.getElementById('avatar-preview');
    const avatarPlaceholder = document.getElementById('avatar-preview-placeholder');
    
    if (avatarUpload) {
      avatarUpload.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            if (avatarPreview) {
              avatarPreview.src = e.target.result;
              avatarPreview.style.display = 'block';
            }
            if (avatarPlaceholder) {
              avatarPlaceholder.style.display = 'none';
            }
          }
          
          reader.readAsDataURL(this.files[0]);
        }
      });
    }
    
    // Tema seçimi için event listener
    const themeOptions = document.querySelectorAll('.theme-option-card');
    themeOptions.forEach(option => {
      option.addEventListener('click', function() {
        themeOptions.forEach(opt => opt.classList.remove('active'));
        this.classList.add('active');
        const themeInput = this.querySelector('input[type="radio"]');
        if (themeInput) {
          themeInput.checked = true;
        }
      });
    });
    
    // Şifre değiştirme formu doğrulama
    const changePasswordForm = document.getElementById('change-password-form');
    if (changePasswordForm) {
      changePasswordForm.addEventListener('submit', function(e) {
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        if (newPassword !== confirmPassword) {
          e.preventDefault();
          alert('Yeni şifre ve tekrarı eşleşmiyor!');
        }
      });
    }
    
    // Hesap silme formu doğrulama
    const deleteAccountForm = document.getElementById('delete-account-form');
    if (deleteAccountForm) {
      deleteAccountForm.addEventListener('submit', function(e) {
        const confirmText = document.getElementById('confirmDelete').value;
        
        if (confirmText !== 'SİL') {
          e.preventDefault();
          alert('Hesabı silmek için metni doğru şekilde yazın!');
        }
      });
    }
    
    // Bildirim formunu otomatik gönder
    const notificationSwitches = document.querySelectorAll('#notification-form .form-check-input');
    notificationSwitches.forEach(switchElement => {
      switchElement.addEventListener('change', function() {
        // Formu otomatik gönder
        document.getElementById('notification-form').submit();
      });
    });
  });
</script>
{% endblock %}
<!-- Avatars Tab Content -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Avatar selection functionality
  const selectAvatarButtons = document.querySelectorAll('.select-avatar-btn');
  
  selectAvatarButtons.forEach(button => {
    button.addEventListener('click', function() {
      const avatarId = this.getAttribute('data-avatar-id');
      
      // Send AJAX request to select the avatar
      fetch('/select-avatar', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify({
          avatar_id: avatarId
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Update UI to show the newly selected avatar
          document.querySelectorAll('.avatar-item').forEach(item => {
            item.classList.remove('selected');
            const selectBtn = item.querySelector('.select-avatar-btn');
            selectBtn.classList.remove('btn-success', 'disabled');
            selectBtn.classList.add('btn-primary');
            selectBtn.innerHTML = '<i class="fas fa-check me-1"></i>Seç';
            selectBtn.disabled = false;
          });
          
          const selectedItem = document.querySelector(`.avatar-item[data-avatar-id="${avatarId}"]`);
          selectedItem.classList.add('selected');
          const selectedBtn = selectedItem.querySelector('.select-avatar-btn');
          selectedBtn.classList.remove('btn-primary');
          selectedBtn.classList.add('btn-success', 'disabled');
          selectedBtn.innerHTML = '<i class="fas fa-check-circle me-1"></i>Seçildi';
          selectedBtn.disabled = true;
          
          // Update profile avatar display
          const avatarImg = selectedItem.querySelector('.avatar-image').src;
          const profileImg = document.querySelector('.profile-img');
          if (profileImg) {
            profileImg.src = avatarImg;
          } else {
            const placeholder = document.querySelector('.profile-avatar-placeholder');
            if (placeholder) {
              placeholder.parentNode.innerHTML = `<img src="${avatarImg}" alt="Profile Avatar" class="profile-img">`;
            }
          }
          
          // Show success notification
          showNotification('success', 'Avatar başarıyla değiştirildi!');
        } else {
          // Show error notification
          showNotification('error', data.message || 'Avatar değiştirilemedi!');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showNotification('error', 'Bir hata oluştu!');
      });
    });
  });
  
  // Helper function to show notifications
  function showNotification(type, message) {
    const notifContainer = document.getElementById('notification-container');
    if (!notifContainer) {
      const container = document.createElement('div');
      container.id = 'notification-container';
      document.body.appendChild(container);
    }
    
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
      <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
      <span>${message}</span>
    `;
    
    document.getElementById('notification-container').appendChild(notification);
    
    setTimeout(() => {
      notification.classList.add('show');
    }, 10);
    
    setTimeout(() => {
      notification.classList.remove('show');
      setTimeout(() => {
        notification.remove();
      }, 300);
    }, 3000);
  }
});
</script>

<!-- CSS for avatars and achievements -->
<style>
.avatar-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.avatar-item {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  padding: 1rem;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.avatar-item.selected {
  background: rgba(92, 184, 92, 0.1);
  border: 1px solid rgba(92, 184, 92, 0.5);
}

.avatar-item.locked {
  opacity: 0.7;
}

.avatar-image-container {
  width: 100%;
  height: 160px;
  overflow: hidden;
  border-radius: 8px;
  position: relative;
  background: rgba(0, 0, 0, 0.1);
  margin-bottom: 0.75rem;
}

.avatar-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.avatar-item:hover .avatar-image:not(.avatar-item.locked .avatar-image) {
  transform: scale(1.05);
}

.avatar-selected-badge {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  background: #5cb85c;
  color: white;
  width: 25px;
  height: 25px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.avatar-image-blur {
  position: absolute;
  width: 100%;
  height: 100%;
  backdrop-filter: blur(5px);
}

.avatar-lock-icon {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.6);
  color: white;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
}

.avatar-name {
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.avatar-description {
  font-size: 0.875rem;
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 0.75rem;
  line-height: 1.4;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.avatar-unlocked-date {
  font-size: 0.75rem;
  color: rgba(255, 255, 255, 0.5);
  display: block;
  margin-bottom: 0.75rem;
}

.avatar-actions {
  display: flex;
  justify-content: flex-end;
}

.avatar-requirement {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.requirement-badge {
  font-size: 0.75rem;
  padding: 0.25rem 0.5rem;
  border-radius: 20px;
  display: inline-flex;
  align-items: center;
}

.requirement-badge.achievement {
  background: rgba(255, 193, 7, 0.2);
  color: #ffc107;
}

.requirement-badge.level {
  background: rgba(13, 110, 253, 0.2);
  color: #0d6efd;
}

.section-subtitle {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 1rem;
  color: rgba(255, 255, 255, 0.9);
}

.section-intro {
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 1.5rem;
}

.empty-state {
  grid-column: 1 / -1;
  text-align: center;
  padding: 3rem 1rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
}

.empty-state.small {
  padding: 2rem 1rem;
}

.empty-state-icon {
  font-size: 3rem;
  color: rgba(255, 255, 255, 0.3);
  margin-bottom: 1rem;
}

.empty-state h3 {
  font-size: 1.25rem;
  margin-bottom: 0.5rem;
}

.empty-state p {
  color: rgba(255, 255, 255, 0.7);
}

/* Achievement styling */
.achievement-stats {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1rem;
  margin-bottom: 2rem;
}

.achievement-stat-item {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  padding: 1rem;
  text-align: center;
}

.stat-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: #0d6efd;
  margin-bottom: 0.25rem;
}

.stat-label {
  font-size: 0.875rem;
  color: rgba(255, 255, 255, 0.7);
}

.achievement-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.achievement-item {
  display: flex;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  padding: 1rem;
  transition: all 0.3s ease;
}

.achievement-item.completed {
  background: rgba(92, 184, 92, 0.1);
  border: 1px solid rgba(92, 184, 92, 0.3);
}

.achievement-icon {
  width: 60px;
  height: 60px;
  border-radius: 8px;
  overflow: hidden;
  background: rgba(0, 0, 0, 0.2);
  margin-right: 1rem;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.achievement-icon img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.achievement-lock {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: rgba(255, 255, 255, 0.5);
  font-size: 1.5rem;
}

.achievement-info {
  flex: 1;
}

.achievement-name {
  font-size: 1.125rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.achievement-description {
  font-size: 0.875rem;
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 0.75rem;
}

.achievement-progress {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.achievement-progress .progress {
  flex: 1;
  height: 8px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 4px;
  overflow: hidden;
}

.achievement-progress .progress-bar {
  height: 100%;
  background: #0d6efd;
  border-radius: 4px;
}

.achievement-progress .progress-text {
  font-size: 0.75rem;
  color: rgba(255, 255, 255, 0.7);
  width: 40px;
  text-align: right;
}

.achievement-completed {
  font-size: 0.75rem;
  color: #5cb85c;
  display: flex;
  align-items: center;
}

.achievement-reward {
  display: flex;
  align-items: center;
  margin-left: 1rem;
}

.points-badge {
  background: rgba(255, 193, 7, 0.2);
  color: #ffc107;
  font-size: 0.75rem;
  padding: 0.25rem 0.5rem;
  border-radius: 20px;
  display: inline-flex;
  align-items: center;
  white-space: nowrap;
}

/* Notification styling */
#notification-container {
  position: fixed;
  top: 1rem;
  right: 1rem;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.notification {
  background: white;
  color: #333;
  padding: 0.75rem 1rem;
  border-radius: 5px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
  display: flex;
  align-items: center;
  transform: translateX(120%);
  transition: transform 0.3s ease;
}

.notification.show {
  transform: translateX(0);
}

.notification i {
  margin-right: 0.5rem;
}

.notification.success i {
  color: #5cb85c;
}

.notification.error i {
  color: #d9534f;
}

@media (max-width: 768px) {
  .achievement-stats {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .achievement-item {
    flex-direction: column;
  }
  
  .achievement-icon {
    margin-right: 0;
    margin-bottom: 1rem;
    width: 80px;
    height: 80px;
  }
  
  .achievement-reward {
    margin-left: 0;
    margin-top: 1rem;
    justify-content: flex-end;
  }
}
</style>
<!-- Avatarlar Sekmesi -->
<div class="tab-content" id="avatars-tab">
  <h3 class="tab-title">Özelleştirilebilir Avatarlar</h3>
  
  <div class="avatars-container">
    <p class="section-intro">Oyun içi başarılarınızla yeni avatarlar açın ve profilinizi özelleştirin.</p>
    <a href="{{ url_for('avatars.avatar_list') }}" class="btn btn-primary mt-2">
      <i class="fas fa-external-link-alt mr-1"></i> Tüm Avatarları Görüntüle
    </a>
    
    <div class="avatar-grid">
      {% for user_avatar in user.avatars %}
        <div class="avatar-item {% if user_avatar.is_selected %}selected{% endif %}" data-avatar-id="{{ user_avatar.avatar_id }}">
          <div class="avatar-image-container">
            <img src="{{ user_avatar.avatar.image_url }}" alt="{{ user_avatar.avatar.name }}" class="avatar-image">
            {% if user_avatar.is_selected %}
              <div class="avatar-selected-badge"><i class="fas fa-check"></i></div>
            {% endif %}
          </div>
          <div class="avatar-info">
            <h4 class="avatar-name">{{ user_avatar.avatar.name }}</h4>
            <p class="avatar-description">{{ user_avatar.avatar.description }}</p>
            <span class="avatar-unlocked-date">{{ user_avatar.unlocked_at.strftime('%d.%m.%Y') }} tarihinde açıldı</span>
          </div>
          <div class="avatar-actions">
            <button class="btn btn-sm {% if user_avatar.is_selected %}btn-success disabled{% else %}btn-primary{% endif %} select-avatar-btn" 
                    {% if user_avatar.is_selected %}disabled{% endif %}
                    data-avatar-id="{{ user_avatar.avatar_id }}">
              {% if user_avatar.is_selected %}
                <i class="fas fa-check-circle me-1"></i>Seçildi
              {% else %}
                <i class="fas fa-check me-1"></i>Seç
              {% endif %}
            </button>
          </div>
        </div>
      {% else %}
        <div class="empty-state">
          <div class="empty-state-icon"><i class="fas fa-user-circle"></i></div>
          <h3>Henüz Avatar Yok</h3>
          <p>Oyun oynayın ve görevleri tamamlayarak özel avatarlar açın!</p>
        </div>
      {% endfor %}
    </div>
    
    <!-- Kilitli Avatarlar -->
    <h4 class="section-subtitle mt-4">Kilitli Avatarlar</h4>
    <div class="avatar-grid locked-avatars">
      {% for avatar in locked_avatars %}
        <div class="avatar-item locked">
          <div class="avatar-image-container">
            <div class="avatar-image-blur">
              <img src="{{ avatar.image_url }}" alt="{{ avatar.name }}" class="avatar-image">
            </div>
            <div class="avatar-lock-icon">
              <i class="fas fa-lock"></i>
            </div>
          </div>
          <div class="avatar-info">
            <h4 class="avatar-name">{{ avatar.name }}</h4>
            <p class="avatar-description">{{ avatar.description }}</p>
            <div class="avatar-requirement">
              {% if avatar.required_achievement_id %}
                <span class="requirement-badge achievement">
                  <i class="fas fa-trophy me-1"></i>{{ avatar.achievement_name }}
                </span>
              {% endif %}
              
              {% if avatar.required_level > 0 %}
                <span class="requirement-badge level">
                  <i class="fas fa-star me-1"></i>Seviye {{ avatar.required_level }}
                </span>
              {% endif %}
            </div>
          </div>
        </div>
      {% else %}
        <div class="empty-state small">
          <div class="empty-state-icon"><i class="fas fa-check-circle"></i></div>
          <h3>Tüm Avatarları Açtınız!</h3>
          <p>Şu an için mevcut tüm avatarları açtınız.</p>
        </div>
      {% endfor %}
    </div>
  </div>
</div>
<!-- Başarılar Sekmesi -->
<div class="tab-content" id="achievements-tab">
  <h3 class="tab-title">Başarılar</h3>
  
  <div class="achievements-container">
    <div class="achievement-stats">
      <div class="achievement-stat-item">
        <div class="stat-value">{{ completed_achievements_count }}</div>
        <div class="stat-label">Tamamlanan</div>
      </div>
      <div class="achievement-stat-item">
        <div class="stat-value">{{ total_achievements_count }}</div>
        <div class="stat-label">Toplam</div>
      </div>
      <div class="achievement-stat-item">
        <div class="stat-value">{{ total_achievement_points }}</div>
        <div class="stat-label">Puan</div>
      </div>
      <div class="achievement-stat-item">
        <div class="stat-value">{{ completion_percentage }}%</div>
        <div class="stat-label">Tamamlama</div>
      </div>
    </div>
    
    <div class="achievement-list">
      {% for user_achievement in user.achievements %}
        <div class="achievement-item {% if user_achievement.progress >= 100 %}completed{% endif %}">
          <div class="achievement-icon">
            {% if user_achievement.progress >= 100 %}
              <img src="{{ user_achievement.achievement.image_url }}" alt="{{ user_achievement.achievement.name }}">
            {% else %}
              <div class="achievement-lock">
                <i class="fas fa-lock"></i>
              </div>
            {% endif %}
          </div>
          <div class="achievement-info">
            <h4 class="achievement-name">{{ user_achievement.achievement.name }}</h4>
            <p class="achievement-description">{{ user_achievement.achievement.description }}</p>
            {% if user_achievement.progress < 100 %}
              <div class="achievement-progress">
                <div class="progress">
                  <div class="progress-bar" role="progressbar" style="width: {{ user_achievement.progress }}%"></div>
                </div>
                <span class="progress-text">{{ user_achievement.progress }}%</span>
              </div>
            {% else %}
              <div class="achievement-completed">
                <i class="fas fa-check-circle me-1"></i>
                <span>{{ user_achievement.unlocked_at.strftime('%d.%m.%Y') }} tarihinde kazanıldı</span>
              </div>
            {% endif %}
          </div>
          <div class="achievement-reward">
            <span class="points-badge">{{ user_achievement.achievement.points }} Puan</span>
          </div>
        </div>
      {% else %}
        <div class="empty-state">
          <div class="empty-state-icon"><i class="fas fa-trophy"></i></div>
          <h3>Henüz Başarı Yok</h3>
          <p>Oyunları oynayarak çeşitli başarılar kazanın!</p>
        </div>
      {% endfor %}
    </div>
  </div>
</div>
