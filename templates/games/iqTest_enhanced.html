{% extends 'layout.html' %}

{% block title %}IQ Test - ZekaPark{% endblock %}

{% block content %}
<div class="page-container">
  <div class="iq-game-wrapper">
    <div class="game-header">
      <h1><i class="fas fa-brain"></i> IQ Test <span class="badge">Zeka ve Mantık</span></h1>
      <p class="game-description">Farklı kategorilerde zeka soruları çözerek düşünme becerilerinizi test edin</p>
    </div>

    <div class="game-dashboard">
      <!-- Sol panel - Test alanı -->
      <div class="game-area-panel">
        <div class="iq-test-container">
          <!-- Karşılama ekranı -->
          <div id="test-intro" class="test-screen">
            <div class="welcome-card">
              <div class="welcome-header">
                <div class="welcome-icon">
                  <i class="fas fa-lightbulb"></i>
                </div>
                <h2>IQ Test'e Hoş Geldiniz</h2>
                <p>Bu test, dört farklı zihinsel yetenek alanında zeka seviyenizi ölçer ve değerlendirir</p>
              </div>

              <div class="test-overview">
                <div class="overview-item">
                  <div class="overview-icon">
                    <i class="fas fa-tasks"></i>
                  </div>
                  <div class="overview-text">
                    <div class="overview-title">20 Soru</div>
                    <div class="overview-desc">4 kategoride özenle hazırlanmış sorular</div>
                  </div>
                </div>

                <div class="overview-item">
                  <div class="overview-icon">
                    <i class="fas fa-clock"></i>
                  </div>
                  <div class="overview-text">
                    <div class="overview-title">20 Dakika</div>
                    <div class="overview-desc">Testi tamamlamak için süre sınırı</div>
                  </div>
                </div>

                <div class="overview-item">
                  <div class="overview-icon">
                    <i class="fas fa-chart-line"></i>
                  </div>
                  <div class="overview-text">
                    <div class="overview-title">Detaylı Analiz</div>
                    <div class="overview-desc">Sonuçlarınızı kategorilere göre görüntüleyin</div>
                  </div>
                </div>
              </div>

              <div class="categories-grid">
                <div class="category-card">
                  <div class="category-icon">
                    <i class="fas fa-project-diagram"></i>
                  </div>
                  <div class="category-title">Mantıksal Düşünme</div>
                  <p class="category-desc">Örüntüleri ve mantıksal ilişkileri tanıyın ve çözümleyin</p>
                </div>

                <div class="category-card">
                  <div class="category-icon">
                    <i class="fas fa-cube"></i>
                  </div>
                  <div class="category-title">Görsel-Uzamsal</div>
                  <p class="category-desc">Şekilleri zihinsel olarak döndürün ve uzamsal ilişkileri anlayın</p>
                </div>

                <div class="category-card">
                  <div class="category-icon">
                    <i class="fas fa-calculator"></i>
                  </div>
                  <div class="category-title">Matematiksel</div>
                  <p class="category-desc">Sayı dizileri ve matematiksel bağlantıları analiz edin</p>
                </div>

                <div class="category-card">
                  <div class="category-icon">
                    <i class="fas fa-comment-alt"></i>
                  </div>
                  <div class="category-title">Sözel Muhakeme</div>
                  <p class="category-desc">Kelime ilişkilerini ve dil kurallarını kavrayın</p>
                </div>
              </div>

              <div class="start-test-container">
                <button id="start-test" class="btn btn-primary btn-lg btn-pulse">
                  <i class="fas fa-play"></i> TESTİ BAŞLAT
                </button>

                <div class="test-disclaimer">
                  Bu test resmi bir IQ ölçümü değildir. Sadece eğitim ve eğlence amaçlıdır.
                </div>
              </div>
            </div>
          </div>

          <!-- Soru ekranı -->
          <div id="test-container" class="test-screen" style="display: none;">
            <div class="test-header">
              <div class="test-info-bar">
                <div class="info-item">
                  <div class="info-label">Soru</div>
                  <div class="info-value" id="question-counter">1/20</div>
                </div>

                <div class="info-item">
                  <div class="info-label">Kategori</div>
                  <div class="info-value" id="current-category">Mantıksal</div>
                </div>

                <div class="info-item timer-item">
                  <div class="info-label">Kalan Süre</div>
                  <div class="info-value" id="timer">20:00</div>
                </div>
              </div>

              <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
              </div>
            </div>

            <div id="question-container" class="question-container">
              <!-- Soruların içeriği JavaScript ile eklenecek -->
            </div>

            <div class="test-navigation">
              <button id="prev-question" class="btn btn-outline-light btn-nav">
                <i class="fas fa-chevron-left"></i> ÖNCEKİ SORU
              </button>

              <div class="navigation-dots" id="navigation-dots">
                <!-- Gezinme noktaları JavaScript ile oluşturulacak -->
              </div>

              <button id="next-question" class="btn btn-outline-light btn-nav">
                SONRAKİ SORU <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>

          <!-- Sonuç ekranı -->
          <div id="test-results" class="test-screen" style="display: none;">
            <div class="results-card">
              <div class="results-header">
                <div class="results-icon">
                  <i class="fas fa-award"></i>
                </div>
                <h2>Test Tamamlandı!</h2>
                <p>Tebrikler! IQ testini başarıyla tamamladınız.</p>
              </div>

              <div class="score-display">
                <div class="score-ring">
                  <div class="score-value" id="iq-score">120</div>
                  <div class="score-label">IQ SKORU</div>
                </div>

                <div class="score-details">
                  <h3>Skor Yorumu</h3>
                  <div class="score-interpretation" id="score-interpretation">
                    Bu skor, ortalamanın üzerinde bir zihinsel performans gösterdiğinizi ifade eder. Farklı problem türlerini çözmede ve karmaşık durumları analiz etmede iyi bir yeteneğe sahipsiniz.
                  </div>

                  <div class="score-benchmark">
                    <div class="benchmark-scale">
                      <div class="scale-marker" style="left: 0%">70</div>
                      <div class="scale-marker" style="left: 25%">90</div>
                      <div class="scale-marker" style="left: 50%">100</div>
                      <div class="scale-marker" style="left: 75%">110</div>
                      <div class="scale-marker" style="left: 100%">130+</div>
                    </div>
                    <div class="scale-bar">
                      <div class="scale-fill" id="score-fill"></div>
                      <div class="scale-indicator" id="score-indicator"></div>
                    </div>
                    <div class="scale-labels">
                      <span>Düşük</span>
                      <span>Orta</span>
                      <span>Yüksek</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="performance-breakdown">
                <h3>Kategori Performansı</h3>
                <div class="chart-container">
                  <canvas id="category-chart"></canvas>
                </div>

                <div class="stat-grid">
                  <div class="stat-item">
                    <div class="stat-label">Doğru Yanıtlar</div>
                    <div class="stat-value" id="correct-answers">12/20</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-label">Tamamlama Süresi</div>
                    <div class="stat-value" id="completion-time">14:25</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-label">Ortalama Yanıt Süresi</div>
                    <div class="stat-value" id="avg-time">43s</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-label">En Güçlü Kategori</div>
                    <div class="stat-value" id="strongest-category">Mantıksal</div>
                  </div>
                </div>
              </div>

              <div class="results-actions">
                <button id="save-results" class="btn btn-primary">
                  <i class="fas fa-save"></i> SONUÇLARI KAYDET
                </button>
                <button id="share-results" class="btn btn-outline-info">
                  <i class="fas fa-share-alt"></i> PAYLAŞ
                </button>
                <button id="restart-test" class="btn btn-outline-light">
                  <i class="fas fa-redo-alt"></i> YENİDEN DENE
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sağ panel - Bilgiler ve İpuçları -->
      <div class="game-info-panel">
        <!-- IQ Bilgileri -->
        <div class="info-card">
          <h3><i class="fas fa-info-circle"></i> IQ Nedir?</h3>

          <div class="info-content">
            <p>IQ (Intelligence Quotient), bireyin bilişsel yeteneklerini ölçen standartlaştırılmış testlerle belirlenen bir zeka ölçüsüdür.</p>

            <div class="info-list">
              <div class="info-list-item">
                <div class="list-icon"><i class="fas fa-check"></i></div>
                <div class="list-text">Ortalama IQ skoru 100 olarak kabul edilir</div>
              </div>
              <div class="info-list-item">
                <div class="list-icon"><i class="fas fa-check"></i></div>
                <div class="list-text">Standart sapma genellikle 15 puandır</div>
              </div>
              <div class="info-list-item">
                <div class="list-icon"><i class="fas fa-check"></i></div>
                <div class="list-text">115-130 arası "yüksek" zeka olarak değerlendirilir</div>
              </div>
              <div class="info-list-item">
                <div class="list-icon"><i class="fas fa-check"></i></div>
                <div class="list-text">130+ "üstün" zeka olarak kabul edilir</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Test İpuçları -->
        <div class="tips-card">
          <h3><i class="fas fa-lightbulb"></i> Test İpuçları</h3>

          <div class="tips-content">
            <div class="tip-item">
              <div class="tip-number">1</div>
              <div class="tip-text">
                <strong>Zaman yönetimi</strong> önemlidir. Her soruya eşit vakit ayırmaya çalışın.
              </div>
            </div>

            <div class="tip-item">
              <div class="tip-number">2</div>
              <div class="tip-text">
                <strong>Zorlandığınız soruları</strong> atlayıp sonra dönmek daha verimli olabilir.
              </div>
            </div>

            <div class="tip-item">
              <div class="tip-number">3</div>
              <div class="tip-text">
                <strong>Örüntülere</strong> dikkat edin. Çoğu IQ sorusu belirli bir mantıksal örüntüye dayanır.
              </div>
            </div>

            <div class="tip-item">
              <div class="tip-number">4</div>
              <div class="tip-text">
                <strong>Sakin kalın</strong> ve soruları düşünerek yanıtlayın. Acele etmek hatalara yol açabilir.
              </div>
            </div>
          </div>
        </div>

        <!-- İstatistikler -->
        <div class="stats-card">
          <h3><i class="fas fa-chart-pie"></i> İstatistikleriniz</h3>

          <div class="stats-content">
            <div class="stat-row">
              <div class="stat-name">En Yüksek IQ Skoru</div>
              <div class="stat-value" id="highest-iq">0</div>
            </div>

            <div class="stat-row">
              <div class="stat-name">Toplam Test Sayısı</div>
              <div class="stat-value" id="total-tests">0</div>
            </div>

            <div class="stat-row">
              <div class="stat-name">En İyi Kategori</div>
              <div class="stat-value" id="best-category">-</div>
            </div>

            <div class="stat-row">
              <div class="stat-name">Ortalama Tamamlama</div>
              <div class="stat-value" id="avg-completion">-</div>
            </div>
          </div>
        </div>

        <!-- Menü Butonu -->
        <a href="{{ url_for('all_games') }}" class="back-to-menu-btn">
          <i class="fas fa-th-large"></i> TÜM OYUNLAR
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Modernize edici -->
{% include 'games/modernizer.html' %}

<!-- Styles -->
<style>
  /* Ana Konteyner Stilleri */
  .iq-game-wrapper {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  .game-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .game-header h1 {
    color: #fff;
    font-size: 2.5rem;
    font-weight: 700;
    text-shadow: 0 0 10px rgba(106, 90, 224, 0.8);
    margin-bottom: 10px;
  }

  .game-header .badge {
    background: linear-gradient(135deg, #6a5ae0, #a992ff);
    color: white;
    padding: 5px 15px;
    border-radius: 30px;
    font-size: 1rem;
    font-weight: 400;
    vertical-align: middle;
    box-shadow: 0 2px 10px rgba(106, 90, 224, 0.5);
  }

  .game-header p {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.1rem;
  }

  /* Dashboard layout */
  .game-dashboard {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  .game-area-panel {
    flex: 1;
    min-width: 320px;
  }

  .game-info-panel {
    width: 320px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* Test Konteyner Stilleri */
  .iq-test-container {
    background: rgba(20, 20, 40, 0.8);
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
                inset 0 0 15px rgba(106, 90, 224, 0.3);
    overflow: hidden;
    border: 1px solid rgba(106, 90, 224, 0.3);
    position: relative;
    min-height: 600px;
    display: flex;
    flex-direction: column;
  }

  .test-screen {
    padding: 30px;
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  /* Karşılama Ekranı */
  .welcome-card {
    background: rgba(30, 30, 50, 0.7);
    border-radius: 15px;
    padding: 30px;
    width: 100%;
    max-width: 800px;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(106, 90, 224, 0.2);
  }

  .welcome-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .welcome-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, rgba(106, 90, 224, 0.2), rgba(169, 146, 255, 0.2));
    border-radius: 50%;
    margin: 0 auto 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    color: #6a5ae0;
    box-shadow: 0 5px 15px rgba(106, 90, 224, 0.3);
  }

  .welcome-header h2 {
    color: white;
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 10px;
  }

  .welcome-header p {
    color: rgba(255, 255, 255, 0.7);
    font-size: 1.1rem;
    max-width: 600px;
    margin: 0 auto;
  }

  .test-overview {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin-bottom: 30px;
  }

  .overview-item {
    flex: 1;
    background: rgba(40, 40, 70, 0.6);
    border-radius: 10px;
    padding: 15px;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: all 0.3s ease;
  }

  .overview-item:hover {
    background: rgba(50, 50, 90, 0.6);
    transform: translateY(-3px);
  }

  .overview-icon {
    width: 50px;
    height: 50px;
    background: rgba(106, 90, 224, 0.2);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: #6a5ae0;
  }

  .overview-text {
    flex: 1;
  }

  .overview-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 5px;
  }

  .overview-desc {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.9rem;
  }

  .categories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .category-card {
    background: linear-gradient(135deg, rgba(40, 40, 80, 0.8), rgba(35, 35, 70, 0.8));
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.1);
    height: 100%;
  }

  .category-card:hover {
    transform: translateY(-5px);
    background: linear-gradient(135deg, rgba(50, 50, 100, 0.8), rgba(45, 45, 90, 0.8));
    border-color: rgba(106, 90, 224, 0.3);
  }

  .category-icon {
    width: 60px;
    height: 60px;
    background: rgba(106, 90, 224, 0.15);
    border-radius: 12px;
    margin: 0 auto 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: #6a5ae0;
  }

  .category-title {
    color: white;
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 10px;
  }

  .category-desc {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.85rem;
    line-height: 1.4;
  }

  .start-test-container {
    text-align: center;
  }

  .btn-pulse {
    animation: pulse 1.5s infinite;
  }

  @keyframes pulse {
    0% {
      box-shadow: 0 0 0 0 rgba(106, 90, 224, 0.7);
    }
    70% {
      box-shadow: 0 0 0 10px rgba(106, 90, 224, 0);
    }
    100% {
      box-shadow: 0 0 0 0 rgba(106, 90, 224, 0);
    }
  }

  .test-disclaimer {
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.85rem;
    font-style: italic;
    margin-top: 15px;
  }

  /* Test Ekranı */
  .test-header {
    width: 100%;
    margin-bottom: 20px;
  }

  .test-info-bar {
    display: flex;
    justify-content: space-between;
    background: rgba(30, 30, 50, 0.7);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 10px;
  }

  .info-item {
    text-align: center;
  }

  .timer-item {
    min-width: 90px;
  }

  .info-label {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.8rem;
    margin-bottom: 5px;
  }

  .info-value {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .progress-container {
    height: 8px;
    background: rgba(30, 30, 50, 0.5);
    border-radius: 4px;
    overflow: hidden;
  }

  .progress-bar {
    height: 100%;
    background: linear-gradient(to right, #6a5ae0, #a992ff);
    width: 5%;
    border-radius: 4px;
    transition: width 0.5s ease;
  }

  .question-container {
    flex: 1;
    width: 100%;
    min-height: 300px;
    margin-bottom: 20px;
    padding: 20px;
    background: rgba(30, 30, 50, 0.7);
    border-radius: 12px;
    display: flex;
    flex-direction: column;
  }

  .question {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .question-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
  }

  .question-category {
    background: rgba(106, 90, 224, 0.2);
    padding: 5px 10px;
    border-radius: 5px;
    color: #a992ff;
    font-size: 0.9rem;
  }

  .question-difficulty {
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.9rem;
  }

  .question-difficulty.easy {
    background: rgba(46, 204, 113, 0.2);
    color: #2ecc71;
  }

  .question-difficulty.medium {
    background: rgba(241, 196, 15, 0.2);
    color: #f1c40f;
  }

  .question-difficulty.hard {
    background: rgba(231, 76, 60, 0.2);
    color: #e74c3c;
  }

  .question-text {
    font-size: 1.3rem;
    color: white;
    margin-bottom: 20px;
    line-height: 1.4;
  }

  .question-image {
    text-align: center;
    margin-bottom: 20px;
  }

  .question-image img {
    max-width: 100%;
    max-height: 200px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  }

  .options-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
  }

  .option {
    background: rgba(40, 40, 70, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
  }

  .option:hover {
    background: rgba(50, 50, 90, 0.6);
    transform: translateY(-2px);
  }

  .option.selected {
    background: rgba(106, 90, 224, 0.3);
    border-color: #6a5ae0;
  }

  .option-marker {
    width: 30px;
    height: 30px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    margin-right: 15px;
    color: white;
  }

  .option-content {
    flex: 1;
  }

  .option-content img {
    max-width: 100%;
    max-height: 100px;
    border-radius: 8px;
  }

  .option-content span {
    color: rgba(255, 255, 255, 0.9);
  }

  .test-navigation {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .btn-nav {
    min-width: 150px;
    padding: 12px 20px;
  }

  .navigation-dots {
    display: flex;
    gap: 5px;
    max-width: 300px;
    overflow-x: auto;
    padding: 5px;
  }

  .nav-dot {
    width: 12px;
    height: 12px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .nav-dot.active {
    background: rgba(106, 90, 224, 0.7);
  }

  .nav-dot.answered {
    background: rgba(255, 255, 255, 0.5);
  }

  /* Sonuç Ekranı */
  .results-card {
    background: rgba(30, 30, 50, 0.7);
    border-radius: 15px;
    padding: 30px;
    width: 100%;
    max-width: 800px;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(106, 90, 224, 0.2);
  }

  .results-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .results-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, rgba(106, 90, 224, 0.2), rgba(169, 146, 255, 0.2));
    border-radius: 50%;
    margin: 0 auto 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    color: #f1c40f;
    box-shadow: 0 5px 15px rgba(241, 196, 15, 0.3);
  }

  .score-display {
    display: flex;
    gap: 30px;
    margin-bottom: 30px;
    flex-wrap: wrap;
  }

  .score-ring {
    width: 150px;
    height: 150px;
    background: rgba(40, 40, 70, 0.6);
    border-radius: 50%;
    border: 8px solid #6a5ae0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 20px rgba(106, 90, 224, 0.5);
  }

  .score-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: white;
    line-height: 1;
    margin-bottom: 5px;
  }

  .score-label {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.7);
  }

  .score-details {
    flex: 1;
    min-width: 300px;
  }

  .score-details h3 {
    color: #6a5ae0;
    font-size: 1.3rem;
    margin-bottom: 15px;
  }

  .score-interpretation {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1rem;
    line-height: 1.5;
    margin-bottom: 20px;
    padding: 15px;
    background: rgba(40, 40, 70, 0.6);
    border-radius: 10px;
    border-left: 4px solid #6a5ae0;
  }

  .score-benchmark {
    margin-top: 25px;
  }

  .benchmark-scale {
    position: relative;
    height: 20px;
    margin-bottom: 5px;
  }

  .scale-marker {
    position: absolute;
    transform: translateX(-50%);
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
  }

  .scale-bar {
    height: 10px;
    background: rgba(40, 40, 70, 0.6);
    border-radius: 5px;
    position: relative;
    overflow: hidden;
  }

  .scale-fill {
    position: absolute;
    height: 100%;
    left: 0;
    top: 0;
    background: linear-gradient(to right, #e74c3c, #f1c40f, #2ecc71);
    border-radius: 5px;
    width: 66%; /* Default value, will be updated by JavaScript */
  }

  .scale-indicator {
    position: absolute;
    width: 4px;
    height: 20px;
    background: white;
    top: -5px;
    left: 66%; /* Default value, will be updated by JavaScript */
    transform: translateX(-50%);
  }

  .scale-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 5px;
  }

  .scale-labels span {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.8rem;
  }

  .performance-breakdown {
    margin-bottom: 30px;
  }

  .performance-breakdown h3 {
    color: #6a5ae0;
    font-size: 1.3rem;
    margin-bottom: 15px;
    text-align: center;
  }

  .chart-container {
    height: 180px;
    margin-bottom: 20px;
  }

  .stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
  }

  .stat-item {
    background: rgba(40, 40, 70, 0.6);
    border-radius: 8px;
    padding: 12px;
    text-align: center;
  }

  .stat-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
    margin-bottom: 5px;
  }

  .stat-value {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .results-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .results-actions button {
    min-width: 180px;
  }

  /* Sağ Panel Stilleri */
  .info-card, .tips-card, .stats-card {
    background: linear-gradient(135deg, rgba(40, 40, 80, 0.9), rgba(30, 30, 50, 0.9));
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(106, 90, 224, 0.2);
  }

  .info-card h3, .tips-card h3, .stats-card h3 {
    color: #6a5ae0;
    font-size: 1.2rem;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .info-content p {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.95rem;
    line-height: 1.5;
    margin-bottom: 15px;
  }

  .info-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .info-list-item {
    display: flex;
    gap: 10px;
    align-items: flex-start;
  }

  .list-icon {
    width: 20px;
    height: 20px;
    background: rgba(106, 90, 224, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    color: #6a5ae0;
    margin-top: 2px;
  }

  .list-text {
    flex: 1;
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
    line-height: 1.4;
  }

  .tips-content {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .tip-item {
    display: flex;
    gap: 15px;
    background: rgba(40, 40, 70, 0.6);
    border-radius: 8px;
    padding: 12px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
  }

  .tip-item:hover {
    background: rgba(50, 50, 90, 0.6);
    transform: translateY(-2px);
    border-color: rgba(106, 90, 224, 0.2);
  }

  .tip-number {
    width: 24px;
    height: 24px;
    background: rgba(106, 90, 224, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: 600;
    color: #6a5ae0;
    flex-shrink: 0;
  }

  .tip-text {
    flex: 1;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
    line-height: 1.4;
  }

  .tip-text strong {
    color: #a992ff;
  }

  .stats-content {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .stat-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background: rgba(40, 40, 70, 0.6);
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .stat-row:hover {
    background: rgba(50, 50, 90, 0.6);
  }

  .stat-name {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
  }

  .back-to-menu-btn {
    display: block;
    text-align: center;
    background: linear-gradient(135deg, rgba(40, 40, 80, 0.9), rgba(30, 30, 50, 0.9));
    border-radius: 12px;
    padding: 15px;
    color: white;
    font-weight: 600;
    text-decoration: none;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(106, 90, 224, 0.2);
    transition: all 0.3s ease;
  }

  .back-to-menu-btn:hover {
    background: linear-gradient(135deg, rgba(50, 50, 100, 0.9), rgba(40, 40, 70, 0.9));
    transform: translateY(-2px);
    box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
    color: white;
  }

  /* Responsive Düzenlemeler */
  @media (max-width: 768px) {
    .game-dashboard {
      flex-direction: column;
    }

    .game-info-panel {
      width: 100%;
    }

    .test-overview {
      flex-direction: column;
    }

    .test-navigation {
      flex-direction: column;
      gap: 15px;
    }

    .score-display {
      flex-direction: column;
      align-items: center;
    }

    .results-actions {
      flex-direction: column;
    }

    .results-actions button {
      width: 100%;
    }
  }
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log("iqTest oyunu modernize edildi.");

  // DOM Elements
  const startTestBtn = document.getElementById('start-test');
  const testIntro = document.getElementById('test-intro');
  const testContainer = document.getElementById('test-container');
  const testResults = document.getElementById('test-results');
  const questionContainer = document.getElementById('question-container');
  const prevQuestionBtn = document.getElementById('prev-question');
  const nextQuestionBtn = document.getElementById('next-question');
  const progressBar = document.getElementById('progress-bar');
  const questionCount = document.getElementById('question-counter');
  const timerDisplay = document.getElementById('timer');
  const iqScoreDisplay = document.getElementById('iq-score');
  const scoreInterpretation = document.getElementById('score-interpretation');
  const saveResultsBtn = document.getElementById('save-results');
  const restartTestBtn = document.getElementById('restart-test');

  // Test data
  let currentQuestionIndex = 0;
  let answers = [];
  let timer = null;
  let timeRemaining = 20 * 60; // 20 minutes in seconds
  let testActive = false;

  // Questions database
  const questions = [
    // Mantıksal Düşünme
    {
      category: 'Mantıksal Düşünme',
      question: 'Aşağıdaki şekil dizisindeki sonraki şekil hangisidir?',
      imageUrl: '/static/images/iq/logic-sequence-1.jpg',
      options: [
        { text: 'A', imageUrl: '/static/images/iq/logic-option-1a.jpg' },
        { text: 'B', imageUrl: '/static/images/iq/logic-option-1b.jpg' },
        { text: 'C', imageUrl: '/static/images/iq/logic-option-1c.jpg' },
        { text: 'D', imageUrl: '/static/images/iq/logic-option-1d.jpg' }
      ],
      correctAnswer: 2,
      difficulty: 'medium'
    },
    {
      category: 'Mantıksal Düşünme',
      question: 'Eğer tüm A\'lar B ise ve bazı B\'ler C ise, aşağıdakilerden hangisi kesinlikle doğrudur?',
      options: [
        { text: 'Tüm A\'lar C\'dir.' },
        { text: 'Bazı A\'lar C\'dir.' },
        { text: 'Bazı C\'ler A\'dır.' },
        { text: 'Hiçbiri kesin olarak doğru değildir.' }
      ],
      correctAnswer: 3,
      difficulty: 'hard'
    },
    // Görsel Algı
    {
      category: 'Görsel Algı',
      question: 'Aşağıdaki Raven matrisinde soru işareti yerine hangi şekil gelmelidir?',
      imageUrl: '/static/images/iq/visual-matrix-1.jpg',
      options: [
        { text: 'A', imageUrl: '/static/images/iq/visual-option-1a.jpg' },
        { text: 'B', imageUrl: '/static/images/iq/visual-option-1b.jpg' },
        { text: 'C', imageUrl: '/static/images/iq/visual-option-1c.jpg' },
        { text: 'D', imageUrl: '/static/images/iq/visual-option-1d.jpg' }
      ],
      correctAnswer: 1,
      difficulty: 'medium'
    },
    {
      category: 'Görsel Algı',
      question: 'Bu şekil katlandığında hangi küp oluşur?',
      imageUrl: '/static/images/iq/visual-folding-1.jpg',
      options: [
        { text: 'A', imageUrl: '/static/images/iq/visual-folding-1a.jpg' },
        { text: 'B', imageUrl: '/static/images/iq/visual-folding-1b.jpg' },
        { text: 'C', imageUrl: '/static/images/iq/visual-folding-1c.jpg' },
        { text: 'D', imageUrl: '/static/images/iq/visual-folding-1d.jpg' }
      ],
      correctAnswer: 0,
      difficulty: 'hard'
    },
    // Diğer kategorilerden sorular buraya eklenecek...
    // Sayısal Akıl Yürütme ve Sözel Anlama kategorileri...
  ];

  // Filler questions for demo (replace with real ones)
  for (let i = 0; i < 26; i++) {
    questions.push({
      category: i % 2 === 0 ? 'Sayısal Akıl Yürütme' : 'Sözel Anlama',
      question: `Soru ${i + 5}: Bu bir örnek sorudur.`,
      options: [
        { text: 'Seçenek A' },
        { text: 'Seçenek B' },
        { text: 'Seçenek C' },
        { text: 'Seçenek D' }
      ],
      correctAnswer: Math.floor(Math.random() * 4),
      difficulty: i % 3 === 0 ? 'easy' : (i % 3 === 1 ? 'medium' : 'hard')
    });
  }

  // Soruları karıştır
  function shuffleQuestions() {
    // Fisher-Yates algoritması ile soruları karıştır
    for (let i = questions.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [questions[i], questions[j]] = [questions[j], questions[i]];
    }

    // Her kategoriden 5 soru seçerek sınırla (toplamda 20 soru)
    const categories = ['Mantıksal Düşünme', 'Görsel Algı', 'Sayısal Akıl Yürütme', 'Sözel Anlama'];
    const selectedQuestions = [];

    // Her kategoriden beşer soru seç
    categories.forEach(category => {
      const categoryQuestions = questions.filter(q => q.category === category);
      const selected = categoryQuestions.slice(0, 5);
      selectedQuestions.push(...selected);
    });

    // Eğer yeterli soru yoksa, kalan soruları rastgele ekle
    if (selectedQuestions.length < 20) {
      const remainingQuestions = questions.filter(q => !selectedQuestions.includes(q));
      const needed = 20 - selectedQuestions.length;
      selectedQuestions.push(...remainingQuestions.slice(0, needed));
    }

    // Seçilen soruları tekrar karıştır
    for (let i = selectedQuestions.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [selectedQuestions[i], selectedQuestions[j]] = [selectedQuestions[j], selectedQuestions[i]];
    }

    // Ana soru listesini güncelle (eğer 20'den az soru varsa tüm soruları kullan)
    return selectedQuestions.length >= 20 ? selectedQuestions : questions;
  }

  // Her sorunun seçeneklerini karıştır
  function shuffleOptions(questions) {
    questions.forEach(question => {
      // Doğru cevabı kaydet
      const correctOption = question.options[question.correctAnswer];

      // Seçenekleri karıştır
      for (let i = question.options.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [question.options[i], question.options[j]] = [question.options[j], question.options[i]];
      }

      // Doğru cevabın yeni indeksini bul
      question.correctAnswer = question.options.findIndex(option => 
        option === correctOption
      );
    });

    return questions;
  }

  // Görsel ön yüklemesi yapmak için fonksiyon
  function preloadImages() {
    questions.forEach(question => {
      if (question.imageUrl) {
        const img = new Image();
        img.src = question.imageUrl;
      }

      question.options.forEach(option => {
        if (option.imageUrl) {
          const img = new Image();
          img.src = option.imageUrl;
        }
      });
    });
  }

  // Initialize answers array
  let testQuestions = [];
  answers = new Array(20).fill(null);

  // Event Listeners
  startTestBtn.addEventListener('click', startTest);
  prevQuestionBtn.addEventListener('click', showPreviousQuestion);
  nextQuestionBtn.addEventListener('click', showNextQuestion);
  saveResultsBtn.addEventListener('click', saveResults);
  restartTestBtn.addEventListener('click', () => {
    testResults.style.display = 'none';
    testIntro.style.display = 'block';
  });

  // Sayfa yüklendiğinde görselleri ön yükle
  preloadImages();

  // Functions
  function startTest() {
    testIntro.style.display = 'none';
    testContainer.style.display = 'block';
    currentQuestionIndex = 0;
    answers = new Array(20).fill(null);
    testActive = true;

    // Soruları karıştır
    testQuestions = shuffleQuestions();
    testQuestions = shuffleOptions(testQuestions);

    // Start timer
    startTimer();

    // Show first question
    showQuestion(currentQuestionIndex);

    // Play start sound
    try {
      const startSound = new Audio('/static/sounds/start.mp3');
      startSound.play();
    } catch (error) {
      console.log("Start sound playback prevented", error);
    }
  }

  function startTimer() {
    timeRemaining = 20 * 60; // Reset to 20 minutes
    updateTimerDisplay();

    if (timer) clearInterval(timer);

    timer = setInterval(() => {
      timeRemaining--;
      updateTimerDisplay();

      if (timeRemaining <= 0) {
        clearInterval(timer);
        endTest();
      }
    }, 1000);
  }

  function updateTimerDisplay() {
    const minutes = Math.floor(timeRemaining / 60);
    const seconds = timeRemaining % 60;
    timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

    // Add visual cue for low time
    if (timeRemaining < 300) { // Less than 5 minutes
      timerDisplay.style.color = '#ff4d4d';
    } else {
      timerDisplay.style.color = '';
    }
  }

  function showQuestion(index) {
    const question = testQuestions[index];

    // Update progress indicators
    const progress = (index / testQuestions.length) * 100;
    progressBar.style.width = `${progress}%`;
    questionCount.textContent = `${index + 1}/${testQuestions.length}`;

    // Enable/disable navigation buttons
    prevQuestionBtn.disabled = index === 0;
    nextQuestionBtn.textContent = index === testQuestions.length - 1 ? 'Testi Bitir' : 'Sonraki Soru';
    nextQuestionBtn.innerHTML = index === testQuestions.length - 1 ? 
      'Testi Bitir<i class="fas fa-check ms-2"></i>' : 
      'Sonraki Soru<i class="fas fa-arrow-right ms-2"></i>';

    // Generate question HTML
    let questionHTML = `
      <div class="question">
        <div class="question-header">
          <span class="question-category">${question.category}</span>
          <span class="question-difficulty ${question.difficulty}">
            ${question.difficulty === 'easy' ? 'Kolay' : (question.difficulty === 'medium' ? 'Orta' : 'Zor')}
          </span>
        </div>
        <h3 class="question-text">${question.question}</h3>
    `;

    if (question.imageUrl) {
      questionHTML += `
        <div class="question-image">
          <img src="${question.imageUrl}" alt="Soru görseli">
        </div>
      `;
    }

    questionHTML += '<div class="options-container">';

    question.options.forEach((option, optIndex) => {
      const isSelected = answers[index] === optIndex;

      questionHTML += `
        <div class="option ${isSelected ? 'selected' : ''}" data-index="${optIndex}">
          <div class="option-marker">${option.text}</div>
          <div class="option-content">
      `;

      if (option.imageUrl) {
        questionHTML += `<img src="${option.imageUrl}" alt="Seçenek görseli">`;
      } else {
        questionHTML += `<span>${option.text}</span>`;
      }

      questionHTML += `
          </div>
        </div>
      `;
    });

    questionHTML += '</div></div>';

    // Set question HTML and add event listeners
    questionContainer.innerHTML = questionHTML;

    // Add event listeners to options
    const optionElements = questionContainer.querySelectorAll('.option');
    optionElements.forEach(option => {
      option.addEventListener('click', function() {
        const optionIndex = parseInt(this.dataset.index);
        answers[currentQuestionIndex] = optionIndex;

        // Update selected state
        optionElements.forEach(opt => opt.classList.remove('selected'));
        this.classList.add('selected');

        // Play selection sound
        try {
          const clickSound = new Audio('/static/sounds/click.mp3');
          clickSound.play();
        } catch (error) {
          console.log("Sound play error:", error);
        }
      });
    });
  }

  function showPreviousQuestion() {
    if (currentQuestionIndex > 0) {
      currentQuestionIndex--;
      showQuestion(currentQuestionIndex);
    }
  }

  function showNextQuestion() {
    if (currentQuestionIndex < testQuestions.length - 1) {
      currentQuestionIndex++;
      showQuestion(currentQuestionIndex);
    } else {
      endTest();
    }
  }

  function endTest() {
    testActive = false;
    clearInterval(timer);
    calculateResults();

    testContainer.style.display = 'none';
    testResults.style.display = 'block';

    // Sonuçlarda kategori performansını göster
    displayCategoryPerformance();

    // Play completion sound
    try {
      const completeSound = new Audio('/static/sounds/levelUp.mp3');
      completeSound.play();
    } catch (error) {
      console.log("Sound play error:", error);
    }
  }

  // Kategori performansını görselleştir
  function displayCategoryPerformance() {
    const categoryScores = {
      'Mantıksal Düşünme': { correct: 0, total: 0 },
      'Görsel Algı': { correct: 0, total: 0 },
      'Sayısal Akıl Yürütme': { correct: 0, total: 0 },
      'Sözel Anlama': { correct: 0, total: 0 }
    };

    // Kategori bazında doğru/yanlış sayılarını hesapla
    testQuestions.forEach((question, index) => {
      const category = question.category;
      if (!categoryScores[category]) {
        categoryScores[category] = { correct: 0, total: 0 };
      }

      categoryScores[category].total++;
      if (answers[index] === question.correctAnswer) {
        categoryScores[category].correct++;
      }
    });

    // Kategori performansını Chart.js ile göster
    if (typeof Chart !== 'undefined') {
      const ctx = document.getElementById('category-chart').getContext('2d');

      // Kategori isimlerini ve skorları hazırla
      const labels = Object.keys(categoryScores);
      const data = labels.map(category => {
        const { correct, total } = categoryScores[category];
        return total > 0 ? Math.round((correct / total) * 100) : 0;
      });

      // Grafik oluştur
      new Chart(ctx, {
        type: 'radar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Kategori Performansı (%)',
            data: data,
            backgroundColor: 'rgba(106, 90, 224, 0.2)',
            borderColor: 'rgba(106, 90, 224, 1)',
            pointBackgroundColor: 'rgba(106, 90, 224, 1)',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: 'rgba(106, 90, 224, 1)'
          }]
        },
        options: {
          scale: {
            ticks: {
              beginAtZero: true,
              max: 100
            }
          }
        }
      });

      // Ayrıca en güçlü kategoriyi belirle
      let maxScore = 0;
      let strongestCategory = '';

      for (const category in categoryScores) {
        const { correct, total } = categoryScores[category];
        const score = total > 0 ? (correct / total) : 0;

        if (score > maxScore) {
          maxScore = score;
          strongestCategory = category;
        }
      }

      // En güçlü kategoriyi güncelle
      document.getElementById('strongest-category').textContent = strongestCategory;
    }
  }

  function calculateResults() {
    let correctAnswers = 0;
    const categoryScores = {
      'Mantıksal Düşünme': 0,
      'Görsel Algı': 0,
      'Sayısal Akıl Yürütme': 0,
      'Sözel Anlama': 0
    };

    const categoryQuestions = {
      'Mantıksal Düşünme': 0,
      'Görsel Algı': 0,
      'Sayısal Akıl Yürütme': 0,
      'Sözel Anlama': 0
    };

    // Calculate scores
    testQuestions.forEach((question, index) => {
      categoryQuestions[question.category]++;

      if (answers[index] === question.correctAnswer) {
        correctAnswers++;
        categoryScores[question.category]++;
      }
    });

    // Calculate category percentages
    for (const category in categoryScores) {
      if (categoryQuestions[category] > 0) {
        categoryScores[category] = (categoryScores[category] / categoryQuestions[category]) * 100;
      }
    }

    // Calculate IQ score (simplified formula for demo)
    const baseScore = 100;
    const scoreRange = 50;
    const percentCorrect = correctAnswers / testQuestions.length;
    const iqScore = Math.round(baseScore + (percentCorrect - 0.5) * scoreRange * 2);

    // Update UI
    iqScoreDisplay.textContent = iqScore;

    // Set interpretation based on IQ score
    if (iqScore < 80) {
      scoreInterpretation.textContent = 'Bu IQ seviyesi ortalamanın altındadır. Bazı alanlarda daha fazla çalışma gerekebilir.';
    } else if (iqScore < 100) {
      scoreInterpretation.textContent = 'Bu IQ seviyesi ortalamaya yakındır. Bazı alanlarda iyi olmakla birlikte, geliştirilmesi gereken alanlar da vardır.';
    } else if (iqScore < 120) {
      scoreInterpretation.textContent = 'Bu IQ seviyesi ortalamanın üzerindedir. Zihinsel yetenekleriniz çoğu alanı kapsayacak şekilde iyi gelişmiştir.';
    } else {
      scoreInterpretation.textContent = 'Bu IQ seviyesi oldukça yüksektir. Zihinsel yetenekleriniz üst düzeydedir ve çoğu zihinsel görevde çok iyi performans gösterirsiniz.';
    }

    // Create radar chart
    createCategoryChart(categoryScores);
  }

  function createCategoryChart(categoryScores) {
    const ctx = document.getElementById('category-chart').getContext('2d');

    // Check if Chart is loaded
    if (typeof Chart !== 'undefined') {
      // Create radar chart
      new Chart(ctx, {
        type: 'radar',
        data: {
          labels: Object.keys(categoryScores),
          datasets: [{
            label: 'Kategori Performansı',
            data: Object.values(categoryScores),
            backgroundColor: 'rgba(106, 90, 224, 0.2)',
            borderColor: 'rgba(106, 90, 224, 1)',
            pointBackgroundColor: 'rgba(106, 90, 224, 1)',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: 'rgba(106, 90, 224, 1)'
          }]
        },
        options: {
          scale: {
            ticks: {
              beginAtZero: true,
              max: 100
            }
          }
        }
      });
    } else {
      // Fallback for when Chart.js is not available
      document.getElementById('category-chart').innerHTML = `
        <div class="chart-fallback">
          <h4>Kategori Sonuçları</h4>
          <ul>
            ${Object.entries(categoryScores).map(([category, score]) => 
              `<li>${category}: ${Math.round(score)}%</li>`
            ).join('')}
          </ul>
        </div>
      `;
    }
  }

  function saveResults() {
    // Calculate final score from correct answers
    let correctAnswers = 0;

    testQuestions.forEach((question, index) => {
      if (answers[index] === question.correctAnswer) {
        correctAnswers++;
      }
    });

    const score = Math.round((correctAnswers / testQuestions.length) * 100);

    // Save score to backend
    fetch('/api/save-score', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        game_type: 'iq_test',        score: score,
        difficulty: 'medium', // Or calculate based on question mix
        playtime: 20 * 60 - timeRemaining, // Time spent in seconds
        game_stats: {
          correct_answers: correctAnswers,
          total_questions: testQuestions.length,
          iq_score: parseInt(iqScoreDisplay.textContent),
          category_scores: {
            logical: document.querySelector('#category-chart').dataset.logical || 0,
            visual: document.querySelector('#category-chart').dataset.visual || 0,
            numerical: document.querySelector('#category-chart').dataset.numerical || 0,
            verbal: document.querySelector('#category-chart').dataset.verbal || 0
          }
        }
      })
    })
    .then(response => response.json())
    .then(data => {
      console.log("Score saved:", data);
      if (data.success) {
        saveResultsBtn.disabled = true;
        saveResultsBtn.textContent = 'Sonuçlar Kaydedildi';
        saveResultsBtn.innerHTML = '<i class="fas fa-check-circle me-2"></i>Sonuçlar Kaydedildi';

        // Play success sound
        try {
          const successSound = new Audio('/static/sounds/correct.mp3');
          successSound.play();
        } catch (error) {
          console.log("Sound play error:", error);
        }
      }
    })
    .catch(error => {
      console.error("Error saving score:", error);
    });
  }

  // Handle beforeunload event to warn about leaving during active test
  window.addEventListener('beforeunload', function(e) {
    if (testActive) {
      // This message might not be displayed in modern browsers due to security reasons,
      // but the confirmation dialog will still appear
      const confirmationMessage = 'Test hala devam ediyor. Sayfadan ayrılırsanız ilerleyişiniz kaydedilmeyecek.';
      e.returnValue = confirmationMessage;
      return confirmationMessage;
    }
  });
});
</script>

<style>
  .iq-test-container {
    max-width: 900px;
    margin: 0 auto;
    background: rgba(25, 25, 45, 0.7);
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  }

  /* Intro Section */
  .intro-content {
    text-align: center;
  }

  .intro-content h2 {
    color: var(--accent-color);
    margin-bottom: 1rem;
  }

  .test-info {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin: 30px 0;
  }

  .info-item {
    background: rgba(40, 40, 80, 0.5);
    border-radius: 10px;
    padding: 15px;
    display: flex;
    align-items: center;
    width: calc(33.333% - 20px);
    min-width: 220px;
  }

  .info-item i {
    font-size: 2rem;
    color: var(--accent-color);
    margin-right: 15px;
  }

  .info-text h4 {
    color: white;
    margin-bottom: 5px;
    font-size: 1.1rem;
  }

  .info-text p {
    color: rgba(255, 255, 255, 0.7);
    margin: 0;
    font-size: 0.9rem;
  }

  .test-categories h3 {
    color: var(--accent-color);
    margin: 30px 0 20px;
  }

  .category-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
  }

  .category-item {
    background: rgba(40, 40, 80, 0.5);
    border-radius: 10px;
    padding: 20px;
    width: calc(25% - 20px);
    min-width: 200px;
    text-align: center;
  }

  .category-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(106, 90, 224, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 15px;
  }

  .category-icon i {
    font-size: 1.5rem;
    color: var(--accent-color);
  }

  .category-item h4 {
    color: white;
    margin-bottom: 5px;
    font-size: 1.1rem;
  }

  .category-item p {
    color: rgba(255, 255, 255, 0.7);
    margin: 0;
    font-size: 0.9rem;
  }

  /* Test Container Styles */
  .test-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .test-progress {
    flex-grow: 1;
    margin-right: 20px;
  }

  .progress {
    height: 10px;
    background: rgba(40, 40, 80, 0.5);
    border-radius: 5px;
    overflow: hidden;
  }

  .progress-bar {
    background: var(--accent-color);
    transition: width 0.3s ease;
  }

  .test-timer {
    font-size: 1.2rem;
    color: white;
    background: rgba(40, 40, 80, 0.5);
    padding: 5px 15px;
    border-radius: 5px;
  }

  /* Question Styles */
  .question {
    background: rgba(40, 40, 80, 0.5);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
  }

  .question-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
  }

  .question-category {
    color: var(--accent-color);
    font-weight: 600;
  }

  .question-difficulty {
    padding: 2px 10px;
    border-radius: 15px;
    font-size: 0.8rem;
  }

  .question-difficulty.easy {
    background: rgba(46, 204, 113, 0.2);
    color: #2ecc71;
  }

  .question-difficulty.medium {
    background: rgba(241, 196, 15, 0.2);
    color: #f1c40f;
  }

  .question-difficulty.hard {
    background: rgba(231, 76, 60, 0.2);
    color: #e74c3c;
  }

  .question-text {
    color: white;
    margin-bottom: 20px;
    font-size: 1.2rem;
  }

  .question-image {
    text-align: center;
    margin-bottom: 20px;
  }

  .question-image img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 5px;
  }

  .options-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
  }

  .option {
    background: rgba(30, 30, 60, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .option:hover {
    background: rgba(40, 40, 80, 0.7);
    transform: translateY(-2px);
  }

  .option.selected {
    background: rgba(106, 90, 224, 0.3);
    border-color: var(--accent-color);
  }

  .option-marker {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(106, 90, 224, 0.5);
    border-radius: 50%;
    width: 25px;
    height: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    z-index: 1;
  }

  .option-content {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100px;
  }

  .option-content img {
    max-width: 100%;
    max-height: 150px;
    border-radius: 5px;
  }

  /* Navigation */
  .test-navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 30px;
  }

  #question-count {
    color: rgba(255, 255, 255, 0.7);
  }

  /* Results Styles */
  .results-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .results-header h2 {
    color: var(--accent-color);
    margin-bottom: 10px;
  }

  .iq-score-container {
    display: flex;
    flex-wrap: wrap;
    gap: 30px;
    margin-bottom: 40px;
  }

  .iq-score {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .score-circle {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(106, 90, 224, 0.1), rgba(106, 90, 224, 0.4));
    border: 3px solid var(--accent-color);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 15px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  }

  .score-value {
    font-size: 3rem;
    font-weight: 700;
    color: white;
  }

  .score-label {
    color: var(--accent-color);
    font-size: 1.2rem;
    font-weight: 600;
  }

  .score-interpretation {
    flex: 1;
    min-width: 300px;
    background: rgba(40, 40, 80, 0.5);
    border-radius: 10px;
    padding: 20px;
  }

  .score-interpretation h3 {
    color: var(--accent-color);
    margin-bottom: 15px;
  }

  .category-scores {
    background: rgba(40, 40, 80, 0.5);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 30px;
  }

  .category-scores h3 {
    color: var(--accent-color);
    margin-bottom: 20px;
    text-align: center;
  }

  .category-chart-container {
    height: 300px;
  }

  .chart-fallback {
    background: rgba(30, 30, 60, 0.7);
    border-radius: 8px;
    padding: 20px;
  }

  .chart-fallback h4 {
    color: var(--accent-color);
    margin-bottom: 15px;
    text-align: center;
  }

  .chart-fallback ul {
    list-style-type: none;
    padding: 0;
  }

  .chart-fallback li {
    color: white;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    padding: 5px 10px;
    background: rgba(40, 40, 80, 0.5);
    border-radius: 5px;
  }

  .result-actions {
    display: flex;
    justify-content: center;
    gap: 20px;
  }

  /* Responsive Adjustments */
  @media (max-width: 768px) {
    .iq-test-container {
      padding: 20px;
    }

    .options-container {
      grid-template-columns: 1fr;
    }

    .info-item, .category-item {
      width: 100%;
    }

    .test-navigation {
      flex-direction: column;
      gap: 15px;
    }

    .test-navigation button {
      width: 100%;
    }

    #question-count {
      order: -1;
      margin-bottom: 10px;
    }

    .iq-score-container {
      flex-direction: column;
    }

    .result-actions {
      flex-direction: column;
      gap: 10px;
    }

    .result-actions button {
      width: 100%;
    }
  }
</style>