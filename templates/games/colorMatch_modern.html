{% extends 'layout.html' %}

{% block title %}Renk Eşleştirme - ZekaPark{% endblock %}

{% block content %}
<div class="page-container">
  <div class="game-container">
    <div class="game-header">
      <h1>Renk Eşleştirme <span class="badge">Odaklanma Oyunu</span></h1>
      <p class="game-description">Kelimelerin anlamı ve rengi arasındaki uyumu kontrol ederek hızlı tepki verin.</p>
    </div>

    <div class="color-match-container">
      <div class="game-status">
        <div class="status-item">
          <div class="status-label">Skor</div>
          <div class="status-value" id="score">0</div>
        </div>
        <div class="status-item">
          <div class="status-label">En İyi</div>
          <div class="status-value" id="best-score">0</div>
        </div>
        <div class="status-item streak-container">
          <div class="status-label">Seri</div>
          <div class="status-value" id="streak">0</div>
          <div class="streak-fire" id="streak-fire"><i class="fas fa-fire"></i></div>
        </div>
        <div class="status-item timer-container">
          <div class="status-label">Süre</div>
          <div class="status-value" id="timer">60</div>
          <div class="timer-bar-small-container">
            <div id="timer-bar-small" class="timer-bar-small"></div>
          </div>
        </div>
      </div>
      
      <div class="game-layout">
        <div class="game-area">
          <div id="start-screen" class="game-screen">
            <h2>Renk Eşleştirme<br>Oyununa Hoş Geldiniz!</h2>
            <p>Bu oyun zihninizi test etmek ve odaklanma yeteneğinizi geliştirmek için tasarlanmıştır.</p>
            
            <div class="game-options">
              <div class="option-section">
                <h3>Nasıl Oynanır?</h3>
                <div class="instructions">
                  <ul>
                    <li><i class="fas fa-check-circle instruction-icon"></i>Ekranda renkli kelimeler göreceksiniz.</li>
                    <li><i class="fas fa-check-circle instruction-icon"></i>Kelimenin <strong>anlamı</strong> ile <strong>rengi</strong> eşleşiyor mu kontrol edin.</li>
                    <li><i class="fas fa-check-circle instruction-icon"></i>Eşleşiyorsa <span class="key">DOĞRU</span> butonuna basın.</li>
                    <li><i class="fas fa-check-circle instruction-icon"></i>Eşleşmiyorsa <span class="key">YANLIŞ</span> butonuna basın.</li>
                    <li><i class="fas fa-check-circle instruction-icon"></i>Doğru cevaplar için puan kazanırsınız, yanlış cevaplar için puan kaybedersiniz.</li>
                    <li><i class="fas fa-check-circle instruction-icon"></i>Arka arkaya doğru cevaplar vererek <strong>seri</strong> oluşturun ve bonus puan kazanın!</li>
                  </ul>
                </div>
              </div>
              
              <div class="options-row">
                <div class="option-section">
                  <h3>Zorluk Seviyesi</h3>
                  <div class="button-group">
                    <button class="option-button active" data-speed="slow">
                      <span class="option-icon"><i class="fas fa-walking"></i></span>
                      <span>Kolay</span>
                    </button>
                    <button class="option-button" data-speed="medium">
                      <span class="option-icon"><i class="fas fa-running"></i></span>
                      <span>Orta</span>
                    </button>
                    <button class="option-button" data-speed="fast">
                      <span class="option-icon"><i class="fas fa-biking"></i></span>
                      <span>Zor</span>
                    </button>
                  </div>
                </div>
                
                <div class="option-section">
                  <h3>Oyun Modu</h3>
                  <div class="button-group">
                    <button class="mode-button active" data-mode="standard">
                      <span class="mode-icon"><i class="fas fa-chess-board"></i></span>
                      <span>Standart</span>
                    </button>
                    <button class="mode-button" data-mode="timed">
                      <span class="mode-icon"><i class="fas fa-hourglass-half"></i></span>
                      <span>Zamanlı</span>
                    </button>
                    <button class="mode-button" data-mode="endless">
                      <span class="mode-icon"><i class="fas fa-infinity"></i></span>
                      <span>Sonsuz</span>
                    </button>
                  </div>
                </div>
              </div>
              
              <div class="option-section">
                <h3>Görsel Efektler</h3>
                <div class="effects-options">
                  <label class="switch-container">
                    <span>Parçacık Efektleri</span>
                    <label class="switch">
                      <input type="checkbox" id="enable-particles" checked>
                      <span class="slider round"></span>
                    </label>
                  </label>
                  <label class="switch-container">
                    <span>Animasyonlar</span>
                    <label class="switch">
                      <input type="checkbox" id="enable-animations" checked>
                      <span class="slider round"></span>
                    </label>
                  </label>
                </div>
              </div>
            </div>
            
            <button id="start-btn" class="btn btn-primary btn-lg">
              <i class="fas fa-play me-2"></i>Oyuna Başla
            </button>
          </div>
          
          <div id="game-screen" class="game-screen" style="display: none;">
            <div class="game-level-indicator" id="level-indicator">Seviye 1</div>
            
            <div class="color-word-container">
              <div id="countdown" class="countdown">3</div>
              <div id="color-word" class="color-word">MAVİ</div>
            </div>
            
            <div class="game-controls">
              <button id="true-btn" class="answer-btn true-btn">
                <i class="fas fa-check me-2"></i>DOĞRU
              </button>
              <button id="false-btn" class="answer-btn false-btn">
                <i class="fas fa-times me-2"></i>YANLIŞ
              </button>
            </div>
            
            <div id="feedback" class="feedback"></div>
            
            <div class="timer-bar-container">
              <div id="timer-bar" class="timer-bar"></div>
            </div>
          </div>
          
          <div id="result-screen" class="game-screen" style="display: none;">
            <h2>Oyun Bitti!</h2>
            
            <div class="result-stats">
              <div class="result-stat">
                <div class="result-value" id="final-score">0</div>
                <div class="result-label">Toplam Puan</div>
              </div>
              <div class="result-stat">
                <div class="result-value" id="correct-answers">0</div>
                <div class="result-label">Doğru</div>
              </div>
              <div class="result-stat">
                <div class="result-value" id="wrong-answers">0</div>
                <div class="result-label">Yanlış</div>
              </div>
            </div>
            
            <div class="performance-meter">
              <div class="meter-label">Performans</div>
              <div class="meter-bar-container">
                <div class="meter-bar" id="performance-bar"></div>
              </div>
              <div class="meter-labels">
                <span>Zayıf</span>
                <span>Orta</span>
                <span>İyi</span>
                <span>Harika</span>
              </div>
            </div>
            
            <div class="result-details">
              <div class="detail-item">
                <span class="detail-label">Doğruluk Oranı:</span>
                <span class="detail-value" id="accuracy">0%</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">En Uzun Seri:</span>
                <span class="detail-value" id="max-streak">0</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Ortalama Tepki Süresi:</span>
                <span class="detail-value"><span id="avg-reaction-time">0</span> ms</span>
              </div>
            </div>
            
            <div class="result-actions">
              <button id="play-again-btn" class="btn btn-primary btn-lg">
                <i class="fas fa-redo-alt me-2"></i>Tekrar Oyna
              </button>
              <a href="{{ url_for('all_games') }}" class="btn btn-outline-light btn-lg">
                <i class="fas fa-th-large me-2"></i>Tüm Oyunlar
              </a>
            </div>
          </div>
        </div>
        
        <div class="game-sidebar">
          <div class="game-stats">
            <h3>İstatistikler</h3>
            <div class="stats-list">
              <div class="stat-row">
                <span class="stat-name">Tepki Süresi:</span>
                <span class="stat-value" id="reaction-time">0 ms</span>
              </div>
              <div class="stat-row">
                <span class="stat-name">Doğruluk:</span>
                <span class="stat-value" id="accuracy-rate">100%</span>
              </div>
              <div class="stat-row">
                <span class="stat-name">Toplam Yanıt:</span>
                <span class="stat-value" id="total-answers">0</span>
              </div>
            </div>
          </div>
          
          <div class="game-achievements">
            <h3>Başarılar</h3>
            <div class="achievements-list">
              <div class="achievement-item" id="achievement-streak">
                <div class="achievement-icon"><i class="fas fa-fire"></i></div>
                <div class="achievement-info">
                  <div class="achievement-name">Ateş Serisi</div>
                  <div class="achievement-progress">
                    <div class="progress-bar">
                      <div class="progress-fill" id="streak-progress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">0/10</div>
                  </div>
                </div>
              </div>
              <div class="achievement-item" id="achievement-speed">
                <div class="achievement-icon"><i class="fas fa-bolt"></i></div>
                <div class="achievement-info">
                  <div class="achievement-name">Şimşek Hızı</div>
                  <div class="achievement-progress">
                    <div class="progress-bar">
                      <div class="progress-fill" id="speed-progress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">0 ms / 500 ms</div>
                  </div>
                </div>
              </div>
              <div class="achievement-item" id="achievement-accuracy">
                <div class="achievement-icon"><i class="fas fa-bullseye"></i></div>
                <div class="achievement-info">
                  <div class="achievement-name">Keskin Gözler</div>
                  <div class="achievement-progress">
                    <div class="progress-bar">
                      <div class="progress-fill" id="accuracy-progress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">0%</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <a href="{{ url_for('all_games') }}" class="btn btn-outline-secondary btn-block">
            <i class="fas fa-th-large me-2"></i>Tüm Oyunlar
          </a>
        </div>
      </div>
    </div>
    
    <div id="notification" class="game-notification">
      <div class="notification-content">
        <p id="notification-message"></p>
        <button id="close-notification" class="btn-close"><i class="fas fa-times"></i></button>
      </div>
    </div>
  </div>
</div>

<style>
  .color-match-container {
    max-width: 100%;
    margin: 0 auto;
    padding: 0 10px;
  }
  
  .game-layout {
    display: flex;
    flex-wrap: wrap;
    gap: 25px;
    justify-content: center;
    align-items: flex-start;
    margin-bottom: 20px;
  }

  .game-status {
    display: flex;
    justify-content: space-between;
    background: rgba(25, 25, 45, 0.8);
    border-radius: 16px;
    margin-bottom: 25px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.05);
  }

  .status-item {
    flex: 1;
    text-align: center;
    padding: 15px;
    border-right: 1px solid rgba(255, 255, 255, 0.05);
    position: relative;
    transition: all 0.3s ease;
  }
  
  .status-item:hover {
    background: rgba(30, 30, 60, 0.5);
  }

  .status-item:last-child {
    border-right: none;
  }

  .status-label {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 5px;
  }

  .status-value {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--accent-color);
    text-shadow: 0 0 10px rgba(106, 90, 224, 0.3);
    transition: all 0.3s ease;
  }
  
  .status-value.flash {
    animation: flash-animation 0.5s;
  }
  
  @keyframes flash-animation {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
  
  .streak-container {
    position: relative;
  }
  
  .streak-fire {
    position: absolute;
    top: 5px;
    right: 10px;
    color: orange;
    font-size: 1.2rem;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .streak-fire.active {
    opacity: 1;
    animation: fire-pulse 1.5s infinite;
  }
  
  @keyframes fire-pulse {
    0% {
      transform: scale(1);
      text-shadow: 0 0 5px orange;
    }
    50% {
      transform: scale(1.2);
      text-shadow: 0 0 10px orange, 0 0 20px rgba(255, 165, 0, 0.5);
    }
    100% {
      transform: scale(1);
      text-shadow: 0 0 5px orange;
    }
  }
  
  .timer-container {
    position: relative;
  }
  
  .timer-bar-small-container {
    position: absolute;
    bottom: 5px;
    left: 15px;
    right: 15px;
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
  }
  
  .timer-bar-small {
    height: 100%;
    background: linear-gradient(to right, #6a5ae0, #a890ff);
    width: 100%;
    transition: width linear 0.1s;
  }
  
  .timer-warning .timer-bar-small {
    background: linear-gradient(to right, #ff4757, #ff6b81);
  }

  .game-area {
    flex: 1;
    min-width: 300px;
    max-width: 600px;
  }
  
  .game-screen {
    background: rgba(25, 25, 45, 0.8);
    border-radius: 16px;
    padding: 30px;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
    animation: fadeIn 0.5s ease;
  }
  
  .game-screen:hover {
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
    border-color: rgba(106, 90, 224, 0.15);
  }

  .game-screen h2 {
    color: var(--accent-color);
    font-size: 2.2rem;
    margin-bottom: 20px;
    font-weight: 700;
    background: linear-gradient(90deg, #6a5ae0, #a890ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1.3;
  }

  .game-screen p {
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 25px;
    font-size: 1.1rem;
    line-height: 1.6;
  }
  
  .game-options {
    margin-bottom: 30px;
  }
  
  .options-row {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
  }
  
  @media (max-width: 768px) {
    .options-row {
      flex-direction: column;
    }
  }
  
  .option-section {
    background: rgba(35, 35, 65, 0.6);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    text-align: left;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
  }
  
  .option-section:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    border-color: rgba(106, 90, 224, 0.15);
  }
  
  .option-section h3 {
    color: white;
    font-size: 1.2rem;
    margin-bottom: 15px;
    font-weight: 600;
    position: relative;
    display: inline-block;
    padding-bottom: 8px;
  }
  
  .option-section h3:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--accent-color);
    border-radius: 2px;
  }
  
  .instructions ul {
    list-style-type: none;
    padding: 0;
    margin: 0;
  }
  
  .instructions li {
    display: flex;
    align-items: flex-start;
    margin-bottom: 12px;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.95rem;
    line-height: 1.4;
  }
  
  .instructions li:last-child {
    margin-bottom: 0;
  }
  
  .instruction-icon {
    color: var(--accent-color);
    margin-right: 10px;
    margin-top: 3px;
    font-size: 0.9rem;
    flex-shrink: 0;
  }
  
  .key {
    display: inline-block;
    background: rgba(106, 90, 224, 0.3);
    border: 1px solid rgba(106, 90, 224, 0.5);
    padding: 2px 8px;
    border-radius: 4px;
    font-weight: 600;
    color: white;
  }
  
  .button-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  
  .option-button, .mode-button {
    flex: 1;
    padding: 12px 15px;
    background: rgba(40, 40, 80, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
    min-width: 100px;
  }
  
  .option-button:hover, .mode-button:hover {
    background: rgba(60, 60, 100, 0.6);
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  }
  
  .option-button.active, .mode-button.active {
    background: rgba(106, 90, 224, 0.5);
    border-color: rgba(106, 90, 224, 0.8);
    box-shadow: 0 5px 15px rgba(106, 90, 224, 0.3);
  }
  
  .option-icon, .mode-icon {
    width: 30px;
    height: 30px;
    background: rgba(106, 90, 224, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    color: var(--accent-color);
    transition: all 0.3s ease;
  }
  
  .option-button:hover .option-icon, 
  .mode-button:hover .mode-icon {
    background: rgba(106, 90, 224, 0.4);
    transform: scale(1.1);
  }
  
  .option-button.active .option-icon, 
  .mode-button.active .mode-icon {
    background: rgba(106, 90, 224, 0.6);
  }
  
  .effects-options {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
  }
  
  .switch-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 48%;
    color: white;
    font-size: 0.95rem;
  }
  
  .switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
  }
  
  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(40, 40, 80, 0.6);
    transition: .4s;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 4px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
  }
  
  input:checked + .slider {
    background-color: rgba(106, 90, 224, 0.6);
  }
  
  input:checked + .slider:before {
    transform: translateX(26px);
  }
  
  .slider.round {
    border-radius: 34px;
  }
  
  .slider.round:before {
    border-radius: 50%;
  }
  
  #start-btn {
    font-size: 1.1rem;
    font-weight: 600;
    border-radius: 30px;
    background: linear-gradient(90deg, #6a5ae0, #a890ff);
    border: none;
    box-shadow: 0 5px 15px rgba(106, 90, 224, 0.4);
    transition: all 0.3s ease;
    padding: 12px 30px;
    margin-top: 10px;
  }
  
  #start-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(106, 90, 224, 0.6);
  }
  
  .game-level-indicator {
    position: absolute;
    top: 15px;
    left: 15px;
    background: rgba(106, 90, 224, 0.3);
    border: 1px solid rgba(106, 90, 224, 0.5);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    color: white;
    font-weight: 600;
  }
  
  /* Game Screen */
  #game-screen {
    position: relative;
    padding-top: 50px;
  }
  
  .color-word-container {
    height: 180px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 30px;
    position: relative;
  }
  
  .countdown {
    position: absolute;
    font-size: 5rem;
    font-weight: 700;
    color: white;
    opacity: 0;
    animation: countdownAnimation 1s ease-in-out;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
  }
  
  @keyframes countdownAnimation {
    0% {
      transform: scale(1.5);
      opacity: 0;
    }
    20% {
      transform: scale(1);
      opacity: 1;
    }
    80% {
      transform: scale(1);
      opacity: 1;
    }
    100% {
      transform: scale(0.5);
      opacity: 0;
    }
  }
  
  .color-word {
    font-size: 5rem;
    font-weight: 800;
    letter-spacing: 2px;
    text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    opacity: 0;
    transform: scale(0.9);
  }
  
  .color-word.active {
    opacity: 1;
    transform: scale(1);
  }
  
  .color-word.exit {
    opacity: 0;
    transform: scale(1.1);
  }
  
  .game-controls {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 25px;
  }
  
  .answer-btn {
    padding: 15px 30px;
    border: none;
    border-radius: 12px;
    font-size: 1.2rem;
    font-weight: 700;
    color: white;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 150px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  }
  
  .true-btn {
    background: linear-gradient(135deg, #4CAF50, #2E7D32);
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
  }
  
  .true-btn:hover {
    background: linear-gradient(135deg, #5CBD60, #3E8D42);
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
  }
  
  .false-btn {
    background: linear-gradient(135deg, #F44336, #C62828);
    box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
  }
  
  .false-btn:hover {
    background: linear-gradient(135deg, #FF5346, #D63838);
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(244, 67, 54, 0.4);
  }
  
  .answer-btn:active {
    transform: translateY(1px);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  }
  
  .feedback {
    height: 30px;
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 25px;
    transition: all 0.3s ease;
  }
  
  .feedback.correct {
    color: #4CAF50;
  }
  
  .feedback.wrong {
    color: #F44336;
  }
  
  .timer-bar-container {
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
  }
  
  .timer-bar {
    height: 100%;
    background: linear-gradient(to right, #6a5ae0, #a890ff);
    width: 100%;
    border-radius: 4px;
    transition: width linear 0.1s;
  }
  
  /* Game Sidebar */
  .game-sidebar {
    width: 300px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  
  .game-stats, .game-achievements {
    background: rgba(25, 25, 45, 0.8);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
  }
  
  .game-stats:hover, .game-achievements:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
    border-color: rgba(106, 90, 224, 0.15);
  }
  
  .game-stats h3, .game-achievements h3 {
    color: var(--accent-color);
    font-size: 1.3rem;
    margin-bottom: 20px;
    text-align: center;
    font-weight: 600;
    position: relative;
    display: inline-block;
    padding-bottom: 8px;
  }
  
  .game-stats h3:after, .game-achievements h3:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--accent-color);
    border-radius: 2px;
  }
  
  .stats-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  
  .stat-row {
    display: flex;
    justify-content: space-between;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .stat-row:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .stat-name {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.95rem;
  }
  
  .stat-value {
    color: white;
    font-weight: 600;
    font-size: 0.95rem;
  }
  
  .achievements-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  
  .achievement-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .achievement-item:last-child {
    padding-bottom: 0;
    border-bottom: none;
  }
  
  .achievement-icon {
    width: 40px;
    height: 40px;
    background: rgba(40, 40, 80, 0.6);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--accent-color);
    font-size: 1.2rem;
    flex-shrink: 0;
    transition: all 0.3s ease;
  }
  
  .achievement-item:hover .achievement-icon {
    background: rgba(106, 90, 224, 0.3);
    transform: scale(1.1);
  }
  
  .achievement-item.completed .achievement-icon {
    background: rgba(106, 90, 224, 0.6);
    color: white;
  }
  
  .achievement-info {
    flex: 1;
  }
  
  .achievement-name {
    color: white;
    font-weight: 600;
    font-size: 0.95rem;
    margin-bottom: 5px;
  }
  
  .achievement-progress {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }
  
  .progress-bar {
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(to right, #6a5ae0, #a890ff);
    transition: width 0.3s ease;
  }
  
  .progress-text {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
    text-align: right;
  }
  
  .btn-block {
    width: 100%;
    margin-top: auto;
    border-radius: 30px;
    font-weight: 500;
    transition: all 0.3s ease;
    text-align: center;
  }
  
  .btn-block:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  }
  
  /* Result Screen */
  .result-stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 20px;
  }
  
  .result-stat {
    background: rgba(40, 40, 80, 0.6);
    border-radius: 16px;
    padding: 25px;
    min-width: 120px;
    text-align: center;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
    flex: 1;
    max-width: 150px;
  }
  
  .result-stat:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
    border-color: rgba(106, 90, 224, 0.15);
  }
  
  .result-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--accent-color);
    margin-bottom: 10px;
    text-shadow: 0 0 15px rgba(106, 90, 224, 0.3);
    background: linear-gradient(90deg, #6a5ae0, #a890ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  
  .result-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
  }
  
  .performance-meter {
    background: rgba(40, 40, 80, 0.6);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 25px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
  }
  
  .performance-meter:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
    border-color: rgba(106, 90, 224, 0.15);
  }
  
  .meter-label {
    text-align: center;
    font-size: 1.1rem;
    color: white;
    font-weight: 600;
    margin-bottom: 15px;
  }
  
  .meter-bar-container {
    height: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 5px;
    overflow: hidden;
    margin-bottom: 10px;
  }
  
  .meter-bar {
    height: 100%;
    background: linear-gradient(to right, #ff7675, #fd79a8, #6a5ae0, #74b9ff, #00cec9);
    width: 0%;
    border-radius: 5px;
    transition: width 1.5s ease-out;
  }
  
  .meter-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
  }
  
  .result-details {
    background: rgba(40, 40, 80, 0.6);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 30px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.05);
  }
  
  .detail-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .detail-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .detail-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.95rem;
  }
  
  .detail-value {
    color: white;
    font-weight: 600;
    font-size: 0.95rem;
  }
  
  .result-actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 300px;
    margin: 0 auto;
  }
  
  .result-actions button,
  .result-actions a {
    border-radius: 30px;
    font-weight: 500;
    transition: all 0.3s ease;
    padding: 10px 20px;
  }
  
  .result-actions button:hover,
  .result-actions a:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  }
  
  .game-notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(25, 25, 45, 0.9);
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    max-width: 300px;
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s ease;
    pointer-events: none;
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.05);
  }
  
  .game-notification.show {
    transform: translateY(0);
    opacity: 1;
    pointer-events: all;
  }
  
  .notification-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .notification-content p {
    margin: 0;
    color: white;
    font-size: 0.95rem;
  }
  
  .btn-close {
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    font-size: 1rem;
    padding: 0;
    margin-left: 10px;
  }
  
  /* Animations */
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes slideInUp {
    from { 
      transform: translateY(20px);
      opacity: 0;
    }
    to { 
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  #result-screen .result-stats, 
  #result-screen .performance-meter,
  #result-screen .result-details,
  #result-screen .result-actions {
    animation: slideInUp 0.6s ease-out;
    animation-fill-mode: both;
  }
  
  #result-screen .performance-meter {
    animation-delay: 0.1s;
  }
  
  #result-screen .result-details {
    animation-delay: 0.2s;
  }
  
  #result-screen .result-actions {
    animation-delay: 0.3s;
  }
  
  /* Responsive adaptations */
  @media (max-width: 992px) {
    .game-layout {
      flex-direction: column;
      align-items: center;
    }
    
    .game-sidebar {
      width: 100%;
      max-width: 600px;
    }
  }
  
  @media (max-width: 768px) {
    .game-status {
      flex-wrap: wrap;
    }
    
    .status-item {
      flex: 1 0 50%;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .status-item:nth-child(2n) {
      border-right: none;
    }
    
    .status-item:nth-child(3), 
    .status-item:nth-child(4) {
      border-bottom: none;
    }
    
    .game-screen {
      padding: 20px;
    }
    
    .game-screen h2 {
      font-size: 1.8rem;
    }
    
    .color-word-container {
      height: 150px;
    }
    
    .color-word {
      font-size: 3.5rem;
    }
    
    .game-controls {
      flex-direction: column;
      gap: 10px;
    }
    
    .answer-btn {
      width: 100%;
    }
    
    .result-stat {
      min-width: 100px;
      padding: 15px;
    }
    
    .result-value {
      font-size: 2rem;
    }
    
    .switch-container {
      width: 100%;
    }
  }
  
  @media (max-width: 480px) {
    .status-item {
      flex: 1 0 100%;
      border-right: none;
    }
    
    .status-item:nth-child(3) {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .status-value {
      font-size: 1.5rem;
    }
    
    .color-word {
      font-size: 2.5rem;
    }
    
    .game-screen h2 {
      font-size: 1.6rem;
    }
    
    .option-button, .mode-button {
      font-size: 0.9rem;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // DOM Elements
  const startScreen = document.getElementById('start-screen');
  const gameScreen = document.getElementById('game-screen');
  const resultScreen = document.getElementById('result-screen');
  
  const startBtn = document.getElementById('start-btn');
  const trueBtn = document.getElementById('true-btn');
  const falseBtn = document.getElementById('false-btn');
  const playAgainBtn = document.getElementById('play-again-btn');
  
  const scoreDisplay = document.getElementById('score');
  const bestScoreDisplay = document.getElementById('best-score');
  const streakDisplay = document.getElementById('streak');
  const streakFire = document.getElementById('streak-fire');
  const timerDisplay = document.getElementById('timer');
  const timerBar = document.getElementById('timer-bar');
  const timerBarSmall = document.getElementById('timer-bar-small');
  const levelIndicator = document.getElementById('level-indicator');
  const colorWord = document.getElementById('color-word');
  const countdown = document.getElementById('countdown');
  const feedback = document.getElementById('feedback');
  
  // Statistics Elements
  const reactionTimeDisplay = document.getElementById('reaction-time');
  const accuracyRateDisplay = document.getElementById('accuracy-rate');
  const totalAnswersDisplay = document.getElementById('total-answers');
  
  // Achievements Elements
  const streakProgress = document.getElementById('streak-progress');
  const speedProgress = document.getElementById('speed-progress');
  const accuracyProgress = document.getElementById('accuracy-progress');
  
  // Results Elements
  const finalScoreDisplay = document.getElementById('final-score');
  const correctAnswersDisplay = document.getElementById('correct-answers');
  const wrongAnswersDisplay = document.getElementById('wrong-answers');
  const accuracyDisplay = document.getElementById('accuracy');
  const maxStreakDisplay = document.getElementById('max-streak');
  const avgReactionTimeDisplay = document.getElementById('avg-reaction-time');
  const performanceBar = document.getElementById('performance-bar');
  
  // Notification
  const notification = document.getElementById('notification');
  const notificationMessage = document.getElementById('notification-message');
  const closeNotification = document.getElementById('close-notification');
  
  // Game settings
  let gameSettings = {
    speed: 'medium',
    mode: 'standard',
    enableParticles: true,
    enableAnimations: true
  };
  
  // Game state
  let score = 0;
  let bestScore = localStorage.getItem('colorMatch_bestScore') || 0;
  let streak = 0;
  let maxStreak = 0;
  let level = 1;
  let timer = 60;
  let gameInterval = null;
  let wordInterval = null;
  let currentWordMatch = false;
  let gameActive = false;
  let correctAnswers = 0;
  let wrongAnswers = 0;
  let totalAnswers = 0;
  let lastWordTime = 0;
  let reactionTimes = [];
  let wordTimeouts = [];
  
  // Colors and words
  const colors = {
    'KIRMIZI': 'red',
    'MAVİ': 'blue',
    'YEŞİL': 'green',
    'SARI': 'yellow',
    'MOR': 'purple',
    'TURUNCU': 'orange'
  };
  
  // Initialize best score
  bestScoreDisplay.textContent = bestScore;
  
  // Set up event listeners
  startBtn.addEventListener('click', startGame);
  trueBtn.addEventListener('click', () => checkAnswer(true));
  falseBtn.addEventListener('click', () => checkAnswer(false));
  playAgainBtn.addEventListener('click', resetGame);
  closeNotification.addEventListener('click', hideNotification);
  
  // Difficulty buttons
  document.querySelectorAll('[data-speed]').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('[data-speed]').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      gameSettings.speed = this.getAttribute('data-speed');
    });
  });
  
  // Mode buttons
  document.querySelectorAll('[data-mode]').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('[data-mode]').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      gameSettings.mode = this.getAttribute('data-mode');
    });
  });
  
  // Visual effect settings
  document.getElementById('enable-particles').addEventListener('change', function() {
    gameSettings.enableParticles = this.checked;
  });
  
  document.getElementById('enable-animations').addEventListener('change', function() {
    gameSettings.enableAnimations = this.checked;
  });
  
  // Keyboard event listener
  document.addEventListener('keydown', handleKeyPress);
  
  // Start the game
  function startGame() {
    // Hide start screen, show game screen
    startScreen.style.display = 'none';
    gameScreen.style.display = 'block';
    resultScreen.style.display = 'none';
    
    // Reset game state
    score = 0;
    streak = 0;
    level = 1;
    timer = gameSettings.mode === 'endless' ? Infinity : 60;
    correctAnswers = 0;
    wrongAnswers = 0;
    totalAnswers = 0;
    reactionTimes = [];
    
    // Update displays
    scoreDisplay.textContent = '0';
    streakDisplay.textContent = '0';
    timerDisplay.textContent = gameSettings.mode === 'endless' ? '∞' : timer;
    levelIndicator.textContent = `Seviye ${level}`;
    
    // Reset achievement progress
    streakProgress.style.width = '0%';
    speedProgress.style.width = '0%';
    accuracyProgress.style.width = '0%';
    document.querySelectorAll('#streak-progress + .progress-text')[0].textContent = '0/10';
    document.querySelectorAll('#speed-progress + .progress-text')[0].textContent = '0 ms / 500 ms';
    document.querySelectorAll('#accuracy-progress + .progress-text')[0].textContent = '0%';
    
    document.querySelectorAll('.achievement-item').forEach(item => {
      item.classList.remove('completed');
    });
    
    // Start countdown
    startCountdown();
  }
  
  // Start countdown before game begins
  function startCountdown() {
    let count = 3;
    countdown.textContent = count;
    countdown.style.opacity = '1';
    
    const countdownInterval = setInterval(() => {
      count--;
      if (count > 0) {
        countdown.style.opacity = '0';
        setTimeout(() => {
          countdown.textContent = count;
          countdown.style.opacity = '1';
        }, 300);
      } else {
        clearInterval(countdownInterval);
        countdown.style.opacity = '0';
        
        // Start the actual game after countdown
        startGameplay();
      }
    }, 1000);
  }
  
  // Start actual gameplay after countdown
  function startGameplay() {
    gameActive = true;
    
    // Start the game timer if not in endless mode
    if (gameSettings.mode !== 'endless') {
      gameInterval = setInterval(() => {
        timer--;
        timerDisplay.textContent = timer;
        timerBarSmall.style.width = `${(timer / 60) * 100}%`;
        
        // Add warning class when time is running out
        if (timer <= 10) {
          timerDisplay.parentElement.classList.add('timer-warning');
        }
        
        // End game when timer reaches 0
        if (timer <= 0) {
          endGame();
        }
      }, 1000);
    }
    
    // Show first word
    showNextWord();
  }
  
  // Show next word with random color
  function showNextWord() {
    // Clear any existing word timeouts
    wordTimeouts.forEach(timeout => clearTimeout(timeout));
    wordTimeouts = [];
    
    // Get random word and color
    const words = Object.keys(colors);
    const randomWordIndex = Math.floor(Math.random() * words.length);
    const randomWord = words[randomWordIndex];
    
    // For the color, make it match the word meaning 50% of the time
    const shouldMatch = Math.random() < 0.5;
    let randomColor;
    
    if (shouldMatch) {
      randomColor = colors[randomWord];
      currentWordMatch = true;
    } else {
      // Choose a different color than the word's meaning
      const colorValues = Object.values(colors);
      const wordColor = colors[randomWord];
      const otherColors = colorValues.filter(color => color !== wordColor);
      const randomColorIndex = Math.floor(Math.random() * otherColors.length);
      randomColor = otherColors[randomColorIndex];
      currentWordMatch = false;
    }
    
    // Update the word and color
    colorWord.textContent = randomWord;
    colorWord.style.color = randomColor;
    
    // For harder levels, rotate or scale the word slightly
    if (level >= 3 && gameSettings.enableAnimations) {
      const rotation = Math.random() * 20 - 10;
      const scale = 0.9 + Math.random() * 0.2;
      colorWord.style.transform = `rotate(${rotation}deg) scale(${scale})`;
    } else {
      colorWord.style.transform = 'rotate(0deg) scale(1)';
    }
    
    // Animate the word in
    colorWord.classList.remove('active', 'exit');
    setTimeout(() => {
      colorWord.classList.add('active');
    }, 10);
    
    // Record time for reaction time calculation
    lastWordTime = Date.now();
    
    // Set timeout for word based on difficulty
    let wordTime;
    switch (gameSettings.speed) {
      case 'slow':
        wordTime = 3000 - (level * 200);
        break;
      case 'medium':
        wordTime = 2500 - (level * 250);
        break;
      case 'fast':
        wordTime = 2000 - (level * 300);
        break;
      default:
        wordTime = 2500 - (level * 250);
    }
    
    // Ensure minimum time is 500ms
    wordTime = Math.max(wordTime, 500);
    
    // Set timeout to show next word
    const timeout = setTimeout(() => {
      // Animate current word out
      colorWord.classList.remove('active');
      colorWord.classList.add('exit');
      
      // No answer was given, count as wrong
      wrongAnswers++;
      totalAnswers++;
      streak = 0;
      streakDisplay.textContent = streak;
      streakFire.classList.remove('active');
      
      // Update accuracy
      updateAccuracy();
      
      // Show feedback
      feedback.textContent = 'Çok yavaş!';
      feedback.className = 'feedback wrong';
      
      // Show next word after animation
      setTimeout(() => showNextWord(), 300);
    }, wordTime);
    
    wordTimeouts.push(timeout);
    
    // Update timer bar for this word
    timerBar.style.transition = `width ${wordTime}ms linear`;
    timerBar.style.width = '0%';
    
    // Reset timer bar after a small delay (for transition to work properly)
    setTimeout(() => {
      timerBar.style.transition = 'none';
      timerBar.style.width = '100%';
      
      setTimeout(() => {
        timerBar.style.transition = `width ${wordTime}ms linear`;
        timerBar.style.width = '0%';
      }, 10);
    }, 10);
  }
  
  // Check user's answer
  function checkAnswer(userAnswer) {
    if (!gameActive) return;
    
    // Calculate reaction time
    const reactionTime = Date.now() - lastWordTime;
    reactionTimes.push(reactionTime);
    
    // Update reaction time display
    reactionTimeDisplay.textContent = `${reactionTime} ms`;
    
    // Clear any pending word timeouts
    wordTimeouts.forEach(timeout => clearTimeout(timeout));
    wordTimeouts = [];
    
    // Check if answer is correct
    const isCorrect = userAnswer === currentWordMatch;
    
    // Update score and streak
    if (isCorrect) {
      // Calculate points based on reaction time, streak, and level
      let points = 10 * level;
      
      // Bonus for fast reaction
      const reactionBonus = Math.max(0, Math.floor((3000 - reactionTime) / 100));
      points += reactionBonus;
      
      // Streak bonus
      const streakBonus = Math.floor(streak / 3) * 5;
      points += streakBonus;
      
      // Update score
      score += points;
      scoreDisplay.textContent = score;
      
      // Add flash animation
      scoreDisplay.classList.add('flash');
      setTimeout(() => scoreDisplay.classList.remove('flash'), 500);
      
      // Update streak
      streak++;
      streakDisplay.textContent = streak;
      
      // Update max streak
      if (streak > maxStreak) {
        maxStreak = streak;
      }
      
      // Show streak fire animation
      if (streak >= 3) {
        streakFire.classList.add('active');
      }
      
      // Update correct answers count
      correctAnswers++;
      
      // Show feedback
      feedback.textContent = `Doğru! +${points} puan`;
      feedback.className = 'feedback correct';
      
      // Add particle effect if enabled
      if (gameSettings.enableParticles) {
        createParticleEffect(true);
      }
      
      // Check for level up
      if (score >= level * 100) {
        levelUp();
      }
    } else {
      // Wrong answer
      streak = 0;
      streakDisplay.textContent = streak;
      streakFire.classList.remove('active');
      wrongAnswers++;
      
      // Show feedback
      feedback.textContent = 'Yanlış!';
      feedback.className = 'feedback wrong';
      
      // Add particle effect if enabled
      if (gameSettings.enableParticles) {
        createParticleEffect(false);
      }
    }
    
    // Update total answers
    totalAnswers++;
    totalAnswersDisplay.textContent = totalAnswers;
    
    // Update accuracy
    updateAccuracy();
    
    // Update achievement progress
    updateAchievements();
    
    // Show next word
    colorWord.classList.remove('active');
    colorWord.classList.add('exit');
    
    setTimeout(() => showNextWord(), 300);
  }
  
  // Handle keyboard input
  function handleKeyPress(event) {
    if (!gameActive) return;
    
    // T for True, F for False
    if (event.key === 't' || event.key === 'T') {
      checkAnswer(true);
    } else if (event.key === 'f' || event.key === 'F') {
      checkAnswer(false);
    }
  }
  
  // Update accuracy display
  function updateAccuracy() {
    const accuracy = totalAnswers > 0 ? Math.round((correctAnswers / totalAnswers) * 100) : 0;
    accuracyRateDisplay.textContent = `${accuracy}%`;
  }
  
  // Update achievements progress
  function updateAchievements() {
    // Streak achievement
    const streakPercentage = Math.min(100, (streak / 10) * 100);
    streakProgress.style.width = `${streakPercentage}%`;
    document.querySelectorAll('#streak-progress + .progress-text')[0].textContent = `${streak}/10`;
    
    if (streak >= 10) {
      document.getElementById('achievement-streak').classList.add('completed');
      showNotification('Başarı Kazanıldı: Ateş Serisi!');
    }
    
    // Speed achievement (average reaction time less than 500ms)
    const avgReactionTime = reactionTimes.reduce((sum, time) => sum + time, 0) / reactionTimes.length || 0;
    const speedPercentage = Math.min(100, Math.max(0, (1000 - avgReactionTime) / 5));
    speedProgress.style.width = `${speedPercentage}%`;
    document.querySelectorAll('#speed-progress + .progress-text')[0].textContent = `${Math.round(avgReactionTime)} ms / 500 ms`;
    
    if (avgReactionTime > 0 && avgReactionTime < 500) {
      document.getElementById('achievement-speed').classList.add('completed');
      showNotification('Başarı Kazanıldı: Şimşek Hızı!');
    }
    
    // Accuracy achievement
    const accuracy = totalAnswers > 0 ? (correctAnswers / totalAnswers) * 100 : 0;
    const accuracyPercentage = Math.min(100, accuracy);
    accuracyProgress.style.width = `${accuracyPercentage}%`;
    document.querySelectorAll('#accuracy-progress + .progress-text')[0].textContent = `${Math.round(accuracy)}%`;
    
    if (totalAnswers >= 10 && accuracy >= 90) {
      document.getElementById('achievement-accuracy').classList.add('completed');
      showNotification('Başarı Kazanıldı: Keskin Gözler!');
    }
  }
  
  // Level up
  function levelUp() {
    level++;
    levelIndicator.textContent = `Seviye ${level}`;
    
    // Update level display with animation
    levelIndicator.classList.add('flash');
    setTimeout(() => levelIndicator.classList.remove('flash'), 500);
    
    // Show notification
    showNotification(`Seviye ${level}'e yükseldiniz!`);
  }
  
  // End game
  function endGame() {
    // Stop timers
    clearInterval(gameInterval);
    wordTimeouts.forEach(timeout => clearTimeout(timeout));
    
    // Set game active to false
    gameActive = false;
    
    // Update best score
    if (score > bestScore) {
      bestScore = score;
      localStorage.setItem('colorMatch_bestScore', bestScore);
      bestScoreDisplay.textContent = bestScore;
    }
    
    // Calculate final statistics
    const accuracy = totalAnswers > 0 ? Math.round((correctAnswers / totalAnswers) * 100) : 0;
    const avgReactionTime = reactionTimes.length > 0 ? Math.round(reactionTimes.reduce((sum, time) => sum + time, 0) / reactionTimes.length) : 0;
    
    // Update results screen
    finalScoreDisplay.textContent = score;
    correctAnswersDisplay.textContent = correctAnswers;
    wrongAnswersDisplay.textContent = wrongAnswers;
    accuracyDisplay.textContent = `${accuracy}%`;
    maxStreakDisplay.textContent = maxStreak;
    avgReactionTimeDisplay.textContent = avgReactionTime;
    
    // Set performance bar
    const performancePercentage = calculatePerformance();
    setTimeout(() => {
      performanceBar.style.width = `${performancePercentage}%`;
    }, 500);
    
    // Hide game screen, show results screen
    gameScreen.style.display = 'none';
    resultScreen.style.display = 'block';
  }
  
  // Reset game
  function resetGame() {
    // Hide results screen, show start screen
    resultScreen.style.display = 'none';
    startScreen.style.display = 'block';
  }
  
  // Calculate performance percentage
  function calculatePerformance() {
    // Base on score, accuracy, and reaction time
    const scorePercentage = Math.min(100, (score / 500) * 100);
    const accuracy = totalAnswers > 0 ? (correctAnswers / totalAnswers) * 100 : 0;
    const reactionPercentage = reactionTimes.length > 0 ? 
      Math.min(100, Math.max(0, (2000 - (reactionTimes.reduce((sum, time) => sum + time, 0) / reactionTimes.length)) / 15)) : 0;
    
    // Weighted average
    return (scorePercentage * 0.5) + (accuracy * 0.3) + (reactionPercentage * 0.2);
  }
  
  // Create particle effect
  function createParticleEffect(isCorrect) {
    const color = isCorrect ? '#4CAF50' : '#F44336';
    const source = isCorrect ? trueBtn : falseBtn;
    
    // Get button position
    const rect = source.getBoundingClientRect();
    const x = rect.left + rect.width / 2;
    const y = rect.top + rect.height / 2;
    
    // Create particles
    for (let i = 0; i < 20; i++) {
      createParticle(x, y, color);
    }
  }
  
  // Create individual particle
  function createParticle(x, y, color) {
    const particle = document.createElement('div');
    particle.style.position = 'fixed';
    particle.style.width = '8px';
    particle.style.height = '8px';
    particle.style.backgroundColor = color;
    particle.style.borderRadius = '50%';
    particle.style.pointerEvents = 'none';
    particle.style.zIndex = '1000';
    document.body.appendChild(particle);
    
    // Random angle and speed
    const angle = Math.random() * Math.PI * 2;
    const speed = Math.random() * 100 + 50;
    const vx = Math.cos(angle) * speed;
    const vy = Math.sin(angle) * speed;
    const lifetime = Math.random() * 1000 + 500;
    
    // Animation
    let startTime = Date.now();
    
    function animate() {
      const elapsed = Date.now() - startTime;
      
      if (elapsed > lifetime) {
        particle.remove();
        return;
      }
      
      const progress = elapsed / lifetime;
      const currentX = x + vx * progress;
      const currentY = y + vy * progress + 100 * progress * progress; // Add gravity
      const opacity = 1 - progress;
      const scale = 1 - progress * 0.5;
      
      particle.style.left = `${currentX}px`;
      particle.style.top = `${currentY}px`;
      particle.style.opacity = opacity;
      particle.style.transform = `scale(${scale})`;
      
      requestAnimationFrame(animate);
    }
    
    requestAnimationFrame(animate);
  }
  
  // Show notification
  function showNotification(message) {
    notificationMessage.textContent = message;
    notification.classList.add('show');
    
    // Auto-hide after 3 seconds
    setTimeout(() => {
      hideNotification();
    }, 3000);
  }
  
  // Hide notification
  function hideNotification() {
    notification.classList.remove('show');
  }
});
</script>
{% endblock %}