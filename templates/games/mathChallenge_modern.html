{% extends 'layout.html' %}

{% block title %}Matematik Mücadelesi - ZekaPark{% endblock %}

{% block content %}
<div class="page-container">
  <div class="game-container">
    <div class="game-header">
      <h1>Matematik Mücadelesi <span class="badge">Sayısal Beceri</span></h1>
      <p class="game-description">Hızlı düşünme ve matematiksel becerilerinizi test edin.</p>
    </div>

    <div class="math-container">
      <div class="game-status">
        <div class="status-item">
          <div class="status-label">Skor</div>
          <div class="status-value" id="score">0</div>
        </div>
        <div class="status-item">
          <div class="status-label">En İyi</div>
          <div class="status-value" id="best-score">0</div>
        </div>
        <div class="status-item">
          <div class="status-label">Doğru</div>
          <div class="status-value" id="correct-count">0</div>
        </div>
        <div class="status-item">
          <div class="status-label">Seviye</div>
          <div class="status-value" id="level-display">1</div>
        </div>
        <div class="status-item timer-container">
          <div class="status-label">Süre</div>
          <div class="status-value" id="timer">60</div>
          <div class="timer-bar-small-container">
            <div id="timer-bar-small" class="timer-bar-small"></div>
          </div>
        </div>
      </div>
      
      <div id="start-screen" class="math-screen">
        <h2>Matematik Mücadelesine<br>Hoş Geldiniz!</h2>
        <p>Verilen süre içinde matematik problemlerini çözmeye çalışın.</p>
        
        <div class="game-options">
          <div class="options-row">
            <div class="option-section">
              <h3>Zorluk Seviyesi</h3>
              <div class="button-group">
                <button class="option-button active" data-difficulty="easy">Kolay</button>
                <button class="option-button" data-difficulty="medium">Orta</button>
                <button class="option-button" data-difficulty="hard">Zor</button>
              </div>
            </div>
            
            <div class="option-section">
              <h3>Süre</h3>
              <div class="button-group">
                <button class="option-button" data-time="30">30 Saniye</button>
                <button class="option-button active" data-time="60">60 Saniye</button>
                <button class="option-button" data-time="120">2 Dakika</button>
              </div>
            </div>
          </div>
          
          <div class="option-section" id="game-mode-section">
            <h3>Oyun Modu</h3>
            <div class="button-group mode-buttons">
              <button class="mode-button active" data-mode="standard">
                <i class="fas fa-calculator mode-icon"></i>
                <span>Standart</span>
                <small>Zorlaşan matematik soruları</small>
              </button>
              <button class="mode-button" data-mode="blitz">
                <i class="fas fa-bolt mode-icon"></i>
                <span>Hızlı</span>
                <small>Kısa süreli, hızlı sorular</small>
              </button>
              <button class="mode-button" data-mode="endless">
                <i class="fas fa-infinity mode-icon"></i>
                <span>Sonsuz</span>
                <small>Zaman baskısı olmadan</small>
              </button>
            </div>
          </div>
          
          <div class="option-section">
            <h3>İşlem Türleri</h3>
            <div class="checkbox-grid">
              <label class="checkbox-label">
                <input type="checkbox" checked data-operation="addition">
                <span class="checkmark"></span>
                <div class="checkbox-content">
                  <span class="op-icon">+</span>
                  <span>Toplama</span>
                </div>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" checked data-operation="subtraction">
                <span class="checkmark"></span>
                <div class="checkbox-content">
                  <span class="op-icon">−</span>
                  <span>Çıkarma</span>
                </div>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" checked data-operation="multiplication">
                <span class="checkmark"></span>
                <div class="checkbox-content">
                  <span class="op-icon">×</span>
                  <span>Çarpma</span>
                </div>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" data-operation="division">
                <span class="checkmark"></span>
                <div class="checkbox-content">
                  <span class="op-icon">÷</span>
                  <span>Bölme</span>
                </div>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" data-operation="exponent">
                <span class="checkmark"></span>
                <div class="checkbox-content">
                  <span class="op-icon">x²</span>
                  <span>Üs Alma</span>
                </div>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" data-operation="percentage">
                <span class="checkmark"></span>
                <div class="checkbox-content">
                  <span class="op-icon">%</span>
                  <span>Yüzde</span>
                </div>
              </label>
            </div>
          </div>
          
          <div class="option-section" id="visual-effects-section">
            <h3>Görsel Efektler</h3>
            <div class="toggle-group">
              <label class="toggle-switch">
                <input type="checkbox" id="enable-particles" checked>
                <span class="slider"></span>
                <span class="toggle-label">Parçacık Efektleri</span>
              </label>
              <label class="toggle-switch">
                <input type="checkbox" id="enable-animations" checked>
                <span class="slider"></span>
                <span class="toggle-label">Animasyonlar</span>
              </label>
            </div>
          </div>
        </div>
        
        <button id="start-game" class="btn btn-primary btn-lg">
          <i class="fas fa-play me-2"></i>Oyuna Başla
        </button>
      </div>

      <div id="game-screen" class="math-screen" style="display: none;">
        <div id="countdown" class="countdown">3</div>
        
        <div class="level-indicator" id="level-indicator">Seviye 1</div>
        
        <div class="math-problem-container">
          <div class="problem-card">
            <div id="problem-text">5 + 3 = ?</div>
            <div class="problem-timer-bar-container">
              <div class="problem-timer-bar" id="problem-timer-bar"></div>
            </div>
          </div>
        </div>

        <div class="answer-input">
          <input type="number" id="answer-input" placeholder="Cevabınız">
          <button id="submit-answer" class="btn btn-primary">
            <i class="fas fa-check me-2"></i>Kontrol Et
          </button>
        </div>

        <div id="feedback" class="feedback"></div>
        
        <div class="streak-bar">
          <div class="streak-counter">
            <span id="streak-count">0</span> Seri
          </div>
          <div class="streak-icons" id="streak-icons"></div>
        </div>
        
        <div class="timer-bar-container">
          <div id="timer-bar" class="timer-bar"></div>
        </div>
      </div>

      <div id="result-screen" class="math-screen" style="display: none;">
        <h2>Oyun Bitti!</h2>
        
        <div class="result-stats">
          <div class="result-stat">
            <div class="result-value" id="final-score">0</div>
            <div class="result-label">Toplam Puan</div>
          </div>
          <div class="result-stat">
            <div class="result-value" id="final-correct">0</div>
            <div class="result-label">Doğru</div>
          </div>
          <div class="result-stat">
            <div class="result-value" id="final-incorrect">0</div>
            <div class="result-label">Yanlış</div>
          </div>
          <div class="result-stat">
            <div class="result-value" id="final-level">1</div>
            <div class="result-label">Seviye</div>
          </div>
        </div>
        
        <div class="result-details">
          <div class="detail-item">
            <span class="detail-label">Doğruluk Oranı:</span>
            <span class="detail-value" id="accuracy">0%</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">En Uzun Seri:</span>
            <span class="detail-value" id="max-streak">0</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Ortalama Yanıt Süresi:</span>
            <span class="detail-value" id="avg-time">0 saniye</span>
          </div>
        </div>
        
        <div class="result-actions">
          <button id="play-again" class="btn btn-primary btn-lg">
            <i class="fas fa-redo-alt me-2"></i>Tekrar Oyna
          </button>
          <a href="{{ url_for('all_games') }}" class="btn btn-outline-light btn-lg">
            <i class="fas fa-th-large me-2"></i>Tüm Oyunlar
          </a>
        </div>
      </div>
    </div>
    
    <div id="notification" class="game-notification">
      <div class="notification-content">
        <p id="notification-message"></p>
        <button id="close-notification" class="btn-close"><i class="fas fa-times"></i></button>
      </div>
    </div>
  </div>
</div>

<style>
  .math-container {
    max-width: 100%;
    margin: 0 auto;
    padding: 0 10px;
  }
  
  .game-status {
    display: flex;
    justify-content: space-between;
    background: rgba(25, 25, 45, 0.8);
    border-radius: 16px;
    margin-bottom: 20px;
    overflow: hidden;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.05);
  }

  .status-item {
    flex: 1;
    text-align: center;
    padding: 15px 10px;
    border-right: 1px solid rgba(255, 255, 255, 0.08);
    position: relative;
  }

  .status-item:last-child {
    border-right: none;
  }

  .status-label {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 5px;
  }

  .status-value {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--accent-color);
    text-shadow: 0 0 10px rgba(106, 90, 224, 0.3);
    transition: all 0.3s ease;
  }
  
  .status-value.flash {
    animation: value-flash 0.5s ease;
  }
  
  @keyframes value-flash {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
  
  .timer-container {
    position: relative;
  }
  
  .timer-bar-small-container {
    position: absolute;
    bottom: 5px;
    left: 15px;
    right: 15px;
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    overflow: hidden;
  }
  
  .timer-bar-small {
    height: 100%;
    background: var(--accent-color);
    width: 100%;
    transition: width linear 0.1s;
  }
  
  .timer-warning .timer-bar-small {
    background: #FF4B2B;
  }

  .math-screen {
    background: rgba(25, 25, 45, 0.8);
    border-radius: 16px;
    padding: 30px;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.05);
    position: relative;
    transition: all 0.3s ease;
  }
  
  .math-screen:hover {
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
    border-color: rgba(106, 90, 224, 0.15);
  }

  .math-screen h2 {
    color: var(--accent-color);
    font-size: 2.2rem;
    margin-bottom: 20px;
    background: linear-gradient(90deg, #6a5ae0, #a890ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-weight: 700;
    line-height: 1.3;
  }

  .math-screen p {
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 25px;
    font-size: 1.1rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .countdown {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 5rem;
    font-weight: 700;
    color: white;
    opacity: 0;
    animation: countdownAnimation 1s ease-in-out;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    z-index: 10;
  }
  
  @keyframes countdownAnimation {
    0% {
      transform: translate(-50%, -50%) scale(1.5);
      opacity: 0;
    }
    20% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    80% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    100% {
      transform: translate(-50%, -50%) scale(0.5);
      opacity: 0;
    }
  }
  
  .level-indicator {
    position: absolute;
    top: 15px;
    left: 15px;
    background: rgba(106, 90, 224, 0.3);
    border: 1px solid rgba(106, 90, 224, 0.5);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    color: white;
    font-weight: 600;
    box-shadow: 0 5px 10px rgba(106, 90, 224, 0.2);
  }

  .game-options {
    margin-bottom: 30px;
  }
  
  .options-row {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
  }
  
  @media (max-width: 768px) {
    .options-row {
      flex-direction: column;
    }
  }
  
  .option-section {
    background: rgba(35, 35, 65, 0.6);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.05);
    flex: 1;
    transition: all 0.3s ease;
  }
  
  .option-section:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 20px rgba(0, 0, 0, 0.15);
    border-color: rgba(106, 90, 224, 0.15);
  }

  .option-section h3 {
    color: white;
    font-size: 1.2rem;
    margin-bottom: 15px;
    text-align: center;
    position: relative;
    display: inline-block;
    padding-bottom: 8px;
  }
  
  .option-section h3:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 30px;
    height: 2px;
    background: var(--accent-color);
    border-radius: 2px;
  }

  .button-group {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .option-button, .mode-button {
    flex: 1;
    padding: 10px 20px;
    background: rgba(40, 40, 80, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.05);
    color: white;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    min-width: 90px;
  }

  .option-button:hover, .mode-button:hover {
    background: rgba(60, 60, 100, 0.6);
    transform: translateY(-3px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
  }

  .option-button.active, .mode-button.active {
    background: rgba(106, 90, 224, 0.6);
    border-color: rgba(106, 90, 224, 0.8);
    box-shadow: 0 5px 15px rgba(106, 90, 224, 0.3);
  }
  
  .mode-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  
  .mode-button {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
    text-align: center;
  }
  
  .mode-icon {
    font-size: 1.5rem;
    margin-bottom: 8px;
    width: 40px;
    height: 40px;
    background: rgba(106, 90, 224, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 8px;
    transition: all 0.3s ease;
  }
  
  .mode-button:hover .mode-icon {
    background: rgba(106, 90, 224, 0.4);
    transform: scale(1.1);
  }
  
  .mode-button.active .mode-icon {
    background: rgba(106, 90, 224, 0.6);
  }
  
  .mode-button span {
    font-weight: 600;
    font-size: 1.1rem;
    margin-bottom: 5px;
  }
  
  .mode-button small {
    font-size: 0.8rem;
    opacity: 0.8;
  }

  .checkbox-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
  }

  .checkbox-label {
    position: relative;
    display: flex;
    align-items: center;
    color: white;
    cursor: pointer;
    background: rgba(40, 40, 80, 0.6);
    padding: 10px 15px;
    border-radius: 8px;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.05);
  }
  
  .checkbox-label:hover {
    background: rgba(60, 60, 100, 0.6);
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  }

  .checkbox-label input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
  }

  .checkmark {
    position: relative;
    height: 20px;
    width: 20px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    margin-right: 12px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
  }

  .checkbox-label:hover .checkmark {
    background-color: rgba(255, 255, 255, 0.2);
  }

  .checkbox-label input:checked ~ .checkmark {
    background-color: var(--accent-color);
    border-color: var(--accent-color);
  }

  .checkmark:after {
    content: "";
    position: absolute;
    display: none;
    left: 6px;
    top: 2px;
    width: 6px;
    height: 12px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
  }

  .checkbox-label input:checked ~ .checkmark:after {
    display: block;
  }
  
  .checkbox-content {
    display: flex;
    align-items: center;
  }
  
  .op-icon {
    width: 25px;
    height: 25px;
    background: rgba(106, 90, 224, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 8px;
    font-weight: 600;
    transition: all 0.3s ease;
  }
  
  .checkbox-label:hover .op-icon {
    background: rgba(106, 90, 224, 0.4);
  }
  
  .checkbox-label input:checked ~ .checkbox-content .op-icon {
    background: rgba(106, 90, 224, 0.6);
  }
  
  .toggle-group {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  
  .toggle-switch {
    position: relative;
    display: flex;
    align-items: center;
    width: 100%;
    cursor: pointer;
  }
  
  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  
  .slider {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 34px;
    transition: .4s;
    margin-right: 12px;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
  
  .slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 2px;
    background-color: white;
    border-radius: 50%;
    transition: .4s;
  }
  
  input:checked + .slider {
    background-color: var(--accent-color);
  }
  
  input:checked + .slider:before {
    transform: translateX(26px);
  }
  
  .toggle-label {
    font-size: 1rem;
    color: white;
  }

  /* Math Problem */
  .math-problem-container {
    height: 180px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 30px;
  }
  
  .problem-card {
    background: rgba(40, 40, 80, 0.6);
    border-radius: 16px;
    padding: 35px;
    min-width: 80%;
    position: relative;
    overflow: hidden;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
  }
  
  .problem-card:hover {
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
    border-color: rgba(106, 90, 224, 0.15);
  }

  #problem-text {
    font-size: 3rem;
    font-weight: 700;
    color: white;
    margin-bottom: 25px;
    transition: all 0.3s ease;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  }
  
  .problem-timer-bar-container {
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
    position: absolute;
    bottom: 15px;
    left: 15px;
    right: 15px;
  }
  
  .problem-timer-bar {
    height: 100%;
    background: linear-gradient(to right, #6a5ae0, #a890ff);
    width: 100%;
    transition: width linear 0.1s;
  }

  /* Answer Input */
  .answer-input {
    display: flex;
    gap: 12px;
    margin-bottom: 25px;
  }

  #answer-input {
    flex: 1;
    padding: 15px;
    background: rgba(40, 40, 80, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    color: white;
    font-size: 1.3rem;
    text-align: center;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  #answer-input:focus {
    outline: none;
    border-color: var(--accent-color);
    box-shadow: 0 0 15px rgba(106, 90, 224, 0.3);
    background: rgba(50, 50, 90, 0.6);
  }
  
  #submit-answer {
    padding: 12px 25px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 1.1rem;
    background: linear-gradient(90deg, #6a5ae0, #a890ff);
    border: none;
    box-shadow: 0 5px 15px rgba(106, 90, 224, 0.3);
    transition: all 0.3s ease;
  }
  
  #submit-answer:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(106, 90, 224, 0.5);
  }
  
  #submit-answer:active {
    transform: translateY(-1px);
  }

  /* Feedback */
  .feedback {
    font-size: 1.3rem;
    font-weight: 600;
    height: 35px;
    transition: all 0.3s ease;
    margin-bottom: 25px;
  }

  .feedback.correct {
    color: #4CAF50;
    text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
  }

  .feedback.incorrect {
    color: #F44336;
    text-shadow: 0 0 10px rgba(244, 67, 54, 0.5);
  }
  
  /* Streak Bar */
  .streak-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 25px;
    gap: 15px;
    flex-wrap: wrap;
  }
  
  .streak-counter {
    background: rgba(40, 40, 80, 0.6);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.95rem;
    color: white;
    font-weight: 600;
    border: 1px solid rgba(255, 255, 255, 0.05);
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
  }
  
  .streak-icons {
    display: flex;
    gap: 6px;
  }
  
  .streak-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 0.8rem;
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
  }
  
  .streak-icon.correct {
    background: #4CAF50;
    animation: pop 0.3s ease;
  }
  
  .streak-icon.incorrect {
    background: #F44336;
    animation: shake 0.3s ease;
  }
  
  @keyframes pop {
    0% { transform: scale(0.8); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
  
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-3px); }
    75% { transform: translateX(3px); }
  }

  .timer-bar-container {
    height: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 5px;
    overflow: hidden;
  }

  .timer-bar {
    height: 100%;
    background: linear-gradient(to right, #6a5ae0, #a890ff);
    width: 100%;
    border-radius: 5px;
    transition: width linear 0.1s;
  }

  /* Result Screen */
  .result-stats {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 35px;
  }

  .result-stat {
    background: rgba(40, 40, 80, 0.6);
    border-radius: 16px;
    padding: 25px;
    min-width: 120px;
    flex: 1;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
    max-width: 180px;
  }
  
  .result-stat:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    border-color: rgba(106, 90, 224, 0.15);
  }

  .result-value {
    font-size: 2.8rem;
    font-weight: 700;
    color: var(--accent-color);
    margin-bottom: 8px;
    text-shadow: 0 0 15px rgba(106, 90, 224, 0.3);
    background: linear-gradient(90deg, #6a5ae0, #a890ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1;
  }

  .result-label {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.8);
  }

  .result-details {
    background: rgba(40, 40, 80, 0.6);
    border-radius: 16px;
    padding: 25px;
    margin-bottom: 35px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }

  .detail-item {
    display: flex;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .detail-item:last-child {
    border-bottom: none;
  }

  .detail-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 1rem;
  }

  .detail-value {
    color: white;
    font-weight: 600;
    font-size: 1rem;
  }

  .result-actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 300px;
    margin: 0 auto;
  }
  
  .result-actions button,
  .result-actions a {
    padding: 12px 25px;
    border-radius: 30px;
    font-weight: 600;
    transition: all 0.3s ease;
  }
  
  .result-actions button:hover,
  .result-actions a:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  }
  
  #start-game {
    padding: 15px 35px;
    font-size: 1.1rem;
    font-weight: 600;
    border-radius: 30px;
    background: linear-gradient(90deg, #6a5ae0, #a890ff);
    border: none;
    box-shadow: 0 5px 15px rgba(106, 90, 224, 0.4);
    transition: all 0.3s ease;
    margin-top: 20px;
    width: 100%;
    max-width: 350px;
  }
  
  #start-game:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(106, 90, 224, 0.6);
  }
  
  #start-game:active {
    transform: translateY(-1px);
  }
  
  .game-notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(25, 25, 45, 0.9);
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    max-width: 300px;
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s ease;
    pointer-events: none;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.05);
  }
  
  .game-notification.show {
    transform: translateY(0);
    opacity: 1;
    pointer-events: all;
  }
  
  .notification-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .notification-content p {
    margin: 0;
    color: white;
    font-size: 0.95rem;
  }
  
  .btn-close {
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    font-size: 1rem;
    padding: 0;
    margin-left: 10px;
    transition: all 0.3s ease;
  }
  
  .btn-close:hover {
    color: white;
    transform: scale(1.1);
  }
  
  /* Animations */
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes slideInUp {
    from {
      transform: translateY(30px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  .math-screen {
    animation: fadeIn 0.6s ease-out;
  }
  
  .option-section, .result-stat {
    animation: slideInUp 0.6s ease-out;
  }
  
  .option-section:nth-child(2) {
    animation-delay: 0.1s;
  }
  
  .option-section:nth-child(3) {
    animation-delay: 0.2s;
  }
  
  .option-section:nth-child(4) {
    animation-delay: 0.3s;
  }
  
  /* Responsive Adaptations */
  @media (max-width: 768px) {
    .math-screen {
      padding: 20px 15px;
    }
    
    .math-screen h2 {
      font-size: 1.8rem;
    }
    
    .math-screen p {
      font-size: 1rem;
    }
    
    .option-section {
      padding: 15px;
    }
    
    .option-section h3 {
      font-size: 1.1rem;
    }
    
    .checkbox-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .mode-button {
      padding: 12px 10px;
    }
    
    .mode-icon {
      font-size: 1.3rem;
      width: 35px;
      height: 35px;
    }
    
    .mode-button span {
      font-size: 1rem;
    }
    
    #problem-text {
      font-size: 2.5rem;
    }
    
    .answer-input {
      flex-direction: column;
    }
    
    #answer-input {
      width: 100%;
      font-size: 1.2rem;
      padding: 12px;
    }
    
    #submit-answer {
      width: 100%;
    }
    
    .result-stats {
      justify-content: space-around;
    }
    
    .result-stat {
      min-width: 100px;
      padding: 15px;
      margin-bottom: 0;
      max-width: calc(50% - 10px);
    }
    
    .result-value {
      font-size: 2.3rem;
    }
    
    .result-label {
      font-size: 0.9rem;
    }
    
    .detail-label, .detail-value {
      font-size: 0.95rem;
    }
  }
  
  @media (max-width: 480px) {
    .math-screen h2 {
      font-size: 1.6rem;
    }
    
    .status-item {
      padding: 10px 5px;
    }
    
    .status-label {
      font-size: 0.8rem;
    }
    
    .status-value {
      font-size: 1.5rem;
    }
    
    .problem-card {
      padding: 25px 15px;
    }
    
    #problem-text {
      font-size: 2rem;
    }
    
    .checkbox-grid {
      grid-template-columns: 1fr;
    }
    
    .result-stat {
      max-width: 100%;
      width: 100%;
    }
    
    .result-details {
      padding: 15px;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Elements
  const startScreen = document.getElementById('start-screen');
  const gameScreen = document.getElementById('game-screen');
  const resultScreen = document.getElementById('result-screen');
  const startGameBtn = document.getElementById('start-game');
  const problemText = document.getElementById('problem-text');
  const answerInput = document.getElementById('answer-input');
  const submitAnswerBtn = document.getElementById('submit-answer');
  const feedback = document.getElementById('feedback');
  const score = document.getElementById('score');
  const bestScore = document.getElementById('best-score');
  const correctCount = document.getElementById('correct-count');
  const levelDisplay = document.getElementById('level-display');
  const timer = document.getElementById('timer');
  const timerBar = document.getElementById('timer-bar');
  const timerBarSmall = document.getElementById('timer-bar-small');
  const streakCount = document.getElementById('streak-count');
  const streakIcons = document.getElementById('streak-icons');
  const levelIndicator = document.getElementById('level-indicator');
  const problemTimerBar = document.getElementById('problem-timer-bar');
  const finalScore = document.getElementById('final-score');
  const finalCorrect = document.getElementById('final-correct');
  const finalIncorrect = document.getElementById('final-incorrect');
  const finalLevel = document.getElementById('final-level');
  const accuracy = document.getElementById('accuracy');
  const maxStreak = document.getElementById('max-streak');
  const avgTime = document.getElementById('avg-time');
  const playAgainBtn = document.getElementById('play-again');
  
  // Game settings & state
  let gameSettings = {
    difficulty: 'easy',
    time: 60,
    operations: ['addition', 'subtraction', 'multiplication'],
    mode: 'standard',
    enableParticles: true,
    enableAnimations: true
  };
  
  let gameState = {
    isRunning: false,
    score: 0,
    bestScore: localStorage.getItem('mathChallenge_bestScore') ? parseInt(localStorage.getItem('mathChallenge_bestScore')) : 0,
    correctAnswers: 0,
    incorrectAnswers: 0,
    currentStreak: 0,
    maxStreak: 0,
    level: 1,
    remainingTime: gameSettings.time,
    currentProblem: null,
    problemStartTime: null,
    totalResponseTime: 0,
    responseCount: 0,
    answersHistory: []
  };
  
  // Difficulty settings
  const difficultySettings = {
    easy: {
      minValue: 1,
      maxValue: 10,
      operations: {
        addition: { weight: 0.4 },
        subtraction: { weight: 0.3 },
        multiplication: { weight: 0.3 },
        division: { weight: 0 },
        exponent: { weight: 0 },
        percentage: { weight: 0 }
      },
      pointsMultiplier: 1,
      timePerProblem: 10
    },
    medium: {
      minValue: 5,
      maxValue: 20,
      operations: {
        addition: { weight: 0.3 },
        subtraction: { weight: 0.3 },
        multiplication: { weight: 0.3 },
        division: { weight: 0.1 },
        exponent: { weight: 0 },
        percentage: { weight: 0 }
      },
      pointsMultiplier: 2,
      timePerProblem: 8
    },
    hard: {
      minValue: 10,
      maxValue: 50,
      operations: {
        addition: { weight: 0.2 },
        subtraction: { weight: 0.2 },
        multiplication: { weight: 0.3 },
        division: { weight: 0.2 },
        exponent: { weight: 0.05 },
        percentage: { weight: 0.05 }
      },
      pointsMultiplier: 3,
      timePerProblem: 6
    }
  };
  
  // Timers
  let mainTimer = null;
  let problemTimer = null;
  
  // Setup event listeners
  startGameBtn.addEventListener('click', startGame);
  submitAnswerBtn.addEventListener('click', checkAnswer);
  playAgainBtn.addEventListener('click', resetGame);
  answerInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      checkAnswer();
    }
  });
  
  // Setup options
  setupOptionButtons();
  
  // Initialize best score
  bestScore.textContent = gameState.bestScore;
  
  function setupOptionButtons() {
    // Difficulty buttons
    document.querySelectorAll('[data-difficulty]').forEach(button => {
      button.addEventListener('click', function() {
        document.querySelectorAll('[data-difficulty]').forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        gameSettings.difficulty = this.getAttribute('data-difficulty');
      });
    });
    
    // Time buttons
    document.querySelectorAll('[data-time]').forEach(button => {
      button.addEventListener('click', function() {
        document.querySelectorAll('[data-time]').forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        gameSettings.time = parseInt(this.getAttribute('data-time'));
      });
    });
    
    // Game mode buttons
    document.querySelectorAll('[data-mode]').forEach(button => {
      button.addEventListener('click', function() {
        document.querySelectorAll('[data-mode]').forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        gameSettings.mode = this.getAttribute('data-mode');
      });
    });
    
    // Operation checkboxes
    document.querySelectorAll('[data-operation]').forEach(checkbox => {
      checkbox.addEventListener('change', function() {
        updateOperations();
      });
    });
    
    // Visual effects
    document.getElementById('enable-particles').addEventListener('change', function() {
      gameSettings.enableParticles = this.checked;
    });
    
    document.getElementById('enable-animations').addEventListener('change', function() {
      gameSettings.enableAnimations = this.checked;
    });
  }
  
  function updateOperations() {
    const selectedOperations = [];
    document.querySelectorAll('[data-operation]:checked').forEach(checkbox => {
      selectedOperations.push(checkbox.getAttribute('data-operation'));
    });
    
    if (selectedOperations.length === 0) {
      // Ensure at least one operation is selected
      document.querySelector('[data-operation="addition"]').checked = true;
      selectedOperations.push('addition');
    }
    
    gameSettings.operations = selectedOperations;
  }
  
  function startGame() {
    // Hide start screen, show game screen
    startScreen.style.display = 'none';
    gameScreen.style.display = 'block';
    resultScreen.style.display = 'none';
    
    // Update game state
    gameState.isRunning = true;
    gameState.remainingTime = gameSettings.time;
    gameState.score = 0;
    gameState.correctAnswers = 0;
    gameState.incorrectAnswers = 0;
    gameState.currentStreak = 0;
    gameState.maxStreak = 0;
    gameState.level = 1;
    gameState.totalResponseTime = 0;
    gameState.responseCount = 0;
    gameState.answersHistory = [];
    
    // Update UI
    score.textContent = '0';
    correctCount.textContent = '0';
    streakCount.textContent = '0';
    streakIcons.innerHTML = '';
    levelDisplay.textContent = '1';
    levelIndicator.textContent = 'Seviye 1';
    timer.textContent = gameSettings.time;
    timerBar.style.width = '100%';
    timerBarSmall.style.width = '100%';
    feedback.textContent = '';
    feedback.className = 'feedback';
    
    // Start countdown
    const countdown = document.getElementById('countdown');
    countdown.style.display = 'block';
    countdown.textContent = '3';
    countdown.style.opacity = '0';
    
    let count = 3;
    const countdownInterval = setInterval(() => {
      countdown.style.opacity = '0';
      setTimeout(() => {
        count--;
        if (count > 0) {
          countdown.textContent = count.toString();
          countdown.style.opacity = '1';
        } else {
          clearInterval(countdownInterval);
          countdown.style.display = 'none';
          
          // Start the game
          startMainTimer();
          generateProblem();
        }
      }, 100);
    }, 1000);
  }
  
  function startMainTimer() {
    // Clear any existing timer
    if (mainTimer) clearInterval(mainTimer);
    
    mainTimer = setInterval(() => {
      gameState.remainingTime--;
      
      // Update UI
      timer.textContent = gameState.remainingTime;
      timerBar.style.width = `${(gameState.remainingTime / gameSettings.time) * 100}%`;
      timerBarSmall.style.width = `${(gameState.remainingTime / gameSettings.time) * 100}%`;
      
      // Add warning class when time is running out
      if (gameState.remainingTime <= 10) {
        timer.parentElement.classList.add('timer-warning');
      }
      
      // End game when time runs out
      if (gameState.remainingTime <= 0) {
        endGame();
      }
    }, 1000);
  }
  
  function generateProblem() {
    // Clear problem timer
    if (problemTimer) clearInterval(problemTimer);
    
    // Clear answer input
    answerInput.value = '';
    answerInput.focus();
    
    // Get difficulty settings based on level
    const difficulty = difficultySettings[gameSettings.difficulty];
    let minValue = difficulty.minValue + Math.floor(gameState.level / 2);
    let maxValue = difficulty.maxValue + Math.floor(gameState.level * 2);
    
    // Ensure operations are available
    if (gameSettings.operations.length === 0) {
      gameSettings.operations = ['addition'];
    }
    
    // Select operation with weighted probability based on difficulty
    let availableOperations = [];
    gameSettings.operations.forEach(op => {
      if (difficulty.operations[op]) {
        // Add operation to available operations based on weight
        const weight = difficulty.operations[op].weight * 100;
        for (let i = 0; i < weight; i++) {
          availableOperations.push(op);
        }
      }
    });
    
    const operation = availableOperations[Math.floor(Math.random() * availableOperations.length)];
    
    // Generate numbers based on operation
    let num1, num2, answer, problemString;
    
    switch (operation) {
      case 'addition':
        num1 = getRandomInt(minValue, maxValue);
        num2 = getRandomInt(minValue, maxValue);
        answer = num1 + num2;
        problemString = `${num1} + ${num2} = ?`;
        break;
        
      case 'subtraction':
        num1 = getRandomInt(minValue, maxValue);
        num2 = getRandomInt(minValue, Math.min(num1, maxValue));
        answer = num1 - num2;
        problemString = `${num1} - ${num2} = ?`;
        break;
        
      case 'multiplication':
        // Adjust for multiplication to avoid too difficult problems
        num1 = getRandomInt(minValue, Math.min(12, maxValue));
        num2 = getRandomInt(minValue, Math.min(12, maxValue));
        answer = num1 * num2;
        problemString = `${num1} × ${num2} = ?`;
        break;
        
      case 'division':
        // Ensure division results in an integer
        num2 = getRandomInt(2, Math.min(10, maxValue));
        answer = getRandomInt(1, Math.min(10, maxValue));
        num1 = num2 * answer;  // This ensures clean division
        problemString = `${num1} ÷ ${num2} = ?`;
        break;
        
      case 'exponent':
        // Simple squaring for now
        num1 = getRandomInt(2, Math.min(10, maxValue));
        answer = num1 * num1;
        problemString = `${num1}² = ?`;
        break;
        
      case 'percentage':
        // Find percentage of a number
        num1 = getRandomInt(minValue, maxValue);
        num2 = getRandomInt(1, 10) * 10; // 10%, 20%, etc.
        answer = Math.round((num1 * num2) / 100);
        problemString = `${num2}% of ${num1} = ?`;
        break;
        
      default:
        num1 = getRandomInt(minValue, maxValue);
        num2 = getRandomInt(minValue, maxValue);
        answer = num1 + num2;
        problemString = `${num1} + ${num2} = ?`;
    }
    
    // Set problem
    problemText.textContent = problemString;
    gameState.currentProblem = {
      problem: problemString,
      answer: answer,
      operation: operation,
      difficulty: gameSettings.difficulty,
      level: gameState.level
    };
    
    // Start problem timer
    gameState.problemStartTime = Date.now();
    
    // Start problem timer bar
    let problemTime = difficulty.timePerProblem - Math.min(3, Math.floor(gameState.level / 3));
    if (problemTime < 2) problemTime = 2;
    
    const timeInterval = 100; // Update every 100ms
    const totalIntervals = problemTime * 10;
    let currentInterval = 0;
    
    problemTimerBar.style.width = '100%';
    
    problemTimer = setInterval(() => {
      currentInterval++;
      problemTimerBar.style.width = `${100 - (currentInterval / totalIntervals) * 100}%`;
      
      if (currentInterval >= totalIntervals) {
        // Time's up for this problem
        clearInterval(problemTimer);
        handleTimeout();
      }
    }, timeInterval);
  }
  
  function checkAnswer() {
    if (!gameState.isRunning || !gameState.currentProblem) return;
    
    // Clear problem timer
    clearInterval(problemTimer);
    
    const userAnswer = parseInt(answerInput.value.trim());
    
    if (isNaN(userAnswer)) {
      // Invalid input
      feedback.textContent = 'Lütfen geçerli bir sayı girin!';
      feedback.className = 'feedback incorrect';
      answerInput.focus();
      return;
    }
    
    const correctAnswer = gameState.currentProblem.answer;
    const isCorrect = userAnswer === correctAnswer;
    
    // Calculate response time
    const responseTime = (Date.now() - gameState.problemStartTime) / 1000;
    gameState.totalResponseTime += responseTime;
    gameState.responseCount++;
    
    // Update game state and UI
    if (isCorrect) {
      // Correct answer
      feedback.textContent = 'Doğru!';
      feedback.className = 'feedback correct';
      
      // Calculate points based on difficulty, level, and response time
      const difficulty = difficultySettings[gameSettings.difficulty];
      const basePoints = 10 * difficulty.pointsMultiplier;
      const levelBonus = gameState.level * 2;
      const timeBonus = Math.max(0, Math.floor(difficulty.timePerProblem - responseTime) * 3);
      const streakBonus = Math.floor(gameState.currentStreak / 3) * 5;
      
      const points = basePoints + levelBonus + timeBonus + streakBonus;
      
      // Update score
      gameState.score += points;
      gameState.correctAnswers++;
      gameState.currentStreak++;
      
      // Update max streak
      if (gameState.currentStreak > gameState.maxStreak) {
        gameState.maxStreak = gameState.currentStreak;
      }
      
      // Add to streak icons
      if (gameState.currentStreak <= 10) {
        const streakIcon = document.createElement('div');
        streakIcon.className = 'streak-icon correct';
        streakIcon.textContent = '✓';
        streakIcons.appendChild(streakIcon);
      }
      
      // Flash score
      score.classList.add('flash');
      setTimeout(() => score.classList.remove('flash'), 500);
      
      // Update level
      if (gameState.correctAnswers % 5 === 0) {
        gameState.level++;
        levelDisplay.textContent = gameState.level;
        levelIndicator.textContent = `Seviye ${gameState.level}`;
        
        // Flash level
        levelDisplay.classList.add('flash');
        setTimeout(() => levelDisplay.classList.remove('flash'), 500);
      }
    } else {
      // Incorrect answer
      feedback.textContent = `Yanlış! Doğru cevap: ${correctAnswer}`;
      feedback.className = 'feedback incorrect';
      
      // Reset streak
      gameState.currentStreak = 0;
      
      // Add to streak icons
      if (streakIcons.children.length <= 10) {
        const streakIcon = document.createElement('div');
        streakIcon.className = 'streak-icon incorrect';
        streakIcon.textContent = '✗';
        streakIcons.appendChild(streakIcon);
      }
      
      gameState.incorrectAnswers++;
    }
    
    // Record answer in history
    gameState.answersHistory.push({
      problem: gameState.currentProblem.problem,
      correctAnswer: correctAnswer,
      userAnswer: userAnswer,
      isCorrect: isCorrect,
      responseTime: responseTime,
      points: isCorrect ? points : 0
    });
    
    // Update UI
    score.textContent = gameState.score;
    correctCount.textContent = gameState.correctAnswers;
    streakCount.textContent = gameState.currentStreak;
    
    // Limit streak icons
    if (streakIcons.children.length > 10) {
      streakIcons.removeChild(streakIcons.firstChild);
    }
    
    // Show particle effects if enabled
    if (gameSettings.enableParticles && isCorrect) {
      createParticles(answerInput);
    }
    
    // Generate new problem after a short delay
    setTimeout(() => {
      if (gameState.isRunning) {
        generateProblem();
      }
    }, 1000);
  }
  
  function handleTimeout() {
    if (!gameState.isRunning) return;
    
    feedback.textContent = `Süre doldu! Doğru cevap: ${gameState.currentProblem.answer}`;
    feedback.className = 'feedback incorrect';
    
    // Reset streak
    gameState.currentStreak = 0;
    streakCount.textContent = '0';
    
    // Add to streak icons
    if (streakIcons.children.length <= 10) {
      const streakIcon = document.createElement('div');
      streakIcon.className = 'streak-icon incorrect';
      streakIcon.textContent = '✗';
      streakIcons.appendChild(streakIcon);
      
      // Limit streak icons
      if (streakIcons.children.length > 10) {
        streakIcons.removeChild(streakIcons.firstChild);
      }
    }
    
    gameState.incorrectAnswers++;
    
    // Record answer in history
    gameState.answersHistory.push({
      problem: gameState.currentProblem.problem,
      correctAnswer: gameState.currentProblem.answer,
      userAnswer: null,
      isCorrect: false,
      responseTime: difficultySettings[gameSettings.difficulty].timePerProblem,
      points: 0
    });
    
    // Generate new problem after a short delay
    setTimeout(() => {
      if (gameState.isRunning) {
        generateProblem();
      }
    }, 1500);
  }
  
  function endGame() {
    // Clear timers
    clearInterval(mainTimer);
    clearInterval(problemTimer);
    
    // Update game state
    gameState.isRunning = false;
    
    // Update best score
    if (gameState.score > gameState.bestScore) {
      gameState.bestScore = gameState.score;
      localStorage.setItem('mathChallenge_bestScore', gameState.bestScore);
      bestScore.textContent = gameState.bestScore;
    }
    
    // Show result screen
    gameScreen.style.display = 'none';
    resultScreen.style.display = 'block';
    
    // Update result screen
    finalScore.textContent = gameState.score;
    finalCorrect.textContent = gameState.correctAnswers;
    finalIncorrect.textContent = gameState.incorrectAnswers;
    finalLevel.textContent = gameState.level;
    
    // Calculate accuracy
    const totalAnswers = gameState.correctAnswers + gameState.incorrectAnswers;
    const accuracyValue = totalAnswers > 0 ? Math.round((gameState.correctAnswers / totalAnswers) * 100) : 0;
    accuracy.textContent = `${accuracyValue}%`;
    
    // Max streak
    maxStreak.textContent = gameState.maxStreak;
    
    // Average response time
    const averageResponseTime = gameState.responseCount > 0 
      ? (gameState.totalResponseTime / gameState.responseCount).toFixed(2) 
      : 0;
    avgTime.textContent = `${averageResponseTime} saniye`;
  }
  
  function resetGame() {
    // Hide result screen, show start screen
    resultScreen.style.display = 'none';
    startScreen.style.display = 'block';
  }
  
  function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }
  
  function createParticles(element) {
    if (!gameSettings.enableParticles) return;
    
    const particleContainer = document.createElement('div');
    particleContainer.className = 'particle-container';
    particleContainer.style.position = 'absolute';
    particleContainer.style.left = '0';
    particleContainer.style.top = '0';
    particleContainer.style.width = '100%';
    particleContainer.style.height = '100%';
    particleContainer.style.pointerEvents = 'none';
    particleContainer.style.zIndex = '1000';
    
    document.body.appendChild(particleContainer);
    
    const rect = element.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    
    const colors = ['#6a5ae0', '#a890ff', '#4CAF50', '#8BC34A', '#FFEB3B'];
    
    for (let i = 0; i < 30; i++) {
      const particle = document.createElement('div');
      particle.style.position = 'absolute';
      particle.style.width = '8px';
      particle.style.height = '8px';
      particle.style.background = colors[Math.floor(Math.random() * colors.length)];
      particle.style.borderRadius = '50%';
      particle.style.left = `${centerX}px`;
      particle.style.top = `${centerY}px`;
      
      const angle = Math.random() * Math.PI * 2;
      const velocity = 2 + Math.random() * 3;
      const vx = Math.cos(angle) * velocity;
      const vy = Math.sin(angle) * velocity;
      const size = 4 + Math.random() * 6;
      
      particle.style.width = `${size}px`;
      particle.style.height = `${size}px`;
      
      particleContainer.appendChild(particle);
      
      let posX = centerX;
      let posY = centerY;
      let opacity = 1;
      let life = 0;
      const maxLife = 40 + Math.random() * 40;
      
      const animate = () => {
        life++;
        posX += vx;
        posY += vy + 0.1 * life; // Add gravity
        opacity = 1 - life / maxLife;
        
        particle.style.left = `${posX}px`;
        particle.style.top = `${posY}px`;
        particle.style.opacity = opacity;
        
        if (life < maxLife) {
          requestAnimationFrame(animate);
        } else {
          particle.remove();
          if (particleContainer.children.length === 0) {
            particleContainer.remove();
          }
        }
      };
      
      requestAnimationFrame(animate);
    }
  }
});
</script>
{% endblock %}